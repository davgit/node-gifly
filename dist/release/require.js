var requirejs,require,define;(function(t){function e(t,e){return v.call(t,e)}function n(t,e){var n,i,r,o,s,a,u,c,l,h,p=e&&e.split("/"),f=g.map,d=f&&f["*"]||{};if(t&&"."===t.charAt(0))if(e){for(p=p.slice(0,p.length-1),t=p.concat(t.split("/")),c=0;t.length>c;c+=1)if(h=t[c],"."===h)t.splice(c,1),c-=1;else if(".."===h){if(1===c&&(".."===t[2]||".."===t[0]))break;c>0&&(t.splice(c-1,2),c-=2)}t=t.join("/")}else 0===t.indexOf("./")&&(t=t.substring(2));if((p||d)&&f){for(n=t.split("/"),c=n.length;c>0;c-=1){if(i=n.slice(0,c).join("/"),p)for(l=p.length;l>0;l-=1)if(r=f[p.slice(0,l).join("/")],r&&(r=r[i])){o=r,s=c;break}if(o)break;!a&&d&&d[i]&&(a=d[i],u=c)}!o&&a&&(o=a,s=u),o&&(n.splice(0,s,o),t=n.join("/"))}return t}function i(e,n){return function(){return l.apply(t,y.call(arguments,0).concat([e,n]))}}function r(t){return function(e){return n(e,t)}}function o(t){return function(e){f[t]=e}}function s(n){if(e(d,n)){var i=d[n];delete d[n],m[n]=!0,c.apply(t,i)}if(!e(f,n)&&!e(m,n))throw Error("No "+n);return f[n]}function a(t){var e,n=t?t.indexOf("!"):-1;return n>-1&&(e=t.substring(0,n),t=t.substring(n+1,t.length)),[e,t]}function u(t){return function(){return g&&g.config&&g.config[t]||{}}}var c,l,h,p,f={},d={},g={},m={},v=Object.prototype.hasOwnProperty,y=[].slice;h=function(t,e){var i,o=a(t),u=o[0];return t=o[1],u&&(u=n(u,e),i=s(u)),u?t=i&&i.normalize?i.normalize(t,r(e)):n(t,e):(t=n(t,e),o=a(t),u=o[0],t=o[1],u&&(i=s(u))),{f:u?u+"!"+t:t,n:t,pr:u,p:i}},p={require:function(t){return i(t)},exports:function(t){var e=f[t];return e!==void 0?e:f[t]={}},module:function(t){return{id:t,uri:"",exports:f[t],config:u(t)}}},c=function(n,r,a,u){var c,l,g,v,y,_,b=[];if(u=u||n,"function"==typeof a){for(r=!r.length&&a.length?["require","exports","module"]:r,y=0;r.length>y;y+=1)if(v=h(r[y],u),l=v.f,"require"===l)b[y]=p.require(n);else if("exports"===l)b[y]=p.exports(n),_=!0;else if("module"===l)c=b[y]=p.module(n);else if(e(f,l)||e(d,l)||e(m,l))b[y]=s(l);else{if(!v.p)throw Error(n+" missing "+l);v.p.load(v.n,i(u,!0),o(l),{}),b[y]=f[l]}g=a.apply(f[n],b),n&&(c&&c.exports!==t&&c.exports!==f[n]?f[n]=c.exports:g===t&&_||(f[n]=g))}else n&&(f[n]=a)},requirejs=require=l=function(e,n,i,r,o){return"string"==typeof e?p[e]?p[e](n):s(h(e,n).f):(e.splice||(g=e,n.splice?(e=n,n=i,i=null):e=t),n=n||function(){},"function"==typeof i&&(i=r,r=o),r?c(t,e,n,i):setTimeout(function(){c(t,e,n,i)},4),l)},l.config=function(t){return g=t,g.deps&&l(g.deps,g.callback),l},define=function(t,n,i){n.splice||(i=n,n=[]),e(f,t)||e(d,t)||(d[t]=[t,n,i])},define.amd={jQuery:!0}})(),define("almond",function(){}),function(t,e){function n(t){return t&&t.__wrapped__?t:this instanceof n?(this.__wrapped__=t,void 0):new n(t)}function i(t,e,n){e||(e=0);var i=t.length,r=i-e>=(n||ee);if(r)for(var o={},n=e-1;i>++n;){var s=t[n]+"";(we.call(o,s)?o[s]:o[s]=[]).push(t[n])}return function(n){if(r){var i=n+"";return we.call(o,i)&&H(o[i],n)>-1}return H(t,n,e)>-1}}function r(t){return t.charCodeAt(0)}function o(t,n){var i=t.b,r=n.b,t=t.a,n=n.a;if(t!==n){if(t>n||t===e)return 1;if(n>t||n===e)return-1}return r>i?-1:1}function s(t,e,n){function i(){var a=arguments,u=o?this:e;return r||(t=e[s]),n.length&&(a=a.length?n.concat(Se.call(a)):n),this instanceof i?(h.prototype=t.prototype,u=new h,a=t.apply(u,a),w(a)?a:u):t.apply(u,a)}var r=b(t),o=!n,s=e;return o&&(n=e),r||(e=t),i}function a(t,n){return t?"function"!=typeof t?function(e){return e[t]}:n!==e?function(e,i,r){return t.call(n,e,i,r)}:t:D}function u(){for(var t,e={b:"",c:"",e:G,f:Ve,g:"",h:We,i:Xe,j:me,k:"",l:F},n=0;t=arguments[n];n++)for(var i in t)e[i]=t[i];if(t=e.a,e.d=/^[^,]+/.exec(t)[0],n="var i,x,l="+e.d+",t="+e.d+";if(!"+e.d+")return t;"+e.k+";",e.b?(n+="var m=l.length;i=-1;if(typeof m=='number'){",e.i&&(n+="if(k(l)){l=l.split('')}"),n+="while(++i<m){x=l[i];"+e.b+"}}else {"):e.h&&(n+="var m=l.length;i=-1;if(m&&j(l)){while(++i<m){x=l[i+=''];"+e.g+"}}else {"),e.e||(n+="var u=typeof l=='function'&&s.call(l,'prototype');"),e.f&&e.l?(n+="var q=-1,r=p[typeof l]?n(l):[],m=r.length;while(++q<m){i=r[q];",e.e||(n+="if(!(u&&i=='prototype')){"),n+="x=l[i];"+e.g,e.e||(n+="}")):(n+="for(i in l){",(!e.e||e.l)&&(n+="if(",e.e||(n+="!(u&&i=='prototype')"),!e.e&&e.l&&(n+="&&"),e.l&&(n+="h.call(l,i)"),n+="){"),n+="x=l[i];"+e.g+";",(!e.e||e.l)&&(n+="}")),n+="}",e.e)for(n+="var f=l.constructor;",i=0;7>i;i++)n+="i='"+e.j[i]+"';if(","constructor"==e.j[i]&&(n+="!(f&&f.prototype===l)&&"),n+="h.call(l,i)){x=l[i];"+e.g+"}";return(e.b||e.h)&&(n+="}"),n+=e.c+";return t",Function("e,h,j,k,p,n,s","return function("+t+"){"+n+"}")(a,we,f,x,Ke,Te,ke)}function c(t){return"\\"+Ze[t]}function l(t){return an[t]}function h(){}function p(t){return un[t]}function f(t){return Ae.call(t)==Re}function d(t){var e=X;if(!t||"object"!=typeof t||f(t))return e;var n=t.constructor;return Je&&"function"!=typeof t.toString&&"string"==typeof(t+"")||b(n)&&!(n instanceof n)?e:V?(on(t,function(t,n,i){return e=!we.call(i,n),X}),e===X):(on(t,function(t,n){e=n}),e===X||we.call(t,e))}function g(t){var e=[];return sn(t,function(t,n){e.push(n)}),e}function m(t,e,n,i,r){if(t==U)return t;if(n&&(e=X),n=w(t)){var o=Ae.call(t);if(!Ye[o]||Fe&&f(t))return t;var s=o==ze,n=s||(o==Be?hn(t):n)}if(!n||!e)return n?s?Se.call(t):rn({},t):t;switch(n=t.constructor,o){case Me:case He:return new n(+t);case Ie:case Ne:return new n(t);case Le:return n(t.source,ue.exec(t))}for(i||(i=[]),r||(r=[]),o=i.length;o--;)if(i[o]==t)return r[o];var a=s?n(t.length):{};return i.push(t),r.push(a),(s?fn:sn)(t,function(t,n){a[n]=m(t,e,U,i,r)}),a}function v(t){var e=[];return on(t,function(t,n){b(t)&&e.push(n)}),e.sort()}function y(t){var e={};return sn(t,function(t,n){e[t]=n}),e}function _(t,e,n,i){if(t===e)return 0!==t||1/t==1/e;if(t==U||e==U)return t===e;var r=Ae.call(t);if(r!=Ae.call(e))return X;switch(r){case Me:case He:return+t==+e;case Ie:return t!=+t?e!=+e:0==t?1/t==1/e:t==+e;case Le:case Ne:return t==e+""}var o=r==ze||r==Re;if(Fe&&!o&&(o=f(t))&&!f(e))return X;if(!o){if(t.__wrapped__||e.__wrapped__)return _(t.__wrapped__||t,e.__wrapped__||e);if(r!=Be||Je&&("function"!=typeof t.toString&&"string"==typeof(t+"")||"function"!=typeof e.toString&&"string"==typeof(e+"")))return X;var r=t.constructor,s=e.constructor;if(!(r==s||b(r)&&r instanceof r&&b(s)&&s instanceof s))return X}for(n||(n=[]),i||(i=[]),r=n.length;r--;)if(n[r]==t)return i[r]==e;var r=-1,s=F,a=0;if(n.push(t),i.push(e),o){if(a=t.length,s=a==e.length)for(;a--&&(s=_(t[a],e[a],n,i)););return s}for(var u in t)if(we.call(t,u)&&(a++,!we.call(e,u)||!_(t[u],e[u],n,i)))return X;for(u in e)if(we.call(e,u)&&!a--)return X;if(G)for(;7>++r;)if(u=me[r],we.call(t,u)&&(!we.call(e,u)||!_(t[u],e[u],n,i)))return X;return F}function b(t){return"function"==typeof t}function w(t){return t?Ke[typeof t]:X}function x(t){return Ae.call(t)==Ne}function k(t,e,n){var i=arguments,r=0,o=2,s=i[3],a=i[4];for(n!==te&&(s=[],a=[],"number"!=typeof n&&(o=i.length));o>++r;)sn(i[r],function(e,n){var i,r,o;if(e&&((r=ln(e))||hn(e))){for(var u=s.length;u--&&!(i=s[u]==e););i?t[n]=a[u]:(s.push(e),a.push((o=t[n],o=r?ln(o)?o:[]:hn(o)?o:{})),t[n]=k(o,e,te,s,a))}else e!=U&&(t[n]=e)});return t}function S(t){var e=[];return sn(t,function(t){e.push(t)}),e}function A(t,e,n){var i=-1,r=t?t.length:0,o=X,n=(0>n?Pe(0,r+n):n)||0;return"number"==typeof r?o=(x(t)?t.indexOf(e,n):H(t,e,n))>-1:fn(t,function(t){return++i>=n?!(o=t===e):void 0}),o}function j(t,e,n){var i=F,e=a(e,n);if(ln(t))for(var n=-1,r=t.length;r>++n&&(i=!!e(t[n],n,t)););else fn(t,function(t,n,r){return i=!!e(t,n,r)});return i}function $(t,e,n){var i=[],e=a(e,n);if(ln(t))for(var n=-1,r=t.length;r>++n;){var o=t[n];e(o,n,t)&&i.push(o)}else fn(t,function(t,n,r){e(t,n,r)&&i.push(t)});return i}function C(t,e,n){var i,e=a(e,n);return fn(t,function(t,n,r){return e(t,n,r)?(i=t,X):void 0}),i}function E(t,e,n){var i=-1,r=t?t.length:0,o=Array("number"==typeof r?r:0),e=a(e,n);if(ln(t))for(;r>++i;)o[i]=e(t[i],i,t);else fn(t,function(t,n,r){o[++i]=e(t,n,r)});return o}function T(t,e,n){var i=-1/0,o=-1,s=t?t.length:0,u=i;if(e||!ln(t))e=!e&&x(t)?r:a(e,n),fn(t,function(t,n,r){n=e(t,n,r),n>i&&(i=n,u=t)});else for(;s>++o;)t[o]>u&&(u=t[o]);return u}function P(t,e){var n=[];return fn(t,function(t){n.push(t[e])}),n}function O(t,e,n,i){var r=3>arguments.length,e=a(e,i);return fn(t,function(t,i,o){n=r?(r=X,t):e(n,t,i,o)}),n}function q(t,e,n,i){var r=t,o=t?t.length:0,s=3>arguments.length;if("number"!=typeof o)var a=pn(t),o=a.length;else Xe&&x(t)&&(r=t.split(""));return fn(t,function(t,u,c){u=a?a[--o]:--o,n=s?(s=X,r[u]):e.call(i,n,r[u],u,c)}),n}function R(t,e,n){var i,e=a(e,n);if(ln(t))for(var n=-1,r=t.length;r>++n&&!(i=e(t[n],n,t)););else fn(t,function(t,n,r){return!(i=e(t,n,r))});return!!i}function z(t,e,n){return t?e==U||n?t[0]:Se.call(t,0,e):void 0}function M(t,e){for(var n=-1,i=t?t.length:0,r=[];i>++n;){var o=t[n];ln(o)?xe.apply(r,e?o:M(o)):r.push(o)}return r}function H(t,e,n){var i=-1,r=t?t.length:0;if("number"==typeof n)i=(0>n?Pe(0,r+n):n||0)-1;else if(n)return i=B(t,e),t[i]===e?i:-1;for(;r>++i;)if(t[i]===e)return i;return-1}function I(t,e,n){return t?Se.call(t,e==U||n?1:e):[]}function B(t,e,n,i){for(var r=0,o=t?t.length:r,n=n?a(n,i):D,e=n(e);o>r;)i=r+o>>>1,e>n(t[i])?r=i+1:o=i;return r}function L(t,e,n,i){var r=-1,o=t?t.length:0,s=[],u=s;"function"==typeof e&&(i=n,n=e,e=X);var c=!e&&o>74;if(c)var l={};for(n&&(u=[],n=a(n,i));o>++r;){var i=t[r],h=n?n(i,r,t):i;c&&(u=we.call(l,h+"")?l[h]:l[h]=[]),(e?!r||u[u.length-1]!==h:0>H(u,h))&&((n||c)&&u.push(h),s.push(i))}return s}function N(t,e){return Ge||je&&arguments.length>2?je.call.apply(je,arguments):s(t,e,Se.call(arguments,2))}function D(t){return t}function W(t){fn(v(t),function(e){var i=n[e]=t[e];n.prototype[e]=function(){var t=[this.__wrapped__];return xe.apply(t,arguments),t=i.apply(n,t),this.__chain__&&(t=new n(t),t.__chain__=F),t}})}var F=!0,U=null,X=!1,J="object"==typeof exports&&exports,Q="object"==typeof global&&global;Q.global===Q&&(t=Q);var G,V,Y=[],K=new function(){},Z=0,te=K,ee=30,ne=t._,ie=/[-?+=!~*%&^<>|{(\/]|\[\D|\b(?:delete|in|instanceof|new|typeof|void)\b/,re=/&(?:amp|lt|gt|quot|#x27);/g,oe=/\b__p\+='';/g,se=/\b(__p\+=)''\+/g,ae=/(__e\(.*?\)|\b__t\))\+'';/g,ue=/\w*$/,ce=/(?:__e|__t=)\(\s*(?![\d\s"']|this\.)/g,le=RegExp("^"+(K.valueOf+"").replace(/[.*+?^=!:${}()|[\]\/\\]/g,"\\$&").replace(/valueOf|for [^\]]+/g,".+?")+"$"),he=/\$\{((?:(?=\\?)\\?[\s\S])*?)}/g,pe=/<%=([\s\S]+?)%>/g,fe=/($^)/,de=/[&<>"']/g,ge=/['\n\r\t\u2028\u2029\\]/g,me="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" "),ve=Math.ceil,ye=Y.concat,_e=Math.floor,be=le.test(be=Object.getPrototypeOf)&&be,we=K.hasOwnProperty,xe=Y.push,ke=K.propertyIsEnumerable,Se=Y.slice,Ae=K.toString,je=le.test(je=Se.bind)&&je,$e=le.test($e=Array.isArray)&&$e,Ce=t.isFinite,Ee=t.isNaN,Te=le.test(Te=Object.keys)&&Te,Pe=Math.max,Oe=Math.min,qe=Math.random,Re="[object Arguments]",ze="[object Array]",Me="[object Boolean]",He="[object Date]",Ie="[object Number]",Be="[object Object]",Le="[object RegExp]",Ne="[object String]",De=(De={0:1,length:1},Y.splice.call(De,0,1),De[0]),We=F;(function(){function t(){this.x=1}var e=[];t.prototype={valueOf:1,y:1};for(var n in new t)e.push(n);for(n in arguments)We=!n;G=!/valueOf/.test(e),V="x"!=e[0]})(1);var Fe=!f(arguments),Ue="x"!=Se.call("x")[0],Xe="xx"!="x"[0]+Object("x")[0];try{var Je=Ae.call(t.document||0)==Be}catch(Qe){}var Ge=je&&/\n|Opera/.test(je+Ae.call(t.opera)),Ve=Te&&/^.+$|true/.test(Te+!!t.attachEvent),Ye={};Ye[Re]=Ye["[object Function]"]=X,Ye[ze]=Ye[Me]=Ye[He]=Ye[Ie]=Ye[Be]=Ye[Le]=Ye[Ne]=F;var Ke={"boolean":X,"function":F,object:F,number:X,string:X,undefined:X},Ze={"\\":"\\","'":"'","\n":"n","\r":"r","	":"t","\u2028":"u2028","\u2029":"u2029"};n.templateSettings={escape:/<%-([\s\S]+?)%>/g,evaluate:/<%([\s\S]+?)%>/g,interpolate:pe,variable:""};var tn={a:"o,v,g",k:"for(var a=1,b=typeof g=='number'?2:arguments.length;a<b;a++){if((l=arguments[a])){",g:"t[i]=x",c:"}}"},en={a:"d,c,w",k:"c=e(c,w)",b:"if(c(x,i,d)===false)return t",g:"if(c(x,i,d)===false)return t"},nn={b:U},rn=u(tn);Fe&&(f=function(t){return t?we.call(t,"callee"):X});var on=u(en,nn,{l:X}),sn=u(en,nn),an={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;"},un=y(an),cn=u(tn,{g:"if(t[i]==null)"+tn.g}),ln=$e||function(t){return Ae.call(t)==ze};b(/x/)&&(b=function(t){return"[object Function]"==Ae.call(t)});var hn=be?function(t){if(!t||"object"!=typeof t)return X;var e=t.valueOf,n="function"==typeof e&&(n=be(e))&&be(n);return n?t==n||be(t)==n&&!f(t):d(t)}:d,pn=Te?function(t){return"function"==typeof t&&ke.call(t,"prototype")?g(t):w(t)?Te(t):[]}:g,fn=u(en);n.VERSION="0.10.0",n.assign=rn,n.after=function(t,e){return 1>t?e():function(){return 1>--t?e.apply(this,arguments):void 0}},n.bind=N,n.bindAll=function(t){for(var e=arguments,n=e.length>1?0:(e=v(t),-1),i=e.length;i>++n;){var r=e[n];t[r]=N(t[r],t)}return t},n.bindKey=function(t,e){return s(t,e,Se.call(arguments,2))},n.chain=function(t){return t=new n(t),t.__chain__=F,t},n.clone=m,n.compact=function(t){for(var e=-1,n=t?t.length:0,i=[];n>++e;){var r=t[e];r&&i.push(r)}return i},n.compose=function(){var t=arguments;return function(){for(var e=arguments,n=t.length;n--;)e=[t[n].apply(this,e)];return e[0]}},n.contains=A,n.countBy=function(t,e,n){var i={},e=a(e,n);return fn(t,function(t,n,r){n=e(t,n,r),we.call(i,n)?i[n]++:i[n]=1}),i},n.debounce=function(t,e,n){function i(){a=U,n||(o=t.apply(s,r))}var r,o,s,a;return function(){var u=n&&!a;return r=arguments,s=this,clearTimeout(a),a=setTimeout(i,e),u&&(o=t.apply(s,r)),o}},n.defaults=cn,n.defer=function(t){var n=Se.call(arguments,1);return setTimeout(function(){t.apply(e,n)},1)},n.delay=function(t,n){var i=Se.call(arguments,2);return setTimeout(function(){t.apply(e,i)},n)},n.difference=function(t){for(var e=-1,n=t?t.length:0,r=ye.apply(Y,arguments),r=i(r,n),o=[];n>++e;){var s=t[e];r(s)||o.push(s)}return o},n.escape=function(t){return t==U?"":(t+"").replace(de,l)},n.every=j,n.filter=$,n.find=C,n.first=z,n.flatten=M,n.forEach=fn,n.forIn=on,n.forOwn=sn,n.functions=v,n.groupBy=function(t,e,n){var i={},e=a(e,n);return fn(t,function(t,n,r){n=e(t,n,r),(we.call(i,n)?i[n]:i[n]=[]).push(t)}),i},n.has=function(t,e){return t?we.call(t,e):X},n.identity=D,n.indexOf=H,n.initial=function(t,e,n){return t?Se.call(t,0,-(e==U||n?1:e)):[]},n.intersection=function(t){var e=arguments,n=e.length,r={},o=[];return fn(t,function(t){if(0>H(o,t)){for(var s=n;--s;)if(!(r[s]||(r[s]=i(e[s])))(t))return;o.push(t)}}),o},n.invert=y,n.invoke=function(t,e){var n=Se.call(arguments,2),i="function"==typeof e,r=[];return fn(t,function(t){r.push((i?e:t[e]).apply(t,n))}),r},n.isArguments=f,n.isArray=ln,n.isBoolean=function(t){return t===F||t===X||Ae.call(t)==Me},n.isDate=function(t){return Ae.call(t)==He},n.isElement=function(t){return t?1===t.nodeType:X},n.isEmpty=function(t){var e=F;if(!t)return e;var n=Ae.call(t),i=t.length;return n==ze||n==Ne||n==Re||Fe&&f(t)||n==Be&&"number"==typeof i&&b(t.splice)?!i:(sn(t,function(){return e=X}),e)},n.isEqual=_,n.isFinite=function(t){return Ce(t)&&!Ee(parseFloat(t))},n.isFunction=b,n.isNaN=function(t){return Ae.call(t)==Ie&&t!=+t},n.isNull=function(t){return t===U},n.isNumber=function(t){return Ae.call(t)==Ie},n.isObject=w,n.isPlainObject=hn,n.isRegExp=function(t){return Ae.call(t)==Le},n.isString=x,n.isUndefined=function(t){return t===e},n.keys=pn,n.last=function(t,e,n){if(t){var i=t.length;return e==U||n?t[i-1]:Se.call(t,-e||i)}},n.lastIndexOf=function(t,e,n){var i=t?t.length:0;for("number"==typeof n&&(i=(0>n?Pe(0,i+n):Oe(n,i-1))+1);i--;)if(t[i]===e)return i;return-1},n.map=E,n.max=T,n.memoize=function(t,e){var n={};return function(){var i=e?e.apply(this,arguments):arguments[0];return we.call(n,i)?n[i]:n[i]=t.apply(this,arguments)}},n.merge=k,n.min=function(t,e,n){var i=1/0,o=-1,s=t?t.length:0,u=i;if(e||!ln(t))e=!e&&x(t)?r:a(e,n),fn(t,function(t,n,r){n=e(t,n,r),i>n&&(i=n,u=t)});else for(;s>++o;)u>t[o]&&(u=t[o]);return u},n.mixin=W,n.noConflict=function(){return t._=ne,this},n.object=function(t,e){for(var n=-1,i=t?t.length:0,r={};i>++n;){var o=t[n];e?r[o]=e[n]:r[o[0]]=o[1]}return r},n.omit=function(t,e,n){var i="function"==typeof e,r={};if(i)e=a(e,n);else var o=ye.apply(Y,arguments);return on(t,function(t,n,s){(i?!e(t,n,s):0>H(o,n,1))&&(r[n]=t)}),r},n.once=function(t){var e,n=X;return function(){return n?e:(n=F,e=t.apply(this,arguments),t=U,e)}},n.pairs=function(t){var e=[];return sn(t,function(t,n){e.push([n,t])}),e},n.partial=function(t){return s(t,Se.call(arguments,1))},n.pick=function(t,e,n){var i={};if("function"!=typeof e)for(var r=0,o=ye.apply(Y,arguments),s=o.length;s>++r;){var u=o[r];u in t&&(i[u]=t[u])}else e=a(e,n),on(t,function(t,n,r){e(t,n,r)&&(i[n]=t)});return i},n.pluck=P,n.random=function(t,e){return t==U&&e==U&&(e=1),t=+t||0,e==U&&(e=t,t=0),t+_e(qe()*((+e||0)-t+1))},n.range=function(t,e,n){t=+t||0,n=+n||1,e==U&&(e=t,t=0);for(var i=-1,e=Pe(0,ve((e-t)/n)),r=Array(e);e>++i;)r[i]=t,t+=n;return r},n.reduce=O,n.reduceRight=q,n.reject=function(t,e,n){return e=a(e,n),$(t,function(t,n,i){return!e(t,n,i)})},n.rest=I,n.result=function(t,e){var n=t?t[e]:U;return b(n)?t[e]():n},n.shuffle=function(t){var e=-1,n=Array(t?t.length:0);return fn(t,function(t){var i=_e(qe()*(++e+1));n[e]=n[i],n[i]=t}),n},n.size=function(t){var e=t?t.length:0;return"number"==typeof e?e:pn(t).length},n.some=R,n.sortBy=function(t,e,n){var i=[],e=a(e,n);for(fn(t,function(t,n,r){i.push({a:e(t,n,r),b:n,c:t})}),t=i.length,i.sort(o);t--;)i[t]=i[t].c;return i},n.sortedIndex=B,n.tap=function(t,e){return e(t),t},n.template=function(t,e,i){t||(t=""),i||(i={});var r,o,s=n.templateSettings,a=0,u=i.interpolate||s.interpolate||fe,l="__p += '",h=i.variable||s.variable,p=h;t.replace(RegExp((i.escape||s.escape||fe).source+"|"+u.source+"|"+(u===pe?he:fe).source+"|"+(i.evaluate||s.evaluate||fe).source+"|$","g"),function(e,n,i,o,s,u){i||(i=o),l+=t.slice(a,u).replace(ge,c),l+=n?"'+__e("+n+")+'":s?"';"+s+";__p+='":i?"'+((__t=("+i+"))==null?'':__t)+'":"",r||(r=s||ie.test(n||i)),a=u+e.length}),l+="';",p||(h="obj",r?l="with("+h+"){"+l+"}":(i=RegExp("(\\(\\s*)"+h+"\\."+h+"\\b","g"),l=l.replace(ce,"$&"+h+".").replace(i,"$1__d"))),l=(r?l.replace(oe,""):l).replace(se,"$1").replace(ae,"$1;"),l="function("+h+"){"+(p?"":h+"||("+h+"={});")+"var __t,__p='',__e=_.escape"+(r?",__j=Array.prototype.join;function print(){__p+=__j.call(arguments,'')}":(p?"":",__d="+h+"."+h+"||"+h)+";")+l+"return __p}";try{o=Function("_","return "+l)(n)}catch(f){throw f.source=l,f}return e?o(e):(o.source=l,o)},n.throttle=function(t,e){function n(){a=new Date,s=U,r=t.apply(o,i)}var i,r,o,s,a=0;return function(){var u=new Date,c=e-(u-a);return i=arguments,o=this,0>=c?(clearTimeout(s),a=u,r=t.apply(o,i)):s||(s=setTimeout(n,c)),r}},n.times=function(t,e,n){for(var t=+t||0,i=-1,r=Array(t);t>++i;)r[i]=e.call(n,i);return r},n.toArray=function(t){return t&&"number"==typeof t.length?(Ue?x(t):"string"==typeof t)?t.split(""):Se.call(t):S(t)},n.unescape=function(t){return t==U?"":(t+"").replace(re,p)},n.union=function(){return L(ye.apply(Y,arguments))},n.uniq=L,n.uniqueId=function(t){var e=Z++;return t?t+e:e},n.values=S,n.where=function(t,e){var n=pn(e);return $(t,function(t){for(var i=n.length;i--;){var r=t[n[i]]===e[n[i]];if(!r)break}return!!r})},n.without=function(t){for(var e=-1,n=t?t.length:0,r=i(arguments,1,20),o=[];n>++e;){var s=t[e];r(s)||o.push(s)}return o},n.wrap=function(t,e){return function(){var n=[t];return xe.apply(n,arguments),e.apply(this,n)}},n.zip=function(t){for(var e=-1,n=t?T(P(arguments,"length")):0,i=Array(n);n>++e;)i[e]=P(arguments,e);return i},n.all=j,n.any=R,n.collect=E,n.detect=C,n.drop=I,n.each=fn,n.extend=rn,n.foldl=O,n.foldr=q,n.head=z,n.include=A,n.inject=O,n.methods=v,n.select=$,n.tail=I,n.take=z,n.unique=L,W(n),n.prototype.chain=function(){return this.__chain__=F,this},n.prototype.value=function(){return this.__wrapped__},fn("pop push reverse shift sort splice unshift".split(" "),function(t){var e=Y[t];n.prototype[t]=function(){var t=this.__wrapped__;return e.apply(t,arguments),De&&0===t.length&&delete t[0],this.__chain__&&(t=new n(t),t.__chain__=F),t}}),fn(["concat","join","slice"],function(t){var e=Y[t];n.prototype[t]=function(){var t=e.apply(this.__wrapped__,arguments);return this.__chain__&&(t=new n(t),t.__chain__=F),t}}),"function"==typeof define&&"object"==typeof define.amd&&define.amd?(t._=n,define("underscore",[],function(){return n})):J?"object"==typeof module&&module&&module.exports==J?(module.exports=n)._=n:J._=n:t._=n}(this),function(){var t,e=this,n=e.Backbone,i=[],r=i.push,o=i.slice,s=i.splice;t="undefined"!=typeof exports?exports:e.Backbone={},t.VERSION="0.9.10";var a=e._;a||void 0===require||(a=require("underscore")),t.$=e.jQuery||e.Zepto||e.ender,t.noConflict=function(){return e.Backbone=n,this},t.emulateHTTP=!1,t.emulateJSON=!1;var u=/\s+/,c=function(t,e,n,i){if(!n)return!0;if("object"==typeof n)for(var r in n)t[e].apply(t,[r,n[r]].concat(i));else{if(!u.test(n))return!0;for(var o=n.split(u),s=0,a=o.length;a>s;s++)t[e].apply(t,[o[s]].concat(i))}},l=function(t,e){var n,i=-1,r=t.length;switch(e.length){case 0:for(;r>++i;)(n=t[i]).callback.call(n.ctx);return;case 1:for(;r>++i;)(n=t[i]).callback.call(n.ctx,e[0]);return;case 2:for(;r>++i;)(n=t[i]).callback.call(n.ctx,e[0],e[1]);return;case 3:for(;r>++i;)(n=t[i]).callback.call(n.ctx,e[0],e[1],e[2]);return;default:for(;r>++i;)(n=t[i]).callback.apply(n.ctx,e)}},h=t.Events={on:function(t,e,n){if(!c(this,"on",t,[e,n])||!e)return this;this._events||(this._events={});var i=this._events[t]||(this._events[t]=[]);return i.push({callback:e,context:n,ctx:n||this}),this},once:function(t,e,n){if(!c(this,"once",t,[e,n])||!e)return this;var i=this,r=a.once(function(){i.off(t,r),e.apply(this,arguments)});return r._callback=e,this.on(t,r,n),this},off:function(t,e,n){var i,r,o,s,u,l,h,p;if(!this._events||!c(this,"off",t,[e,n]))return this;if(!t&&!e&&!n)return this._events={},this;for(s=t?[t]:a.keys(this._events),u=0,l=s.length;l>u;u++)if(t=s[u],i=this._events[t]){if(o=[],e||n)for(h=0,p=i.length;p>h;h++)r=i[h],(e&&e!==r.callback&&e!==r.callback._callback||n&&n!==r.context)&&o.push(r);this._events[t]=o}return this},trigger:function(t){if(!this._events)return this;var e=o.call(arguments,1);if(!c(this,"trigger",t,e))return this;var n=this._events[t],i=this._events.all;return n&&l(n,e),i&&l(i,arguments),this},listenTo:function(t,e,n){var i=this._listeners||(this._listeners={}),r=t._listenerId||(t._listenerId=a.uniqueId("l"));return i[r]=t,t.on(e,"object"==typeof e?this:n,this),this},stopListening:function(t,e,n){var i=this._listeners;if(i){if(t)t.off(e,"object"==typeof e?this:n,this),e||n||delete i[t._listenerId];else{"object"==typeof e&&(n=this);for(var r in i)i[r].off(e,n,this);this._listeners={}}return this}}};h.bind=h.on,h.unbind=h.off,a.extend(t,h);var p=t.Model=function(t,e){var n,i=t||{};this.cid=a.uniqueId("c"),this.attributes={},e&&e.collection&&(this.collection=e.collection),e&&e.parse&&(i=this.parse(i,e)||{}),(n=a.result(this,"defaults"))&&(i=a.defaults({},i,n)),this.set(i,e),this.changed={},this.initialize.apply(this,arguments)};a.extend(p.prototype,h,{changed:null,idAttribute:"id",initialize:function(){},toJSON:function(){return a.clone(this.attributes)},sync:function(){return t.sync.apply(this,arguments)},get:function(t){return this.attributes[t]},escape:function(t){return a.escape(this.get(t))},has:function(t){return null!=this.get(t)},set:function(t,e,n){var i,r,o,s,u,c,l,h;if(null==t)return this;if("object"==typeof t?(r=t,n=e):(r={})[t]=e,n||(n={}),!this._validate(r,n))return!1;o=n.unset,u=n.silent,s=[],c=this._changing,this._changing=!0,c||(this._previousAttributes=a.clone(this.attributes),this.changed={}),h=this.attributes,l=this._previousAttributes,this.idAttribute in r&&(this.id=r[this.idAttribute]);for(i in r)e=r[i],a.isEqual(h[i],e)||s.push(i),a.isEqual(l[i],e)?delete this.changed[i]:this.changed[i]=e,o?delete h[i]:h[i]=e;if(!u){s.length&&(this._pending=!0);for(var p=0,f=s.length;f>p;p++)this.trigger("change:"+s[p],this,h[s[p]],n)}if(c)return this;if(!u)for(;this._pending;)this._pending=!1,this.trigger("change",this,n);return this._pending=!1,this._changing=!1,this},unset:function(t,e){return this.set(t,void 0,a.extend({},e,{unset:!0}))},clear:function(t){var e={};for(var n in this.attributes)e[n]=void 0;return this.set(e,a.extend({},t,{unset:!0}))},hasChanged:function(t){return null==t?!a.isEmpty(this.changed):a.has(this.changed,t)},changedAttributes:function(t){if(!t)return this.hasChanged()?a.clone(this.changed):!1;var e,n=!1,i=this._changing?this._previousAttributes:this.attributes;for(var r in t)a.isEqual(i[r],e=t[r])||((n||(n={}))[r]=e);return n},previous:function(t){return null!=t&&this._previousAttributes?this._previousAttributes[t]:null},previousAttributes:function(){return a.clone(this._previousAttributes)},fetch:function(t){t=t?a.clone(t):{},void 0===t.parse&&(t.parse=!0);var e=t.success;return t.success=function(t,n,i){return t.set(t.parse(n,i),i)?(e&&e(t,n,i),void 0):!1},this.sync("read",this,t)},save:function(t,e,n){var i,r,o,s,u=this.attributes;return null==t||"object"==typeof t?(i=t,n=e):(i={})[t]=e,!i||n&&n.wait||this.set(i,n)?(n=a.extend({validate:!0},n),this._validate(i,n)?(i&&n.wait&&(this.attributes=a.extend({},u,i)),void 0===n.parse&&(n.parse=!0),r=n.success,n.success=function(t,e,n){t.attributes=u;var o=t.parse(e,n);return n.wait&&(o=a.extend(i||{},o)),a.isObject(o)&&!t.set(o,n)?!1:(r&&r(t,e,n),void 0)},o=this.isNew()?"create":n.patch?"patch":"update","patch"===o&&(n.attrs=i),s=this.sync(o,this,n),i&&n.wait&&(this.attributes=u),s):!1):!1},destroy:function(t){t=t?a.clone(t):{};var e=this,n=t.success,i=function(){e.trigger("destroy",e,e.collection,t)};if(t.success=function(t,e,r){(r.wait||t.isNew())&&i(),n&&n(t,e,r)},this.isNew())return t.success(this,null,t),!1;var r=this.sync("delete",this,t);return t.wait||i(),r},url:function(){var t=a.result(this,"urlRoot")||a.result(this.collection,"url")||P();return this.isNew()?t:t+("/"===t.charAt(t.length-1)?"":"/")+encodeURIComponent(this.id)},parse:function(t){return t},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return null==this.id},isValid:function(t){return!this.validate||!this.validate(this.attributes,t)},_validate:function(t,e){if(!e.validate||!this.validate)return!0;t=a.extend({},this.attributes,t);var n=this.validationError=this.validate(t,e)||null;return n?(this.trigger("invalid",this,n,e||{}),!1):!0}});var f=t.Collection=function(t,e){e||(e={}),e.model&&(this.model=e.model),void 0!==e.comparator&&(this.comparator=e.comparator),this.models=[],this._reset(),this.initialize.apply(this,arguments),t&&this.reset(t,a.extend({silent:!0},e))};a.extend(f.prototype,h,{model:p,initialize:function(){},toJSON:function(t){return this.map(function(e){return e.toJSON(t)})},sync:function(){return t.sync.apply(this,arguments)},add:function(t,e){t=a.isArray(t)?t.slice():[t],e||(e={});var n,i,o,u,c,l,h,p,f,d;for(h=[],p=e.at,f=this.comparator&&null==p&&0!=e.sort,d=a.isString(this.comparator)?this.comparator:null,n=0,i=t.length;i>n;n++)(o=this._prepareModel(u=t[n],e))?(c=this.get(o))?e.merge&&(c.set(u===o?o.attributes:u,e),f&&!l&&c.hasChanged(d)&&(l=!0)):(h.push(o),o.on("all",this._onModelEvent,this),this._byId[o.cid]=o,null!=o.id&&(this._byId[o.id]=o)):this.trigger("invalid",this,u,e);if(h.length&&(f&&(l=!0),this.length+=h.length,null!=p?s.apply(this.models,[p,0].concat(h)):r.apply(this.models,h)),l&&this.sort({silent:!0}),e.silent)return this;for(n=0,i=h.length;i>n;n++)(o=h[n]).trigger("add",o,this,e);return l&&this.trigger("sort",this,e),this},remove:function(t,e){t=a.isArray(t)?t.slice():[t],e||(e={});var n,i,r,o;for(n=0,i=t.length;i>n;n++)o=this.get(t[n]),o&&(delete this._byId[o.id],delete this._byId[o.cid],r=this.indexOf(o),this.models.splice(r,1),this.length--,e.silent||(e.index=r,o.trigger("remove",o,this,e)),this._removeReference(o));return this},push:function(t,e){return t=this._prepareModel(t,e),this.add(t,a.extend({at:this.length},e)),t},pop:function(t){var e=this.at(this.length-1);return this.remove(e,t),e},unshift:function(t,e){return t=this._prepareModel(t,e),this.add(t,a.extend({at:0},e)),t},shift:function(t){var e=this.at(0);return this.remove(e,t),e},slice:function(t,e){return this.models.slice(t,e)},get:function(t){return null==t?void 0:(this._idAttr||(this._idAttr=this.model.prototype.idAttribute),this._byId[t.id||t.cid||t[this._idAttr]||t])},at:function(t){return this.models[t]},where:function(t){return a.isEmpty(t)?[]:this.filter(function(e){for(var n in t)if(t[n]!==e.get(n))return!1;return!0})},sort:function(t){if(!this.comparator)throw Error("Cannot sort a set without a comparator");return t||(t={}),a.isString(this.comparator)||1===this.comparator.length?this.models=this.sortBy(this.comparator,this):this.models.sort(a.bind(this.comparator,this)),t.silent||this.trigger("sort",this,t),this},pluck:function(t){return a.invoke(this.models,"get",t)},update:function(t,e){e=a.extend({add:!0,merge:!0,remove:!0},e),e.parse&&(t=this.parse(t,e));var n,i,r,o,s=[],u=[],c={};if(a.isArray(t)||(t=t?[t]:[]),e.add&&!e.remove)return this.add(t,e);for(i=0,r=t.length;r>i;i++)n=t[i],o=this.get(n),e.remove&&o&&(c[o.cid]=!0),(e.add&&!o||e.merge&&o)&&s.push(n);if(e.remove)for(i=0,r=this.models.length;r>i;i++)n=this.models[i],c[n.cid]||u.push(n);return u.length&&this.remove(u,e),s.length&&this.add(s,e),this},reset:function(t,e){e||(e={}),e.parse&&(t=this.parse(t,e));for(var n=0,i=this.models.length;i>n;n++)this._removeReference(this.models[n]);return e.previousModels=this.models.slice(),this._reset(),t&&this.add(t,a.extend({silent:!0},e)),e.silent||this.trigger("reset",this,e),this},fetch:function(t){t=t?a.clone(t):{},void 0===t.parse&&(t.parse=!0);var e=t.success;return t.success=function(t,n,i){var r=i.update?"update":"reset";t[r](n,i),e&&e(t,n,i)},this.sync("read",this,t)},create:function(t,e){if(e=e?a.clone(e):{},!(t=this._prepareModel(t,e)))return!1;e.wait||this.add(t,e);var n=this,i=e.success;return e.success=function(t,e,r){r.wait&&n.add(t,r),i&&i(t,e,r)},t.save(null,e),t},parse:function(t){return t},clone:function(){return new this.constructor(this.models)},_reset:function(){this.length=0,this.models.length=0,this._byId={}},_prepareModel:function(t,e){if(t instanceof p)return t.collection||(t.collection=this),t;e||(e={}),e.collection=this;var n=new this.model(t,e);return n._validate(t,e)?n:!1},_removeReference:function(t){this===t.collection&&delete t.collection,t.off("all",this._onModelEvent,this)},_onModelEvent:function(t,e,n,i){("add"!==t&&"remove"!==t||n===this)&&("destroy"===t&&this.remove(e,i),e&&t==="change:"+e.idAttribute&&(delete this._byId[e.previous(e.idAttribute)],null!=e.id&&(this._byId[e.id]=e)),this.trigger.apply(this,arguments))},sortedIndex:function(t,e,n){e||(e=this.comparator);var i=a.isFunction(e)?e:function(t){return t.get(e)};return a.sortedIndex(this.models,t,i,n)}});var d=["forEach","each","map","collect","reduce","foldl","inject","reduceRight","foldr","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","toArray","size","first","head","take","initial","rest","tail","drop","last","without","indexOf","shuffle","lastIndexOf","isEmpty","chain"];a.each(d,function(t){f.prototype[t]=function(){var e=o.call(arguments);return e.unshift(this.models),a[t].apply(a,e)}});var g=["groupBy","countBy","sortBy"];a.each(g,function(t){f.prototype[t]=function(e,n){var i=a.isFunction(e)?e:function(t){return t.get(e)};return a[t](this.models,i,n)}});var m=t.Router=function(t){t||(t={}),t.routes&&(this.routes=t.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},v=/\((.*?)\)/g,y=/(\(\?)?:\w+/g,_=/\*\w+/g,b=/[\-{}\[\]+?.,\\\^$|#\s]/g;a.extend(m.prototype,h,{initialize:function(){},route:function(e,n,i){return a.isRegExp(e)||(e=this._routeToRegExp(e)),i||(i=this[n]),t.history.route(e,a.bind(function(r){var o=this._extractParameters(e,r);i&&i.apply(this,o),this.trigger.apply(this,["route:"+n].concat(o)),this.trigger("route",n,o),t.history.trigger("route",this,n,o)
},this)),this},navigate:function(e,n){return t.history.navigate(e,n),this},_bindRoutes:function(){if(this.routes)for(var t,e=a.keys(this.routes);null!=(t=e.pop());)this.route(t,this.routes[t])},_routeToRegExp:function(t){return t=t.replace(b,"\\$&").replace(v,"(?:$1)?").replace(y,function(t,e){return e?t:"([^/]+)"}).replace(_,"(.*?)"),RegExp("^"+t+"$")},_extractParameters:function(t,e){return t.exec(e).slice(1)}});var w=t.History=function(){this.handlers=[],a.bindAll(this,"checkUrl"),"undefined"!=typeof window&&(this.location=window.location,this.history=window.history)},x=/^[#\/]|\s+$/g,k=/^\/+|\/+$/g,S=/msie [\w.]+/,A=/\/$/;w.started=!1,a.extend(w.prototype,h,{interval:50,getHash:function(t){var e=(t||this).location.href.match(/#(.*)$/);return e?e[1]:""},getFragment:function(t,e){if(null==t)if(this._hasPushState||!this._wantsHashChange||e){t=this.location.pathname;var n=this.root.replace(A,"");t.indexOf(n)||(t=t.substr(n.length))}else t=this.getHash();return t.replace(x,"")},start:function(e){if(w.started)throw Error("Backbone.history has already been started");w.started=!0,this.options=a.extend({},{root:"/"},this.options,e),this.root=this.options.root,this._wantsHashChange=this.options.hashChange!==!1,this._wantsPushState=!!this.options.pushState,this._hasPushState=!!(this.options.pushState&&this.history&&this.history.pushState);var n=this.getFragment(),i=document.documentMode,r=S.exec(navigator.userAgent.toLowerCase())&&(!i||7>=i);this.root=("/"+this.root+"/").replace(k,"/"),r&&this._wantsHashChange&&(this.iframe=t.$('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow,this.navigate(n)),this._hasPushState?t.$(window).on("popstate",this.checkUrl):this._wantsHashChange&&"onhashchange"in window&&!r?t.$(window).on("hashchange",this.checkUrl):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),this.fragment=n;var o=this.location,s=o.pathname.replace(/[^\/]$/,"$&/")===this.root;return this._wantsHashChange&&this._wantsPushState&&!this._hasPushState&&!s?(this.fragment=this.getFragment(null,!0),this.location.replace(this.root+this.location.search+"#"+this.fragment),!0):(this._wantsPushState&&this._hasPushState&&s&&o.hash&&(this.fragment=this.getHash().replace(x,""),this.history.replaceState({},document.title,this.root+this.fragment+o.search)),this.options.silent?void 0:this.loadUrl())},stop:function(){t.$(window).off("popstate",this.checkUrl).off("hashchange",this.checkUrl),clearInterval(this._checkUrlInterval),w.started=!1},route:function(t,e){this.handlers.unshift({route:t,callback:e})},checkUrl:function(){var t=this.getFragment();return t===this.fragment&&this.iframe&&(t=this.getFragment(this.getHash(this.iframe))),t===this.fragment?!1:(this.iframe&&this.navigate(t),this.loadUrl()||this.loadUrl(this.getHash()),void 0)},loadUrl:function(t){var e=this.fragment=this.getFragment(t),n=a.any(this.handlers,function(t){return t.route.test(e)?(t.callback(e),!0):void 0});return n},navigate:function(t,e){if(!w.started)return!1;if(e&&e!==!0||(e={trigger:e}),t=this.getFragment(t||""),this.fragment!==t){this.fragment=t;var n=this.root+t;if(this._hasPushState)this.history[e.replace?"replaceState":"pushState"]({},document.title,n);else{if(!this._wantsHashChange)return this.location.assign(n);this._updateHash(this.location,t,e.replace),this.iframe&&t!==this.getFragment(this.getHash(this.iframe))&&(e.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,t,e.replace))}e.trigger&&this.loadUrl(t)}},_updateHash:function(t,e,n){if(n){var i=t.href.replace(/(javascript:|#).*$/,"");t.replace(i+"#"+e)}else t.hash="#"+e}}),t.history=new w;var j=t.View=function(t){this.cid=a.uniqueId("view"),this._configure(t||{}),this._ensureElement(),this.initialize.apply(this,arguments),this.delegateEvents()},$=/^(\S+)\s*(.*)$/,C=["model","collection","el","id","attributes","className","tagName","events"];a.extend(j.prototype,h,{tagName:"div",$:function(t){return this.$el.find(t)},initialize:function(){},render:function(){return this},remove:function(){return this.$el.remove(),this.stopListening(),this},setElement:function(e,n){return this.$el&&this.undelegateEvents(),this.$el=e instanceof t.$?e:t.$(e),this.el=this.$el[0],n!==!1&&this.delegateEvents(),this},delegateEvents:function(t){if(t||(t=a.result(this,"events"))){this.undelegateEvents();for(var e in t){var n=t[e];if(a.isFunction(n)||(n=this[t[e]]),!n)throw Error('Method "'+t[e]+'" does not exist');var i=e.match($),r=i[1],o=i[2];n=a.bind(n,this),r+=".delegateEvents"+this.cid,""===o?this.$el.on(r,n):this.$el.on(r,o,n)}}},undelegateEvents:function(){this.$el.off(".delegateEvents"+this.cid)},_configure:function(t){this.options&&(t=a.extend({},a.result(this,"options"),t)),a.extend(this,a.pick(t,C)),this.options=t},_ensureElement:function(){if(this.el)this.setElement(a.result(this,"el"),!1);else{var e=a.extend({},a.result(this,"attributes"));this.id&&(e.id=a.result(this,"id")),this.className&&(e["class"]=a.result(this,"className"));var n=t.$("<"+a.result(this,"tagName")+">").attr(e);this.setElement(n,!1)}}});var E={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",read:"GET"};t.sync=function(e,n,i){var r=E[e];a.defaults(i||(i={}),{emulateHTTP:t.emulateHTTP,emulateJSON:t.emulateJSON});var o={type:r,dataType:"json"};if(i.url||(o.url=a.result(n,"url")||P()),null!=i.data||!n||"create"!==e&&"update"!==e&&"patch"!==e||(o.contentType="application/json",o.data=JSON.stringify(i.attrs||n.toJSON(i))),i.emulateJSON&&(o.contentType="application/x-www-form-urlencoded",o.data=o.data?{model:o.data}:{}),i.emulateHTTP&&("PUT"===r||"DELETE"===r||"PATCH"===r)){o.type="POST",i.emulateJSON&&(o.data._method=r);var s=i.beforeSend;i.beforeSend=function(t){return t.setRequestHeader("X-HTTP-Method-Override",r),s?s.apply(this,arguments):void 0}}"GET"===o.type||i.emulateJSON||(o.processData=!1);var u=i.success;i.success=function(t){u&&u(n,t,i),n.trigger("sync",n,t,i)};var c=i.error;i.error=function(t){c&&c(n,t,i),n.trigger("error",n,t,i)};var l=i.xhr=t.ajax(a.extend(o,i));return n.trigger("request",n,l,i),l},t.ajax=function(){return t.$.ajax.apply(t.$,arguments)};var T=function(t,e){var n,i=this;n=t&&a.has(t,"constructor")?t.constructor:function(){return i.apply(this,arguments)},a.extend(n,i,e);var r=function(){this.constructor=n};return r.prototype=i.prototype,n.prototype=new r,t&&a.extend(n.prototype,t),n.__super__=i.prototype,n};p.extend=f.extend=m.extend=j.extend=w.extend=T;var P=function(){throw Error('A "url" property or function must be specified')}}.call(this),define("backbone",["underscore"],function(t){return function(){var e;return e||t.Backbone}}(this)),function(){function t(){return t}function e(t,i){var r=e.resolve(t),o=e.modules[r];if(!o)throw Error('failed to require "'+t+'" from '+i);return o.exports||(o.exports={},o.call(o.exports,o,o.exports,e.relative(r),n)),o.exports}var n=this;e.modules={},e.resolve=function(t){var n=t,i=t+".js",r=t+"/index.js";return e.modules[i]&&i||e.modules[r]&&r||n},e.register=function(t,n){e.modules[t]=n},e.relative=function(n){return function(i){if("debug"==i)return t;if("."!=i.charAt(0))return e(i);var r=n.split("/"),o=i.split("/");r.pop();for(var s=0;o.length>s;s++){var a=o[s];".."==a?r.pop():"."!=a&&r.push(a)}return e(r.join("/"),n)}},e.register("engine.io-client.js",function(t,e,n){e.version="0.1.0",e.protocol=1,e.util=n("./util"),e.parser=n("./parser"),e.Socket=n("./socket"),e.EventEmitter=n("./event-emitter"),e.Transport=n("./transport"),e.transports=n("./transports")}),e.register("event-emitter.js",function(t){function e(){}function n(t){return"[object Array]"==Object.prototype.toString.call(t)}t.exports=e,e.prototype.on=function(t,e){return this.$events||(this.$events={}),this.$events[t]?n(this.$events[t])?this.$events[t].push(e):this.$events[t]=[this.$events[t],e]:this.$events[t]=e,this},e.prototype.addListener=e.prototype.on,e.prototype.once=function(t,e){function n(){i.removeListener(t,n),e.apply(this,arguments)}var i=this;return n.listener=e,this.on(t,n),this},e.prototype.removeListener=function(t,e){if(this.$events&&this.$events[t]){var i=this.$events[t];if(n(i)){for(var r=-1,o=0,s=i.length;s>o;o++)if(i[o]===e||i[o].listener&&i[o].listener===e){r=o;break}if(0>r)return this;i.splice(r,1),i.length||delete this.$events[t]}else(i===e||i.listener&&i.listener===e)&&delete this.$events[t]}return this},e.prototype.removeAllListeners=function(t){return void 0===t?(this.$events={},this):(this.$events&&this.$events[t]&&(this.$events[t]=null),this)},e.prototype.listeners=function(t){return this.$events||(this.$events={}),this.$events[t]||(this.$events[t]=[]),n(this.$events[t])||(this.$events[t]=[this.$events[t]]),this.$events[t]},e.prototype.emit=function(t){if(!this.$events)return!1;var e=this.$events[t];if(!e)return!1;var i=Array.prototype.slice.call(arguments,1);if("function"==typeof e)e.apply(this,i);else{if(!n(e))return!1;for(var r=e.slice(),o=0,s=r.length;s>o;o++)r[o].apply(this,i)}return!0},e.prototype.addEventListener=e.prototype.on,e.prototype.removeEventListener=e.prototype.removeListener,e.prototype.dispatchEvent=e.prototype.emit}),e.register("parser.js",function(t,e,n){var i=n("./util"),r=e.packets={open:0,close:1,ping:2,pong:3,message:4,upgrade:5,noop:6},o=i.keys(r),s={type:"error",data:"parser error"};e.encodePacket=function(t){var e=r[t.type];return void 0!==t.data&&(e+=t.data+""),""+e},e.decodePacket=function(t){var e=t.charAt(0);return Number(e)==e&&o[e]?t.length>1?{type:o[e],data:t.substring(1)}:{type:o[e]}:s},e.encodePayload=function(t){if(!t.length)return"0:";for(var n,i="",r=0,o=t.length;o>r;r++)n=e.encodePacket(t[r]),i+=n.length+":"+n;return i},e.decodePayload=function(t){if(""==t)return[s];for(var n,i,r,o=[],a="",u=0,c=t.length;c>u;u++){var l=t.charAt(u);if(":"!=l)a+=l;else{if(""==a||a!=(n=Number(a)))return[s];if(i=t.substr(u+1,n),a!=i.length)return[s];if(i.length){if(r=e.decodePacket(i),s.type==r.type&&s.data==r.data)return[s];o.push(r)}u+=n,a=""}}return""!=a?[s]:o}}),e.register("socket.js",function(t,e,n){function i(t){if("string"==typeof t){var e=s.parseUri(t);t=arguments[1]||{},t.host=e.host,t.secure="https"==e.scheme||"wss"==e.scheme,t.port=e.port||(t.secure?443:80)}t=t||{},this.secure=t.secure||!1,this.host=t.host||t.hostname||"localhost",this.port=t.port||80,this.query=t.query||{},this.query.uid=o(),this.upgrade=!1!==t.upgrade,this.resource=t.resource||"default",this.path=(t.path||"/engine.io").replace(/\/$/,""),this.path+="/"+this.resource+"/",this.forceJSONP=!!t.forceJSONP,this.flashPath=t.flashPath||"",this.transports=t.transports||["polling","websocket","flashsocket"],this.readyState="",this.writeBuffer=[],this.policyPort=t.policyPort||843,this.open()}function r(t){var e={};for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e}function o(){return(Math.random()+"").substr(5)+(Math.random()+"").substr(5)}var s=n("./util"),a=n("./transports"),u=n("debug")("engine-client:socket"),c=n("./event-emitter");t.exports=i,s.inherits(i,c),i.prototype.createTransport=function(t){u('creating transport "%s"',t);var e=r(this.query);e.transport=t,this.id&&(e.sid=this.id);var n=new a[t]({host:this.host,port:this.port,secure:this.secure,path:this.path,query:e,forceJSONP:this.forceJSONP,flashPath:this.flashPath,policyPort:this.policyPort});return n},i.prototype.open=function(){this.readyState="opening";var t=this.createTransport(this.transports[0]);t.open(),this.setTransport(t)},i.prototype.setTransport=function(t){var e=this;this.transport&&(u("clearing existing transport"),this.transport.removeAllListeners()),this.transport=t,t.on("drain",function(){e.flush()}).on("packet",function(t){e.onPacket(t)}).on("error",function(t){e.onError(t)}).on("close",function(){e.onClose("transport close")})},i.prototype.probe=function(t){u('probing transport "%s"',t);var e=this.createTransport(t,{probe:1}),n=this;e.once("open",function(){u('probe transport "%s" opened',t),e.send([{type:"ping",data:"probe"}]),e.once("packet",function(i){if("pong"==i.type&&"probe"==i.data)u('probe transport "%s" pong',t),n.upgrading=!0,n.emit("upgrading",e),u('pausing current transport "%s"',n.transport.name),n.transport.pause(function(){"closed"!=n.readyState&&"closing"!=n.readyState&&(u("changing transport and sending upgrade packet"),n.emit("upgrade",e),n.setTransport(e),e.send([{type:"upgrade"}]),e=null,n.upgrading=!1,n.flush())});else{u('probe transport "%s" failed',t);var r=Error("probe error");r.transport=e.name,n.emit("error",r)}})}),e.open(),this.once("close",function(){e&&(u("socket closed prematurely - aborting probe"),e.close(),e=null)}),this.once("upgrading",function(t){e&&t.name!=e.name&&(u('"%s" works - aborting "%s"',t.name,e.name),e.close(),e=null)})},i.prototype.onOpen=function(){if(u("socket open"),this.readyState="open",this.emit("open"),this.onopen&&this.onopen.call(this),this.flush(),this.upgrade&&this.transport.pause){u("starting upgrade probes");for(var t=0,e=this.upgrades.length;e>t;t++)this.probe(this.upgrades[t])}},i.prototype.onPacket=function(t){if("opening"==this.readyState||"open"==this.readyState)switch(u('socket receive: type "%s", data "%s"',t.type,t.data),t.type){case"open":this.onHandshake(s.parseJSON(t.data));break;case"ping":this.sendPacket("pong"),this.setPingTimeout();break;case"error":var e=Error("server error");e.code=t.data,this.emit("error",e);break;case"message":this.emit("message",t.data);var n={data:t.data};n.toString=function(){return t.data},this.onmessage&&this.onmessage.call(this,n)}else u('packet received with socket readyState "%s"',this.readyState)},i.prototype.onHandshake=function(t){this.emit("handshake",t),this.id=t.sid,this.transport.query.sid=t.sid,this.upgrades=t.upgrades,this.pingTimeout=t.pingTimeout,this.onOpen(),this.setPingTimeout()},i.prototype.setPingTimeout=function(){clearTimeout(this.pingTimeoutTimer);var t=this;this.pingTimeoutTimer=setTimeout(function(){t.onClose("ping timeout")},this.pingTimeout)},i.prototype.flush=function(){"closed"!=this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length&&(u("flushing %d packets in socket",this.writeBuffer.length),this.transport.send(this.writeBuffer),this.writeBuffer=[])},i.prototype.send=function(t){return this.sendPacket("message",t),this},i.prototype.sendPacket=function(t,e){var n={type:t,data:e};this.writeBuffer.push(n),this.flush()},i.prototype.close=function(){return("opening"==this.readyState||"open"==this.readyState)&&(this.onClose("forced close"),u("socket closing - telling transport to close"),this.transport.close()),this},i.prototype.onError=function(t){this.emit("error",t),this.onClose("transport error",t)},i.prototype.onClose=function(t,e){"closed"!=this.readyState&&(u('socket close with reason: "%s"',t),this.readyState="closed",this.emit("close",t,e),this.onclose&&this.onclose.call(this))}}),e.register("transport.js",function(t,e,n){function i(t){this.path=t.path,this.host=t.host,this.port=t.port,this.secure=t.secure,this.query=t.query,this.readyState=""}var r=n("./util"),o=n("./parser"),s=n("./event-emitter");t.exports=i,r.inherits(i,s),i.prototype.onError=function(t,e){var n=Error(t);return n.type="TransportError",n.description=e,this.emit("error",n),this},i.prototype.open=function(){return("closed"==this.readyState||""==this.readyState)&&(this.readyState="opening",this.doOpen()),this},i.prototype.close=function(){return("opening"==this.readyState||"open"==this.readyState)&&(this.doClose(),this.onClose()),this},i.prototype.send=function(t){if("open"!=this.readyState)throw Error("Transport not open");this.write(t)},i.prototype.onOpen=function(){this.readyState="open",this.writable=!0,this.emit("open")},i.prototype.onData=function(t){this.onPacket(o.decodePacket(t))},i.prototype.onPacket=function(t){this.emit("packet",t)},i.prototype.onClose=function(){this.readyState="closed",this.emit("close")}}),e.register("transports/flashsocket.js",function(t,e,n){function i(t){s.call(this,t),this.flashPath=t.flashPath,this.policyPort=t.policyPort}function r(t,e){if(u[t])return e();var n=document.createElement("script"),i=!1;n.onload=n.onreadystatechange=function(){if(!i&&!u[t]){var r=n.readyState;r&&"loaded"!=r&&"complete"!=r||(n.onload=n.onreadystatechange=null,i=!0,u[t]=!0,e())}},n.async=1,n.src=t;var r=document.getElementsByTagName("head")[0];r.insertBefore(n,r.firstChild)}function o(t,e){function n(i){return t[i]?(r(t[i],function(){n(++i)}),void 0):e()}n(0)}var s=n("./websocket"),a=n("../util");t.exports=i,a.inherits(i,s),i.prototype.name="flashsocket",i.prototype.doOpen=function(){function t(){return function(){Array.prototype.join.call(arguments," ")}}if(this.check()){WEB_SOCKET_LOGGER={log:t("debug"),error:t("error")},WEB_SOCKET_SUPPRESS_CROSS_DOMAIN_SWF_ERROR=!0,WEB_SOCKET_DISABLE_AUTO_INITIALIZATION=!0,"undefined"==typeof WEB_SOCKET_SWF_LOCATION&&(WEB_SOCKET_SWF_LOCATION=this.flashPath+"WebSocketMainInsecure.swf");var e=[this.flashPath+"web_socket.js"];"undefined"==typeof swfobject&&e.unshift(this.flashPath+"swfobject.js");var n=this;o(e,function(){n.ready(function(){WebSocket.__addTask(function(){s.prototype.doOpen.call(n)})})})}},i.prototype.doClose=function(){if(this.socket){var t=this;WebSocket.__addTask(function(){s.prototype.doClose.call(t)})}},i.prototype.write=function(){var t=this,e=arguments;WebSocket.__addTask(function(){s.prototype.write.apply(t,e)})},i.prototype.ready=function(t){function e(){i.loaded||(843!=n.policyPort&&WebSocket.loadFlashPolicyFile("xmlsocket://"+n.host+":"+n.policyPort),WebSocket.__initialize(),i.loaded=!0),t.call(n)}if("undefined"!=typeof WebSocket&&"__initialize"in WebSocket&&swfobject&&!(10>swfobject.getFlashPlayerVersion().major)){var n=this;return document.body?e():(a.load(e),void 0)}},i.prototype.check=function(){if("undefined"!=typeof WebSocket&&!("__initialize"in WebSocket))return!1;if(window.ActiveXObject){var t=null;try{t=new ActiveXObject("ShockwaveFlash.ShockwaveFlash")}catch(e){}if(t)return!0}else for(var n=0,i=navigator.plugins.length;i>n;n++)for(var r=0,o=navigator.plugins[n].length;o>r;r++)if("Shockwave Flash"==navigator.plugins[n][r].description)return!0;return!1};var u={}}),e.register("transports/index.js",function(t,e,n,i){function r(t){var e=!1;return i.location&&(e=t.host!=i.location.hostname||i.location.port!=t.port),c.request(e)&&!t.forceJSONP?new o(t):new s(t)}var o=n("./polling-xhr"),s=n("./polling-jsonp"),a=n("./websocket"),u=n("./flashsocket"),c=n("../util");e.polling=r,e.websocket=a,e.flashsocket=u}),e.register("transports/polling-jsonp.js",function(t,e,n,i){function r(t){o.call(this,t),this.index=c++;var e=this;u.push(function(t){e.onData(t)}),this.query.j=u.length-1}var o=n("./polling"),s=n("../util");t.exports=r;var a=/\n/g,u=i.___eio=[],c=0;s.inherits(r,o),r.prototype.doOpen=function(){var t=this;s.defer(function(){o.prototype.doOpen.call(t)})},r.prototype.doClose=function(){this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),this.form&&(this.form.parentNode.removeChild(this.form),this.form=null),o.prototype.doClose.call(this)},r.prototype.doPoll=function(){var t=document.createElement("script");this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),t.async=!0,t.src=this.uri();var e=document.getElementsByTagName("script")[0];e.parentNode.insertBefore(t,e),this.script=t,s.ua.gecko&&setTimeout(function(){var t=document.createElement("iframe");document.body.appendChild(t),document.body.removeChild(t)},100)},r.prototype.doWrite=function(t,e){function n(){i(),e()}function i(){r.iframe&&r.form.removeChild(r.iframe);try{o=document.createElement('<iframe name="'+r.iframeId+'">')}catch(t){o=document.createElement("iframe"),o.name=r.iframeId}o.id=r.iframeId,r.form.appendChild(o),r.iframe=o}var r=this;if(!this.form){var o,s=document.createElement("form"),u=document.createElement("textarea"),c=this.iframeId="eio_iframe_"+this.index;s.className="socketio",s.style.position="absolute",s.style.top="-1000px",s.style.left="-1000px",s.target=c,s.method="POST",s.setAttribute("accept-charset","utf-8"),u.name="d",s.appendChild(u),document.body.appendChild(s),this.form=s,this.area=u}this.form.action=this.uri(),i(),this.area.value=t.replace(a,"\\n");try{this.form.submit()}catch(l){}this.iframe.attachEvent?o.onreadystatechange=function(){"complete"==r.iframe.readyState&&n()}:this.iframe.onload=n}}),e.register("transports/polling-xhr.js",function(t,e,n,i){function r(){}function o(t){a.call(this,t),i.location&&(this.xd=t.host!=i.location.hostname||i.location.port!=t.port)}function s(t){this.method=t.method||"GET",this.uri=t.uri,this.xd=!!t.xd,this.async=!1!==t.async,this.data=void 0!=t.data?t.data:null,this.create()}var a=n("./polling"),u=n("../event-emitter"),c=n("../util");t.exports=o,t.exports.Request=s,c.inherits(o,a),o.prototype.doOpen=function(){var t=this;c.defer(function(){a.prototype.doOpen.call(t)})},o.prototype.request=function(t){return t=t||{},t.uri=this.uri(),t.xd=this.xd,new s(t)},o.prototype.doWrite=function(t,e){var n=this.request({method:"POST",data:t}),i=this;n.on("success",e),n.on("error",function(t){i.onError("xhr post error",t)}),this.sendXhr=n},o.prototype.doPoll=function(){var t=this.request(),e=this;t.on("data",function(t){e.onData(t)}),t.on("error",function(t){e.onError("xhr poll error",t)}),this.pollXhr=t},c.inherits(s,u),s.prototype.create=function(){var t=this.xhr=c.request(this.xd),e=this;if(t.open(this.method,this.uri,this.async),"POST"==this.method)try{t.setRequestHeader?t.setRequestHeader("Content-type","text/plain;charset=UTF-8"):t.contentType="text/plain"}catch(n){}this.xd&&i.XDomainRequest&&t instanceof XDomainRequest?(t.onerror=function(t){e.onError(t)},t.onload=function(){e.onData(t.responseText)},t.onprogress=r):("withCredentials"in t&&(t.withCredentials=!0),t.onreadystatechange=function(){var n;try{if(4!=t.readyState)return;200==t.status||1223==t.status?n=t.responseText:e.onError(t.status)}catch(i){e.onError(i)}void 0!==n&&e.onData(n)}),t.send(this.data),i.ActiveXObject&&(this.index=s.requestsCount++,s.requests[this.index]=this)},s.prototype.onSuccess=function(){this.emit("success"),this.cleanup()},s.prototype.onData=function(t){this.emit("data",t),this.onSuccess()},s.prototype.onError=function(t){this.emit("error",t),this.cleanup()},s.prototype.cleanup=function(){this.xhr.onreadystatechange=r,this.xhr.onload=this.xhr.onerror=r;try{this.xhr.abort()}catch(t){}i.ActiveXObject&&delete s.requests[this.index],this.xhr=null},s.prototype.abort=function(){this.cleanup()},i.ActiveXObject&&(s.requestsCount=0,s.requests={},i.attachEvent("onunload",function(){for(var t in s.requests)s.requests.hasOwnProperty(t)&&s.requests[t].abort()}))}),e.register("transports/polling.js",function(t,e,n,i){function r(t){o.call(this,t),this.forceBust=!!t.forceBust}var o=n("../transport"),s=n("../util"),a=n("../parser");t.exports=r,s.inherits(r,o),r.prototype.name="polling",r.prototype.doOpen=function(){this.poll()},r.prototype.pause=function(t){function e(){n.readyState="paused",t()}var n=this;if(this.readyState="pausing",this.polling||!this.writable){var i=0;this.polling&&(i++,this.once("poll",function(){--i||e()})),this.writable||(i++,this.once("drain",function(){--i||e()}))}else e()},r.prototype.poll=function(){this.polling=!0,this.doPoll()},r.prototype.onData=function(t){for(var e=a.decodePayload(t),n=0,i=e.length;i>n;n++){if("opening"==this.readyState&&this.onOpen(),"close"==e[n].type)return this.onClose(),void 0;this.onPacket(e[n])}this.polling=!1,this.emit("poll"),"open"==this.readyState&&this.poll()},r.prototype.doClose=function(){this.send([{type:"close"}])},r.prototype.write=function(t){var e=this;this.writable=!1,this.doWrite(a.encodePayload(t),function(){e.writable=!0,e.emit("drain")})},r.prototype.uri=function(){var t=this.query||{},e=this.secure?"https":"http",n="";return(i.ActiveXObject||this.forceBust)&&(t.t=+new Date),t=s.qs(t),this.port&&("https"==e&&443!=this.port||"http"==e&&80!=this.port)&&(n=":"+this.port),t.length&&(t="?"+t),e+"://"+this.host+n+this.path+t}}),e.register("transports/websocket.js",function(t,e,n,i){function r(t){s.call(this,t)}function o(){return i.WebSocket||i.MozWebSocket}var s=n("../transport"),a=n("../parser"),u=n("../util");t.exports=r,u.inherits(r,s),r.prototype.name="websocket",r.prototype.doOpen=function(){if(this.check()){var t=this;this.socket=new(o())(this.uri()),this.socket.onopen=function(){t.onOpen()},this.socket.onclose=function(){t.onClose()},this.socket.onmessage=function(e){t.onData(e.data)},this.socket.onerror=function(e){t.onError("websocket error",e)}}},r.prototype.write=function(t){for(var e=0,n=t.length;n>e;e++)this.socket.send(a.encodePacket(t[e]))},r.prototype.doClose=function(){this.socket!==void 0&&this.socket.close()},r.prototype.uri=function(){var t=u.qs(this.query),e=this.secure?"wss":"ws",n="";return this.port&&("wss"==e&&443!=this.port||"ws"==e&&80!=this.port)&&(n=":"+this.port),t.length&&(t="?"+t),e+"://"+this.host+n+this.path+t},r.prototype.check=function(){var t=o();return!(!t||"__initialize"in t&&this.name===r.prototype.name)}}),e.register("util.js",function(t,e,n,i){var r=!1;e.inherits=function(t,e){function n(){}n.prototype=e.prototype,t.prototype=new n},e.keys=Object.keys||function(t){var e=[],n=Object.prototype.hasOwnProperty;for(var i in t)n.call(t,i)&&e.push(i);return e},e.on=function(t,e,n,i){t.attachEvent?t.attachEvent("on"+e,n):t.addEventListener&&t.addEventListener(e,n,i)},e.load=function(t){return i.document&&"complete"===document.readyState||r?t():(e.on(i,"load",t,!1),void 0)},"undefined"!=typeof window&&e.load(function(){r=!0}),e.defer=function(t){return e.ua.webkit&&"undefined"==typeof importScripts?(e.load(function(){setTimeout(t,100)}),void 0):t()};var o=/^[\],:{}\s]*$/,s=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,a=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,u=/(?:^|:|,)(?:\s*\[)+/g,c=/^\s+/,l=/\s+$/;e.parseJSON=function(t){return"string"==typeof t&&t?(t=t.replace(c,"").replace(l,""),i.JSON&&JSON.parse?JSON.parse(t):o.test(t.replace(s,"@").replace(a,"]").replace(u,""))?Function("return "+t)():void 0):null},e.ua={},e.ua.hasCORS="undefined"!=typeof XMLHttpRequest&&function(){try{var t=new XMLHttpRequest}catch(e){return!1}return void 0!=t.withCredentials}(),e.ua.webkit="undefined"!=typeof navigator&&/webkit/i.test(navigator.userAgent),e.ua.gecko="undefined"!=typeof navigator&&/gecko/i.test(navigator.userAgent),e.request=function(t){if(t&&"undefined"!=typeof XDomainRequest)return new XDomainRequest;try{if("undefined"!=typeof XMLHttpRequest&&(!t||e.ua.hasCORS))return new XMLHttpRequest}catch(n){}if(!t)try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(n){}};var h=/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,p=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];e.parseUri=function(t){for(var e=h.exec(t||""),n={},i=14;i--;)n[p[i]]=e[i]||"";return n},e.qs=function(t){var e="";for(var n in t)t.hasOwnProperty(n)&&(e.length&&(e+="&"),e+=n+"="+encodeURIComponent(t[n]));return e}}),"undefined"!=typeof module?module.exports=e("engine.io-client"):eio=e("engine.io-client")}(),define("vendor/engine.io",function(t){return function(){var e;return e||t.eio}}(this)),define("media_model",["underscore","backbone"],function(t,e){var n=e.Model.extend({url:function(){return"/api/media/"+this.id},initialize:function(){},update:function(t){var e=$.extend(this.toJSON(),t);this.set(e)}});return n}),define("media_collection",["require","exports","module","backbone","media_model"],function(t,e,n){var i=t("backbone"),r=t("media_model");n.exports=i.Collection.extend({model:r,current_page:1,url:function(){var t="/api/media";return this.current_page>1&&(t+="?p="+this.current_page),t},initialize:function(t){if(!t.app)throw Error("Requires an `app` instance");this.app=t.app;var e=this;this.app.socket.on("message",function(t){t=JSON.parse(t);var n=e.get(t.id);n?n.update(t):e.add(t)})}})}),function(){var t=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],e=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,n=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,i=[],r={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g},o=function(t){var e=r,n="var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('"+t.replace(/\\/g,"\\\\").replace(/'/g,"\\'").replace(e.interpolate,function(t,e){return"',"+e.replace(/\\'/g,"'")+",'"}).replace(e.evaluate||null,function(t,e){return"');"+e.replace(/\\'/g,"'").replace(/[\r\n\t]/g," ")+"; __p.push('"}).replace(/\r/g,"").replace(/\n/g,"").replace(/\t/g,"")+"');}return __p.join('');";return n};define("tpl",[],function(){var r,s,a;return"undefined"!=typeof window&&window.navigator&&window.document?s=function(t,e){var n=r.createXhr();n.open("GET",t,!0),n.onreadystatechange=function(){4===n.readyState&&e(n.responseText)},n.send(null)}:"undefined"!=typeof process&&process.versions&&process.versions.node&&(a=require.nodeRequire("fs"),s=function(t,e){e(a.readFileSync(t,"utf8"))}),r={version:"0.24.0",strip:function(t){if(t){t=t.replace(e,"");var i=t.match(n);i&&(t=i[1])}else t="";return t},jsEscape:function(t){return t.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"").replace(/[\t]/g,"").replace(/[\r]/g,"")},createXhr:function(){var e,n,i;if("undefined"!=typeof XMLHttpRequest)return new XMLHttpRequest;for(n=0;3>n;n++){i=t[n];try{e=new ActiveXObject(i)}catch(r){}if(e){t=[i];break}}if(!e)throw Error("require.getXhr(): XMLHttpRequest not available");return e},get:s,load:function(t,e,n,s){var a,u=!1,c=t.indexOf("."),l=t.substring(0,c),h=t.substring(c+1,t.length);c=h.indexOf("!"),-1!==c&&(u=h.substring(c+1,h.length),u="strip"===u,h=h.substring(0,c)),a="nameToUrl"in e?e.nameToUrl(l,"."+h):e.toUrl(l+"."+h),r.get(a,function(e){e=o(e),s.isBuild||(e=Function("obj",e)),e=u?r.strip(e):e,s.isBuild&&s.inlineText&&(i[t]=e),n(e)})},write:function(t,e,n){if(e in i){var o=r.jsEscape(i[e]);n("define('"+t+"!"+e+"', function() {return function(obj) { "+o.replace(/(\\')/g,"'").replace(/(\\\\)/g,"\\")+"}});\n")}}}})}(),define("tpl!templates/cell.ejs",function(){return function(obj){var __p=[];with(obj||{})__p.push('<figure data-id="',id,'">  <img src="',cover_url,'"/>  <div class="progress"></div></figure><div class="controls">  <a href="#" data-action="play" class="icon-play"></a>  <a href="#" data-action="fullscreen" class="icon-fullscreen"></a>  <a href="',hash,'.gif" class="icon-link"></a>  <a href="/k/?src=/',hash,'.gif" class="icon-magic"></a></div>');return __p.join("")}}),define("plugins/jquery.imagesloaded",[],function(){(function(t,e){var n="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==";t.fn.imagesLoaded=function(i){function r(){var e=t(h),n=t(p);a&&(p.length?a.reject(c,e,n):a.resolve(c)),t.isFunction(i)&&i.call(s,c,e,n)}function o(e,i){e.src!==n&&-1===t.inArray(e,l)&&(l.push(e),i?p.push(e):h.push(e),t.data(e,"imagesLoaded",{isBroken:i,src:e.src}),u&&a.notifyWith(t(e),[i,c,t(h),t(p)]),c.length===l.length&&(setTimeout(r),c.unbind(".imagesLoaded")))}var s=this,a=t.isFunction(t.Deferred)?t.Deferred():0,u=t.isFunction(a.notify),c=s.find("img").add(s.filter("img")),l=[],h=[],p=[];return c.length?c.bind("load.imagesLoaded error.imagesLoaded",function(t){o(t.target,"error"===t.type)}).each(function(i,r){var s=r.src,a=t.data(r,"imagesLoaded");return a&&a.src===s?(o(r,a.isBroken),e):r.complete&&r.naturalWidth!==e?(o(r,0===r.naturalWidth||0===r.naturalHeight),e):((r.readyState||r.complete)&&(r.src=n,r.src=s),e)}):r(),a?a.promise(s):s}})(jQuery)}),function(t,e){var n,i=t.document,r=t.Modernizr,o=function(t){return t.charAt(0).toUpperCase()+t.slice(1)},s="Moz Webkit O Ms".split(" "),a=function(t){var e,n=i.documentElement.style;if("string"==typeof n[t])return t;t=o(t);for(var r=0,a=s.length;a>r;r++)if(e=s[r]+t,"string"==typeof n[e])return e
},u=a("transform"),c=a("transitionProperty"),l={csstransforms:function(){return!!u},csstransforms3d:function(){var t=!!a("perspective");if(t){var n=" -o- -moz- -ms- -webkit- -khtml- ".split(" "),i="@media ("+n.join("transform-3d),(")+"modernizr)",r=e("<style>"+i+"{#modernizr{height:3px}}"+"</style>").appendTo("head"),o=e('<div id="modernizr" />').appendTo("html");t=3===o.height(),o.remove(),r.remove()}return t},csstransitions:function(){return!!c}};if(r)for(n in l)r.hasOwnProperty(n)||r.addTest(n,l[n]);else{r=t.Modernizr={_version:"1.6ish: miniModernizr for Isotope"};var h,p=" ";for(n in l)h=l[n](),r[n]=h,p+=" "+(h?"":"no-")+n;e("html").addClass(p)}if(r.csstransforms){var f=r.csstransforms3d?{translate:function(t){return"translate3d("+t[0]+"px, "+t[1]+"px, 0) "},scale:function(t){return"scale3d("+t+", "+t+", 1) "}}:{translate:function(t){return"translate("+t[0]+"px, "+t[1]+"px) "},scale:function(t){return"scale("+t+") "}},d=function(t,n,i){var r,o,s=e.data(t,"isoTransform")||{},a={},c={};a[n]=i,e.extend(s,a);for(r in s)o=s[r],c[r]=f[r](o);var l=c.translate||"",h=c.scale||"",p=l+h;e.data(t,"isoTransform",s),t.style[u]=p};e.cssNumber.scale=!0,e.cssHooks.scale={set:function(t,e){d(t,"scale",e)},get:function(t){var n=e.data(t,"isoTransform");return n&&n.scale?n.scale:1}},e.fx.step.scale=function(t){e.cssHooks.scale.set(t.elem,t.now+t.unit)},e.cssNumber.translate=!0,e.cssHooks.translate={set:function(t,e){d(t,"translate",e)},get:function(t){var n=e.data(t,"isoTransform");return n&&n.translate?n.translate:[0,0]}}}var g,m;r.csstransitions&&(g={WebkitTransitionProperty:"webkitTransitionEnd",MozTransitionProperty:"transitionend",OTransitionProperty:"oTransitionEnd",transitionProperty:"transitionEnd"}[c],m=a("transitionDuration"));var v,y=e.event;y.special.smartresize={setup:function(){e(this).bind("resize",y.special.smartresize.handler)},teardown:function(){e(this).unbind("resize",y.special.smartresize.handler)},handler:function(t,e){var n=this,i=arguments;t.type="smartresize",v&&clearTimeout(v),v=setTimeout(function(){jQuery.event.handle.apply(n,i)},"execAsap"===e?0:100)}},e.fn.smartresize=function(t){return t?this.bind("smartresize",t):this.trigger("smartresize",["execAsap"])},e.Isotope=function(t,n,i){this.element=e(n),this._create(t),this._init(i)};var _=["width","height"],b=e(t);e.Isotope.settings={resizable:!0,layoutMode:"masonry",containerClass:"isotope",itemClass:"isotope-item",hiddenClass:"isotope-hidden",hiddenStyle:{opacity:0,scale:.001},visibleStyle:{opacity:1,scale:1},containerStyle:{position:"relative",overflow:"hidden"},animationEngine:"best-available",animationOptions:{queue:!1,duration:800},sortBy:"original-order",sortAscending:!0,resizesContainer:!0,transformsEnabled:!e.browser.opera,itemPositionDataEnabled:!1},e.Isotope.prototype={_create:function(t){this.options=e.extend({},e.Isotope.settings,t),this.styleQueue=[],this.elemCount=0;var n=this.element[0].style;this.originalStyle={};var i=_.slice(0);for(var r in this.options.containerStyle)i.push(r);for(var o=0,s=i.length;s>o;o++)r=i[o],this.originalStyle[r]=n[r]||"";this.element.css(this.options.containerStyle),this._updateAnimationEngine(),this._updateUsingTransforms();var a={"original-order":function(t,e){return e.elemCount++,e.elemCount},random:function(){return Math.random()}};this.options.getSortData=e.extend(this.options.getSortData,a),this.reloadItems(),this.offset={left:parseInt(this.element.css("padding-left")||0,10),top:parseInt(this.element.css("padding-top")||0,10)};var u=this;setTimeout(function(){u.element.addClass(u.options.containerClass)},0),this.options.resizable&&b.bind("smartresize.isotope",function(){u.resize()}),this.element.delegate("."+this.options.hiddenClass,"click",function(){return!1})},_getAtoms:function(t){var e=this.options.itemSelector,n=e?t.filter(e).add(t.find(e)):t,i={position:"absolute"};return this.usingTransforms&&(i.left=0,i.top=0),n.css(i).addClass(this.options.itemClass),this.updateSortData(n,!0),n},_init:function(t){this.$filteredAtoms=this._filter(this.$allAtoms),this._sort(),this.reLayout(t)},option:function(t){if(e.isPlainObject(t)){this.options=e.extend(!0,this.options,t);var n;for(var i in t)n="_update"+o(i),this[n]&&this[n]()}},_updateAnimationEngine:function(){var t,e=this.options.animationEngine.toLowerCase().replace(/[ _\-]/g,"");switch(e){case"css":case"none":t=!1;break;case"jquery":t=!0;break;default:t=!r.csstransitions}this.isUsingJQueryAnimation=t,this._updateUsingTransforms()},_updateTransformsEnabled:function(){this._updateUsingTransforms()},_updateUsingTransforms:function(){var t=this.usingTransforms=this.options.transformsEnabled&&r.csstransforms&&r.csstransitions&&!this.isUsingJQueryAnimation;t||(delete this.options.hiddenStyle.scale,delete this.options.visibleStyle.scale),this.getPositionStyles=t?this._translate:this._positionAbs},_filter:function(t){var e=""===this.options.filter?"*":this.options.filter;if(!e)return t;var n=this.options.hiddenClass,i="."+n,r=t.filter(i),o=r;if("*"!==e){o=r.filter(e);var s=t.not(i).not(e).addClass(n);this.styleQueue.push({$el:s,style:this.options.hiddenStyle})}return this.styleQueue.push({$el:o,style:this.options.visibleStyle}),o.removeClass(n),t.filter(e)},updateSortData:function(t,n){var i,r,o=this,s=this.options.getSortData;t.each(function(){i=e(this),r={};for(var t in s)r[t]=n||"original-order"!==t?s[t](i,o):e.data(this,"isotope-sort-data")[t];e.data(this,"isotope-sort-data",r)})},_sort:function(){var t=this.options.sortBy,e=this._getSorter,n=this.options.sortAscending?1:-1,i=function(i,r){var o=e(i,t),s=e(r,t);return o===s&&"original-order"!==t&&(o=e(i,"original-order"),s=e(r,"original-order")),(o>s?1:s>o?-1:0)*n};this.$filteredAtoms.sort(i)},_getSorter:function(t,n){return e.data(t,"isotope-sort-data")[n]},_translate:function(t,e){return{translate:[t,e]}},_positionAbs:function(t,e){return{left:t,top:e}},_pushPosition:function(t,e,n){e=Math.round(e+this.offset.left),n=Math.round(n+this.offset.top);var i=this.getPositionStyles(e,n);this.styleQueue.push({$el:t,style:i}),this.options.itemPositionDataEnabled&&t.data("isotope-item-position",{x:e,y:n})},layout:function(t,e){var n=this.options.layoutMode;if(this["_"+n+"Layout"](t),this.options.resizesContainer){var i=this["_"+n+"GetContainerSize"]();this.styleQueue.push({$el:this.element,style:i})}this._processStyleQueue(t,e),this.isLaidOut=!0},_processStyleQueue:function(t,n){var i,o,s,a,u=this.isLaidOut?this.isUsingJQueryAnimation?"animate":"css":"css",c=this.options.animationOptions,l=this.options.onLayout;if(o=function(t,e){e.$el[u](e.style,c)},this._isInserting&&this.isUsingJQueryAnimation)o=function(t,e){i=e.$el.hasClass("no-transition")?"css":u,e.$el[i](e.style,c)};else if(n||l||c.complete){var h=!1,p=[n,l,c.complete],f=this;if(s=!0,a=function(){if(!h){for(var e,n=0,i=p.length;i>n;n++)e=p[n],"function"==typeof e&&e.call(f.element,t,f);h=!0}},this.isUsingJQueryAnimation&&"animate"===u)c.complete=a,s=!1;else if(r.csstransitions){for(var d,v=0,y=this.styleQueue[0],_=y&&y.$el;!_||!_.length;){if(d=this.styleQueue[v++],!d)return;_=d.$el}var b=parseFloat(getComputedStyle(_[0])[m]);b>0&&(o=function(t,e){e.$el[u](e.style,c).one(g,a)},s=!1)}}e.each(this.styleQueue,o),s&&a(),this.styleQueue=[]},resize:function(){this["_"+this.options.layoutMode+"ResizeChanged"]()&&this.reLayout()},reLayout:function(t){this["_"+this.options.layoutMode+"Reset"](),this.layout(this.$filteredAtoms,t)},addItems:function(t,e){var n=this._getAtoms(t);this.$allAtoms=this.$allAtoms.add(n),e&&e(n)},insert:function(t,e){this.element.append(t);var n=this;this.addItems(t,function(t){var i=n._filter(t);n._addHideAppended(i),n._sort(),n.reLayout(),n._revealAppended(i,e)})},appended:function(t,e){var n=this;this.addItems(t,function(t){n._addHideAppended(t),n.layout(t),n._revealAppended(t,e)})},_addHideAppended:function(t){this.$filteredAtoms=this.$filteredAtoms.add(t),t.addClass("no-transition"),this._isInserting=!0,this.styleQueue.push({$el:t,style:this.options.hiddenStyle})},_revealAppended:function(t,e){var n=this;setTimeout(function(){t.removeClass("no-transition"),n.styleQueue.push({$el:t,style:n.options.visibleStyle}),n._isInserting=!1,n._processStyleQueue(t,e)},10)},reloadItems:function(){this.$allAtoms=this._getAtoms(this.element.children())},remove:function(t,e){var n=this,i=function(){n.$allAtoms=n.$allAtoms.not(t),t.remove(),e&&e.call(n.element)};t.filter(":not(."+this.options.hiddenClass+")").length?(this.styleQueue.push({$el:t,style:this.options.hiddenStyle}),this.$filteredAtoms=this.$filteredAtoms.not(t),this._sort(),this.reLayout(i)):i()},shuffle:function(t){this.updateSortData(this.$allAtoms),this.options.sortBy="random",this._sort(),this.reLayout(t)},destroy:function(){var t=this.usingTransforms,e=this.options;this.$allAtoms.removeClass(e.hiddenClass+" "+e.itemClass).each(function(){var e=this.style;e.position="",e.top="",e.left="",e.opacity="",t&&(e[u]="")});var n=this.element[0].style;for(var i in this.originalStyle)n[i]=this.originalStyle[i];this.element.unbind(".isotope").undelegate("."+e.hiddenClass,"click").removeClass(e.containerClass).removeData("isotope"),b.unbind(".isotope")},_getSegments:function(t){var e,n=this.options.layoutMode,i=t?"rowHeight":"columnWidth",r=t?"height":"width",s=t?"rows":"cols",a=this.element[r](),u=this.options[n]&&this.options[n][i]||this.$filteredAtoms["outer"+o(r)](!0)||a;e=Math.floor(a/u),e=Math.max(e,1),this[n][s]=e,this[n][i]=u},_checkIfSegmentsChanged:function(t){var e=this.options.layoutMode,n=t?"rows":"cols",i=this[e][n];return this._getSegments(t),this[e][n]!==i},_masonryReset:function(){this.masonry={},this._getSegments();var t=this.masonry.cols;for(this.masonry.colYs=[];t--;)this.masonry.colYs.push(0)},_masonryLayout:function(t){var n=this,i=n.masonry;t.each(function(){var t=e(this),r=Math.ceil(t.outerWidth(!0)/i.columnWidth);if(r=Math.min(r,i.cols),1===r)n._masonryPlaceBrick(t,i.colYs);else{var o,s,a=i.cols+1-r,u=[];for(s=0;a>s;s++)o=i.colYs.slice(s,s+r),u[s]=Math.max.apply(Math,o);n._masonryPlaceBrick(t,u)}})},_masonryPlaceBrick:function(t,e){for(var n=Math.min.apply(Math,e),i=0,r=0,o=e.length;o>r;r++)if(e[r]===n){i=r;break}var s=this.masonry.columnWidth*i,a=n;this._pushPosition(t,s,a);var u=n+t.outerHeight(!0),c=this.masonry.cols+1-o;for(r=0;c>r;r++)this.masonry.colYs[i+r]=u},_masonryGetContainerSize:function(){var t=Math.max.apply(Math,this.masonry.colYs);return{height:t}},_masonryResizeChanged:function(){return this._checkIfSegmentsChanged()},_fitRowsReset:function(){this.fitRows={x:0,y:0,height:0}},_fitRowsLayout:function(t){var n=this,i=this.element.width(),r=this.fitRows;t.each(function(){var t=e(this),o=t.outerWidth(!0),s=t.outerHeight(!0);0!==r.x&&o+r.x>i&&(r.x=0,r.y=r.height),n._pushPosition(t,r.x,r.y),r.height=Math.max(r.y+s,r.height),r.x+=o})},_fitRowsGetContainerSize:function(){return{height:this.fitRows.height}},_fitRowsResizeChanged:function(){return!0},_cellsByRowReset:function(){this.cellsByRow={index:0},this._getSegments(),this._getSegments(!0)},_cellsByRowLayout:function(t){var n=this,i=this.cellsByRow;t.each(function(){var t=e(this),r=i.index%i.cols,o=Math.floor(i.index/i.cols),s=(r+.5)*i.columnWidth-t.outerWidth(!0)/2,a=(o+.5)*i.rowHeight-t.outerHeight(!0)/2;n._pushPosition(t,s,a),i.index++})},_cellsByRowGetContainerSize:function(){return{height:Math.ceil(this.$filteredAtoms.length/this.cellsByRow.cols)*this.cellsByRow.rowHeight+this.offset.top}},_cellsByRowResizeChanged:function(){return this._checkIfSegmentsChanged()},_straightDownReset:function(){this.straightDown={y:0}},_straightDownLayout:function(t){var n=this;t.each(function(){var t=e(this);n._pushPosition(t,0,n.straightDown.y),n.straightDown.y+=t.outerHeight(!0)})},_straightDownGetContainerSize:function(){return{height:this.straightDown.y}},_straightDownResizeChanged:function(){return!0},_masonryHorizontalReset:function(){this.masonryHorizontal={},this._getSegments(!0);var t=this.masonryHorizontal.rows;for(this.masonryHorizontal.rowXs=[];t--;)this.masonryHorizontal.rowXs.push(0)},_masonryHorizontalLayout:function(t){var n=this,i=n.masonryHorizontal;t.each(function(){var t=e(this),r=Math.ceil(t.outerHeight(!0)/i.rowHeight);if(r=Math.min(r,i.rows),1===r)n._masonryHorizontalPlaceBrick(t,i.rowXs);else{var o,s,a=i.rows+1-r,u=[];for(s=0;a>s;s++)o=i.rowXs.slice(s,s+r),u[s]=Math.max.apply(Math,o);n._masonryHorizontalPlaceBrick(t,u)}})},_masonryHorizontalPlaceBrick:function(t,e){for(var n=Math.min.apply(Math,e),i=0,r=0,o=e.length;o>r;r++)if(e[r]===n){i=r;break}var s=n,a=this.masonryHorizontal.rowHeight*i;this._pushPosition(t,s,a);var u=n+t.outerWidth(!0),c=this.masonryHorizontal.rows+1-o;for(r=0;c>r;r++)this.masonryHorizontal.rowXs[i+r]=u},_masonryHorizontalGetContainerSize:function(){var t=Math.max.apply(Math,this.masonryHorizontal.rowXs);return{width:t}},_masonryHorizontalResizeChanged:function(){return this._checkIfSegmentsChanged(!0)},_fitColumnsReset:function(){this.fitColumns={x:0,y:0,width:0}},_fitColumnsLayout:function(t){var n=this,i=this.element.height(),r=this.fitColumns;t.each(function(){var t=e(this),o=t.outerWidth(!0),s=t.outerHeight(!0);0!==r.y&&s+r.y>i&&(r.x=r.width,r.y=0),n._pushPosition(t,r.x,r.y),r.width=Math.max(r.x+o,r.width),r.y+=s})},_fitColumnsGetContainerSize:function(){return{width:this.fitColumns.width}},_fitColumnsResizeChanged:function(){return!0},_cellsByColumnReset:function(){this.cellsByColumn={index:0},this._getSegments(),this._getSegments(!0)},_cellsByColumnLayout:function(t){var n=this,i=this.cellsByColumn;t.each(function(){var t=e(this),r=Math.floor(i.index/i.rows),o=i.index%i.rows,s=(r+.5)*i.columnWidth-t.outerWidth(!0)/2,a=(o+.5)*i.rowHeight-t.outerHeight(!0)/2;n._pushPosition(t,s,a),i.index++})},_cellsByColumnGetContainerSize:function(){return{width:Math.ceil(this.$filteredAtoms.length/this.cellsByColumn.rows)*this.cellsByColumn.columnWidth}},_cellsByColumnResizeChanged:function(){return this._checkIfSegmentsChanged(!0)},_straightAcrossReset:function(){this.straightAcross={x:0}},_straightAcrossLayout:function(t){var n=this;t.each(function(){var t=e(this);n._pushPosition(t,n.straightAcross.x,0),n.straightAcross.x+=t.outerWidth(!0)})},_straightAcrossGetContainerSize:function(){return{width:this.straightAcross.x}},_straightAcrossResizeChanged:function(){return!0}};var w=function(e){t.console&&t.console.error(e)};e.fn.isotope=function(t,n){if("string"==typeof t){var i=Array.prototype.slice.call(arguments,1);this.each(function(){var n=e.data(this,"isotope");return n?e.isFunction(n[t])&&"_"!==t.charAt(0)?(n[t].apply(n,i),undefined):(w("no such method '"+t+"' for isotope instance"),undefined):(w("cannot call methods on isotope prior to initialization; attempted to call method '"+t+"'"),undefined)})}else this.each(function(){var i=e.data(this,"isotope");i?(i.option(t),i._init(n)):e.data(this,"isotope",new e.Isotope(t,this,n))});return this}}(window,jQuery),define("plugins/jquery.isotope",["plugins/jquery.imagesloaded"],function(){}),define("cell",["underscore","backbone","tpl!templates/cell.ejs","plugins/jquery.isotope","plugins/jquery.imagesloaded"],function(t,e,n){var i=e.View.extend({tagName:"article",className:"span2",initialize:function(){if(!this.model)throw Error("You must provide a model");this.model.on("change:cover_url",t.once(this.addToGrid),this),10>this.model.collection.indexOf(this.model)&&(this.model.get("url")?this.backgroundRender():this.model.on("change:url",t.once(this.backgroundRender),this))},updateProgress:function(t){this.$(".progress").css("width",t)},backgroundRender:function(){var t,e=this.model.get("url"),n=this;if(void 0===e)throw Error("The model needs a url attribute to do this");this.$("img").imagesLoaded(function(){n.full_img=new Image,n.full_img.src=e,n.updateProgress("25%");var i=n.loaded=$(n.full_img).imagesLoaded();i.done(function(){t&&clearTimeout(t),n.updateProgress("100%"),delete n.full_img}),i.progress&&i.progress(function(){var e=50;n.updateProgress(e+"%");var i=function(){99!==e&&(n.updateProgress((e+=1)+"%"),t=setTimeout(i,30))}()})})},render:function(){this.$el.html(n(this.model.toJSON()))},addToGrid:function(){var t=this;this.render(),this.$el.imagesLoaded(function(){$("#gif-grid").isotope("insert",t.$el)})},events:{'click [data-action="play"]':"play",'click [data-action="pause"]':"pause",'click [data-action="fullscreen"]':"fullScreen",'click [data-action="delete"]':"destroy","dblclick img":"fullScreen",mouseover:"backgroundRender"},fullScreen:function(){this.is_playing||this.play();var t=Modernizr.prefixed("RequestFullScreen",this.$("img")[0]);return t&&t(),!1},aniMagic:function(){return this.is_playing?this.pause():this.play()},play:function(t){var e=this.$("img"),n=this.model.get("url");return void 0===n?!1:(e.attr("src",n),this.is_playing=!0,$(t.currentTarget).attr({"data-action":"pause","class":"icon-pause"}),!1)},pause:function(t){var e=this.$("img"),n=this.model.get("cover_url");return void 0===n?!1:(e.attr("src",n),this.is_playing=!1,$(t.currentTarget).attr({"data-action":"play","class":"icon-play"}),!1)},destroy:function(){var t=this;return this.model.destroy().done(function(){$("#gif-grid").isotope("remove",t.$el,function(){t.remove()})}),!1}});return i}),define("upload",["underscore"],function(t){function e(t){if(!t||!t.collection)throw Error("Must provide a well-formed view");this.view=t,document.addEventListener("dragenter",function(t){t.preventDefault(),t.stopPropagation()},!1),document.addEventListener("dragover",function(t){t.preventDefault(),t.stopPropagation()},!1);var e=this;document.addEventListener("drop",function(){e.dropHandler.apply(e,arguments)},!1)}return e.prototype.dropHandler=function(e){function n(t){if(r.test(t.type)){var e=new FileReader,n=$.Deferred(),o=new FormData;return o.append("files",t),e.onload=function(t){for(var e=t.target.result,r=new Uint8Array(e),s=r.length,a=0,u=0,c=s-9;c>u&&2>a;u++)0!==r[u]||33!==r[u+1]||249!==r[u+2]||4!==r[u+3]||0!==r[u+8]||44!==r[u+9]&&33!==r[u+9]||a++;return 2>a?(n.reject(),void 0):($.ajax({url:"/upload",type:"post",cache:!1,processData:!1,contentType:!1,data:o,headers:{"x-csrf-token":$('input[name="_csrf"]').val()}}).then(function(t){n.resolve(),i.view.collection.add(t)},function(){n.reject()}),void 0)},e.readAsArrayBuffer(t),n.promise()}}e.stopPropagation(),e.preventDefault();var i=this,r=/gif/,o=e.dataTransfer.files;o.length&&$("#loader").addClass("js-show"),$.when.apply(null,t.map(o,n)).always(function(){$("#loader").removeClass("js-show")})},e}),define("grid",["underscore","backbone","cell","upload","plugins/jquery.isotope","plugins/jquery.imagesloaded"],function(t,e,n,i){var r=e.View.extend({el:$("#gif-grid"),initialize:function(){var t=this;if(!this.collection)throw Error("You must provide a collection");this.collection.view=this,this.collection.on("add",function(t){var e=this.collection.get(t.cid);e.view=new n({model:e}),e.get("cover_url")&&e.view.addToGrid()},this),this.collection.fetch().done(function(){t.collection.each(function(e){var i=t.$('[data-id="'+e.id+'"]');i.length&&(e.view=new n({model:e,el:i.parent()}))}),t.render()}),this.uploader=new i(this)},render:function(){var n=this;n.$el.imagesLoaded(function(){n.$el.isotope({itemSelector:"article",getSortData:{createdAt:function(t){var e=n.collection.get(t.find("figure").data("id"));return-e.get("createdAt")}},sortBy:"createdAt"})});var i=$(window),r=i.height(),o=!1,s=i.scrollTop(),a=t.debounce(function(){n.collection.current_page+=1,$.getJSON(n.collection.url(),function(t){return t.length?(e.history.navigate("page/"+n.collection.current_page),n.collection.add(t),void 0):(n.collection.current_page--,o=!0,void 0)})},2e3,!0);i.on("scroll",function(){var t=i.scrollTop();!o&&t+r>=n.$el.height()-300&&a(),s=t})}});return r}),define("router",["require","exports","module","backbone","grid"],function(t,e,n){var i=t("backbone"),r=t("grid");n.exports=i.Router.extend({initialize:function(t){if(!t.app)throw Error("Requires an `app` instance.");this.app=t.app},routes:{"":"loadGrid","page/:page":"loadGrid"},loadGrid:function(t){t&&(this.app.media.current_page=parseInt(t,10)),this.app.grid||(this.app.grid=new r({collection:this.app.media,socket:this.app.socket}))}})}),define("gifly",["require","exports","module","backbone","vendor/engine.io","media_collection","router"],function(t,e,n){var i=t("backbone"),r=t("vendor/engine.io"),o=t("media_collection"),s=t("router");n.exports=i.View.extend({el:$("body"),initialize:function(){window.gifly=this,window.Modernizr.touch&&scrollTo(0,1),this.socket=new r.Socket({host:location.hostname,port:location.port}),this.media=new o({app:this}),this.router=new s({app:this})},events:{'click [data-action="readme"]':"toggleReadme"},toggleReadme:function(){return this.$("> section").toggleClass("js-show"),!1}})}),define("main",["require","exports","module","backbone","gifly"],function(t){var e=t("backbone"),n=t("gifly");$(function(){new n,e.history.start({pushState:!0})})}),require.config({deps:["main"],paths:{vendor:"../assets/js/vendor",plugins:"../assets/js/plugins",backbone:"components/backbone/backbone",underscore:"../assets/js/vendor/lodash",tpl:"../assets/js/plugins/tpl",text:"../assets/js/plugins/text",json:"../assets/js/plugins/json"},shim:{backbone:{exports:"Backbone",deps:["underscore"]},"vendor/engine.io":{exports:"eio"},"plugins/jquery.deparam":[],"plugins/jquery.isotope":{deps:["plugins/jquery.imagesloaded"]}}}),define("config",function(){});