/**
 * almond 0.1.3 Copyright (c) 2011, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/jrburke/almond for details
 */
//Going sloppy to avoid 'use strict' string cost, but strict practices should
//be followed.
/*jslint sloppy: true */
/*global setTimeout: false */

var requirejs, require, define;
(function (undef) {
    var main, req,
        defined = {},
        waiting = {},
        config = {},
        defining = {},
        aps = [].slice;

    /**
     * Given a relative module name, like ./something, normalize it to
     * a real name that can be mapped to a path.
     * @param {String} name the relative name
     * @param {String} baseName a real name that the name arg is relative
     * to.
     * @returns {String} normalized name
     */
    function normalize(name, baseName) {
        var nameParts, nameSegment, mapValue, foundMap,
            foundI, foundStarMap, starI, i, j, part,
            baseParts = baseName && baseName.split("/"),
            map = config.map,
            starMap = (map && map['*']) || {};

        //Adjust any relative paths.
        if (name && name.charAt(0) === ".") {
            //If have a base name, try to normalize against it,
            //otherwise, assume it is a top-level require that will
            //be relative to baseUrl in the end.
            if (baseName) {
                //Convert baseName to array, and lop off the last part,
                //so that . matches that "directory" and not name of the baseName's
                //module. For instance, baseName of "one/two/three", maps to
                //"one/two/three.js", but we want the directory, "one/two" for
                //this normalization.
                baseParts = baseParts.slice(0, baseParts.length - 1);

                name = baseParts.concat(name.split("/"));

                //start trimDots
                for (i = 0; i < name.length; i += 1) {
                    part = name[i];
                    if (part === ".") {
                        name.splice(i, 1);
                        i -= 1;
                    } else if (part === "..") {
                        if (i === 1 && (name[2] === '..' || name[0] === '..')) {
                            //End of the line. Keep at least one non-dot
                            //path segment at the front so it can be mapped
                            //correctly to disk. Otherwise, there is likely
                            //no path mapping for a path starting with '..'.
                            //This can still fail, but catches the most reasonable
                            //uses of ..
                            return true;
                        } else if (i > 0) {
                            name.splice(i - 1, 2);
                            i -= 2;
                        }
                    }
                }
                //end trimDots

                name = name.join("/");
            }
        }

        //Apply map config if available.
        if ((baseParts || starMap) && map) {
            nameParts = name.split('/');

            for (i = nameParts.length; i > 0; i -= 1) {
                nameSegment = nameParts.slice(0, i).join("/");

                if (baseParts) {
                    //Find the longest baseName segment match in the config.
                    //So, do joins on the biggest to smallest lengths of baseParts.
                    for (j = baseParts.length; j > 0; j -= 1) {
                        mapValue = map[baseParts.slice(0, j).join('/')];

                        //baseName segment has  config, find if it has one for
                        //this name.
                        if (mapValue) {
                            mapValue = mapValue[nameSegment];
                            if (mapValue) {
                                //Match, update name to the new value.
                                foundMap = mapValue;
                                foundI = i;
                                break;
                            }
                        }
                    }
                }

                if (foundMap) {
                    break;
                }

                //Check for a star map match, but just hold on to it,
                //if there is a shorter segment match later in a matching
                //config, then favor over this star map.
                if (!foundStarMap && starMap && starMap[nameSegment]) {
                    foundStarMap = starMap[nameSegment];
                    starI = i;
                }
            }

            if (!foundMap && foundStarMap) {
                foundMap = foundStarMap;
                foundI = starI;
            }

            if (foundMap) {
                nameParts.splice(0, foundI, foundMap);
                name = nameParts.join('/');
            }
        }

        return name;
    }

    function makeRequire(relName, forceSync) {
        return function () {
            //A version of a require function that passes a moduleName
            //value for items that may need to
            //look up paths relative to the moduleName
            return req.apply(undef, aps.call(arguments, 0).concat([relName, forceSync]));
        };
    }

    function makeNormalize(relName) {
        return function (name) {
            return normalize(name, relName);
        };
    }

    function makeLoad(depName) {
        return function (value) {
            defined[depName] = value;
        };
    }

    function callDep(name) {
        if (waiting.hasOwnProperty(name)) {
            var args = waiting[name];
            delete waiting[name];
            defining[name] = true;
            main.apply(undef, args);
        }

        if (!defined.hasOwnProperty(name)) {
            throw new Error('No ' + name);
        }
        return defined[name];
    }

    /**
     * Makes a name map, normalizing the name, and using a plugin
     * for normalization if necessary. Grabs a ref to plugin
     * too, as an optimization.
     */
    function makeMap(name, relName) {
        var prefix, plugin,
            index = name.indexOf('!');

        if (index !== -1) {
            prefix = normalize(name.slice(0, index), relName);
            name = name.slice(index + 1);
            plugin = callDep(prefix);

            //Normalize according
            if (plugin && plugin.normalize) {
                name = plugin.normalize(name, makeNormalize(relName));
            } else {
                name = normalize(name, relName);
            }
        } else {
            name = normalize(name, relName);
        }

        //Using ridiculous property names for space reasons
        return {
            f: prefix ? prefix + '!' + name : name, //fullName
            n: name,
            p: plugin
        };
    }

    function makeConfig(name) {
        return function () {
            return (config && config.config && config.config[name]) || {};
        };
    }

    main = function (name, deps, callback, relName) {
        var cjsModule, depName, ret, map, i,
            args = [],
            usingExports;

        //Use name if no relName
        relName = relName || name;

        //Call the callback to define the module, if necessary.
        if (typeof callback === 'function') {

            //Pull out the defined dependencies and pass the ordered
            //values to the callback.
            //Default to [require, exports, module] if no deps
            deps = !deps.length && callback.length ? ['require', 'exports', 'module'] : deps;
            for (i = 0; i < deps.length; i += 1) {
                map = makeMap(deps[i], relName);
                depName = map.f;

                //Fast path CommonJS standard dependencies.
                if (depName === "require") {
                    args[i] = makeRequire(name);
                } else if (depName === "exports") {
                    //CommonJS module spec 1.1
                    args[i] = defined[name] = {};
                    usingExports = true;
                } else if (depName === "module") {
                    //CommonJS module spec 1.1
                    cjsModule = args[i] = {
                        id: name,
                        uri: '',
                        exports: defined[name],
                        config: makeConfig(name)
                    };
                } else if (defined.hasOwnProperty(depName) || waiting.hasOwnProperty(depName)) {
                    args[i] = callDep(depName);
                } else if (map.p) {
                    map.p.load(map.n, makeRequire(relName, true), makeLoad(depName), {});
                    args[i] = defined[depName];
                } else if (!defining[depName]) {
                    throw new Error(name + ' missing ' + depName);
                }
            }

            ret = callback.apply(defined[name], args);

            if (name) {
                //If setting exports via "module" is in play,
                //favor that over return value and exports. After that,
                //favor a non-undefined return value over exports use.
                if (cjsModule && cjsModule.exports !== undef &&
                        cjsModule.exports !== defined[name]) {
                    defined[name] = cjsModule.exports;
                } else if (ret !== undef || !usingExports) {
                    //Use the return value from the function.
                    defined[name] = ret;
                }
            }
        } else if (name) {
            //May just be an object definition for the module. Only
            //worry about defining if have a module name.
            defined[name] = callback;
        }
    };

    requirejs = require = req = function (deps, callback, relName, forceSync, alt) {
        if (typeof deps === "string") {
            //Just return the module wanted. In this scenario, the
            //deps arg is the module name, and second arg (if passed)
            //is just the relName.
            //Normalize module name, if it contains . or ..
            return callDep(makeMap(deps, callback).f);
        } else if (!deps.splice) {
            //deps is a config object, not an array.
            config = deps;
            if (callback.splice) {
                //callback is an array, which means it is a dependency list.
                //Adjust args if there are dependencies
                deps = callback;
                callback = relName;
                relName = null;
            } else {
                deps = undef;
            }
        }

        //Support require(['a'])
        callback = callback || function () {};

        //If relName is a function, it is an errback handler,
        //so remove it.
        if (typeof relName === 'function') {
            relName = forceSync;
            forceSync = alt;
        }

        //Simulate async callback;
        if (forceSync) {
            main(undef, deps, callback, relName);
        } else {
            setTimeout(function () {
                main(undef, deps, callback, relName);
            }, 15);
        }

        return req;
    };

    /**
     * Just drops the config on the floor, but returns req in case
     * the config return value is used.
     */
    req.config = function (cfg) {
        config = cfg;
        return req;
    };

    define = function (name, deps, callback) {

        //This module may not have dependencies
        if (!deps.splice) {
            //deps is not an array, so probably means
            //an object literal or factory function for
            //the value. Adjust args.
            callback = deps;
            deps = [];
        }

        waiting[name] = [name, deps, callback];
    };

    define.amd = {
        jQuery: true
    };
}());

/*!
 Lo-Dash 0.6.1 lodash.com/license
 Underscore.js 1.3.3 github.com/documentcloud/underscore/blob/master/LICENSE
*/

//     (c) 2010-2012 Jeremy Ashkenas, DocumentCloud Inc.
//     Backbone may be freely distributed under the MIT license.
//     For all details and documentation:
//     http://backbonejs.org

/**
 * Parses an URI
 *
 * @author Steven Levithan <stevenlevithan.com> (MIT license)
 * @api private
 */

/**
 * Adapted from the official plugin text.js
 *
 * Uses UnderscoreJS micro-templates : http://documentcloud.github.com/underscore/#template
 * @author Julien Cabanès <julien@zeeagency.com>
 * @version 0.2
 * 
 * @license RequireJS text 0.24.0 Copyright (c) 2010-2011, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/jrburke/requirejs for details
 */

/*!
 * jQuery imagesLoaded plugin v2.0.1
 * http://github.com/desandro/imagesloaded
 *
 * MIT License. by Paul Irish et al.
 */

/*!
 * jQuery BBQ: Back Button & Query Library - v1.3pre - 8/26/2010
 * http://benalman.com/projects/jquery-bbq-plugin/
 * 
 * Copyright (c) 2010 "Cowboy" Ben Alman
 * Dual licensed under the MIT and GPL licenses.
 * http://benalman.com/about/license/
 */

/**
 * Isotope v1.5.19
 * An exquisite jQuery plugin for magical layouts
 * http://isotope.metafizzy.co
 *
 * Commercial use requires one-time license fee
 * http://metafizzy.co/#licenses
 *
 * Copyright 2012 David DeSandro / Metafizzy
 */

/*!
   * Modernizr v1.6ish: miniModernizr for Isotope
   * http://www.modernizr.com
   *
   * Developed by:
   * - Faruk Ates  http://farukat.es/
   * - Paul Irish  http://paulirish.com/
   *
   * Copyright (c) 2009-2010
   * Dual-licensed under the BSD or MIT licenses.
   * http://www.modernizr.com/license/
   */

/*
   * smartresize: debounced resize event for jQuery
   *
   * latest version and complete README available on Github:
   * https://github.com/louisremi/jquery.smartresize.js
   *
   * Copyright 2011 @louis_remi
   * Licensed under the MIT license.
   */

/*!
   * jQuery imagesLoaded plugin v1.1.0
   * http://github.com/desandro/imagesloaded
   *
   * MIT License. by Paul Irish et al.
   */

(function(e,t){function n(e){return new r(e)}function r(e){if(e&&e._wrapped)return e;this._wrapped=e}function i(e,t,n){t||(t=0);var r=e.length,i=r-t>=(n||V),s=i?{}:e;if(i)for(var o=t-1;++o<r;)n=e[o]+"",(ft.call(s,n)?s[n]:s[n]=[]).push(e[o]);return function(e){if(i){var n=e+"";return ft.call(s,n)&&-1<T(s[n],e)}return-1<T(s,e,t)}}function s(){for(var e,t,n,r=-1,i=arguments.length,s={e:"",f:"",j:"",q:"",c:{d:""},m:{d:""}};++r<i;)for(t in e=arguments[r],e)n=(n=e[t])==D?"":n,/d|i/.test(t)?("string"==typeof n&&(n={b:n,l:n}),s.c[t]=n.b||"",s.m[t]=n.l||""):s[t]=n;e=s.a,t=/^[^,]+/.exec(e)[0],n=s.s,s.g=t,s.h=Lt,s.k=Ft,s.n=Mt,s.p=st,s.r=s.r!==P,s.s=n==D?It:n,s.o==D&&(s.o=Pt),s.f||(s.f="if(!"+t+")return u");if("d"!=t||!s.c.i)s.c=D;t="",s.s&&(t+=""),t+="var i,A,j="+s.g+",u",s.j&&(t+="="+s.j),t+=";"+s.f+";"+s.q+";",s.c&&(t+="var l=j.length;i=-1;",s.m&&(t+="if(l>-1&&l===l>>>0){"),s.o&&(t+="if(z.call(j)==x){j=j.split('')}"),t+=s.c.d+";while(++i<l){A=j[i];"+s.c.i+"}",s.m&&(t+="}"));if(s.m){s.c?t+="else{":s.n&&(t+="var l=j.length;i=-1;if(l&&P(j)){while(++i<l){A=j[i+=''];"+s.m.i+"}}else{"),s.h||(t+="var v=typeof j=='function'&&r.call(j,'prototype');");if(s.k&&s.r)t+="var o=-1,p=Y[typeof j]?m(j):[],l=p.length;"+s.m.d+";while(++o<l){i=p[o];",s.h||(t+="if(!(v&&i=='prototype')){"),t+="A=j[i];"+s.m.i+"",s.h||(t+="}");else{t+=s.m.d+";for(i in j){";if(!s.h||s.r)t+="if(",s.h||(t+="!(v&&i=='prototype')"),!s.h&&s.r&&(t+="&&"),s.r&&(t+="g.call(j,i)"),t+="){";t+="A=j[i];"+s.m.i+";";if(!s.h||s.r)t+="}"}t+="}";if(s.h){t+="var f=j.constructor;";for(n=0;7>n;n++)t+="i='"+s.p[n]+"';if(","constructor"==s.p[n]&&(t+="!(f&&f.prototype===j)&&"),t+="g.call(j,i)){A=j[i];"+s.m.i+"}"}if(s.c||s.n)t+="}"}return t+=s.e+";return u",Function("D,E,F,I,e,K,g,h,N,P,R,T,U,k,X,Y,m,r,w,x,z","var G=function("+e+"){"+t+"};return G")(qt,q,A,o,at,un,ft,O,T,m,tn,g,y,l,xt,Wt,gt,ct,ht,Nt,pt)}function o(e,n){var r=e.b,i=n.b,e=e.a,n=n.a;return e===t?1:n===t?-1:e<n?-1:e>n?1:r<i?-1:1}function u(e,t){return ut[t]}function a(e){return"\\"+Xt[e]}function f(e){return Ut[e]}function l(e,t){return function(n,r,i){return e.call(t,n,r,i)}}function c(){}function h(e,t){if(e&&J.test(t))return"<e%-"+t+"%>";var n=ut.length;return ut[n]="'+__e("+t+")+'",ot+n}function p(e,t,n,r){return r?(e=ut.length,ut[e]="';"+r+";__p+='",ot+e):t?h(D,t):d(D,n)}function d(e,t){if(e&&J.test(t))return"<e%="+t+"%>";var n=ut.length;return ut[n]="'+((__t=("+t+"))==null?'':__t)+'",ot+n}function v(e){return zt[e]}function m(e){return pt.call(e)==yt}function g(e){return"function"==typeof e}function y(e,t){return e?e==U||e.__proto__==U&&(t||!m(e)):P}function b(e,t,n,r,i){if(e==D)return e;n&&(t=P),i||(i={d:D}),i.d==D&&(i.d=!(!R.clone&&!z.clone&&!W.clone));if(((n=Wt[typeof e])||i.d)&&e.clone&&g(e.clone))return i.d=D,e.clone(t);if(n){var s=pt.call(e);if(!Rt[s]||_t&&m(e))return e;var o=s==bt,n=o||(s==xt?y(e,_):n)}if(!n||!t)return n?o?ht.call(e):on({},e):e;n=e.constructor;switch(s){case wt:return new n(e==_);case Et:return new n(+e);case St:case Nt:return new n(e);case Tt:return n(e.source,Z.exec(e))}r||(r=[]);for(s=r.length;s--;)if(r[s].c==e)return r[s].d;var s=e.length,u=o?n(s):{};r.push({d:u,c:e});if(o)for(o=-1;++o<s;)u[o]=b(e[o],t,D,r,i);else an(e,function(e,n){u[n]=b(e,t,D,r,i)});return u}function w(e,t,n,r){if(e==D||t==D)return e===t;r||(r={value:D}),r.value==D&&(r.value=!(!R.isEqual&&!z.isEqual&&!W.isEqual));if(Wt[typeof e]||Wt[typeof t]||r.value){e._chain&&(e=e._wrapped),t._chain&&(t=t._wrapped);if(e.isEqual&&g(e.isEqual))return r.value=D,e.isEqual(t);if(t.isEqual&&g(t.isEqual))return r.value=D,t.isEqual(e)}if(e===t)return 0!==e||1/e==1/t;var i=pt.call(e);if(i!=pt.call(t))return P;switch(i){case wt:case Et:return+e==+t;case St:return e!=+e?t!=+t:0==e?1/e==1/t:e==+t;case Tt:case Nt:return e==t+""}var s=qt[i];if(_t&&!s&&(s=m(e))&&!m(t)||!s&&(i!=xt||Ht&&("function"!=typeof e.toString&&"string"==typeof (e+"")||"function"!=typeof t.toString&&"string"==typeof (t+""))))return P;n||(n=[]);for(i=n.length;i--;)if(n[i]==e)return _;var i=-1,o=_,u=0;n.push(e);if(s){u=e.length;if(o=u==t.length)for(;u--&&(o=w(e[u],t[u],n,r)););return o}s=e.constructor,o=t.constructor;if(s!=o&&(!g(s)||!(s instanceof s&&g(o)&&o instanceof o)))return P;for(var a in e)if(ft.call(e,a)&&(u++,!ft.call(t,a)||!w(e[a],t[a],n,r)))return P;for(a in t)if(ft.call(t,a)&&!(u--))return P;if(Lt)for(;7>++i;)if(a=st[i],ft.call(e,a)&&(!ft.call(t,a)||!w(e[a],t[a],n,r)))return P;return _}function E(e,t,n,r){if(!e)return n;var i=e.length,s=3>arguments.length;r&&(t=l(t,r));if(-1<i&&i===i>>>0){var o=Pt&&pt.call(e)==Nt?e.split(""):e;for(i&&s&&(n=o[--i]);i--;)n=t(n,o[i],i,e);return n}o=cn(e);for((i=o.length)&&s&&(n=e[o[--i]]);i--;)s=o[i],n=t(n,e[s],s,e);return n}function S(e,t,n){if(e)return t==D||n?e[0]:ht.call(e,0,t)}function x(e,t){var n=[];if(!e)return n;for(var r,i=-1,s=e.length;++i<s;)r=e[i],tn(r)?lt.apply(n,t?r:x(r)):n.push(r);return n}function T(e,t,n){if(!e)return-1;var r=-1,i=e.length;if(n){if("number"!=typeof n)return r=k(e,t),e[r]===t?r:-1;r=(0>n?Math.max(0,i+n):n)-1}for(;++r<i;)if(e[r]===t)return r;return-1}function N(e,t,n){var r=-Infinity,i=r;if(!e)return i;var s=-1,o=e.length;if(!t){for(;++s<o;)e[s]>i&&(i=e[s]);return i}for(n&&(t=l(t,n));++s<o;)n=t(e[s],s,e),n>r&&(r=n,i=e[s]);return i}function C(e,t,n){return e?ht.call(e,t==D||n?1:t):[]}function k(e,t,n,r){if(!e)return 0;var i=0,s=e.length;if(n){r&&(n=A(n,r));for(t=n(t);i<s;)r=i+s>>>1,n(e[r])<t?i=r+1:s=r}else for(;i<s;)r=i+s>>>1,e[r]<t?i=r+1:s=r;return i}function L(e,t,n,r){var i=[];if(!e)return i;var s=-1,o=e.length,u=[];"function"==typeof t&&(r=n,n=t,t=P);for(n?r&&(n=l(n,r)):n=O;++s<o;)if(r=n(e[s],s,e),t?!s||u[u.length-1]!==r:0>T(u,r))u.push(r),i.push(e[s]);return i}function A(e,t){function n(){var o=arguments,u=t;return i||(e=t[r]),s.length&&(o=o.length?s.concat(ht.call(o)):s),this instanceof n?(c.prototype=e.prototype,u=new c,(o=e.apply(u,o))&&Wt[typeof o]?o:u):e.apply(u,o)}var r,i=g(e);if(i){if(jt||dt&&2<arguments.length)return dt.call.apply(dt,arguments)}else r=t,t=e;var s=ht.call(arguments,2);return n}function O(e){return e}function M(e){wn(fn(e),function(t){var i=n[t]=e[t];r.prototype[t]=function(){var e=[this._wrapped];return arguments.length&&lt.apply(e,arguments),e=i.apply(n,e),this._chain&&(e=new r(e),e._chain=_),e}})}var _=!0,D=null,P=!1,H,B,j,F,I="object"==typeof exports&&exports&&("object"==typeof global&&global&&global==global.global&&(e=global),exports),q=Array.prototype,R=Boolean.prototype,U=Object.prototype,z=Number.prototype,W=String.prototype,X=0,V=30,$=e._,J=/[-+=!~*%&^<>|{(\/]|\[\D|\b(?:delete|in|instanceof|new|typeof|void)\b/,K=/&(?:amp|lt|gt|quot|#x27);/g,Q=/\b__p\+='';/g,G=/\b(__p\+=)''\+/g,Y=/(__e\(.*?\)|\b__t\))\+'';/g,Z=/\w*$/,et=/(?:__e|__t=)\(\s*(?![\d\s"']|this\.)/g,tt=RegExp("^"+(U.valueOf+"").replace(/[.*+?^=!:${}()|[\]\/\\]/g,"\\$&").replace(/valueOf|for [^\]]+/g,".+?")+"$"),nt=/__token__(\d+)/g,rt=/[&<>"']/g,it=/['\n\r\t\u2028\u2029\\]/g,st="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" "),ot="__token__",ut=[],at=q.concat,ft=U.hasOwnProperty,lt=q.push,ct=U.propertyIsEnumerable,ht=q.slice,pt=U.toString,dt=tt.test(dt=ht.bind)&&dt,vt=tt.test(vt=Array.isArray)&&vt,mt=e.isFinite,gt=tt.test(gt=Object.keys)&&gt,yt="[object Arguments]",bt="[object Array]",wt="[object Boolean]",Et="[object Date]",St="[object Number]",xt="[object Object]",Tt="[object RegExp]",Nt="[object String]",Ct=e.clearTimeout,kt=e.setTimeout,Lt,At,Ot,Mt=_;(function(){function e(){this.x=1}var t={0:1,length:1},n=[];e.prototype={valueOf:1,y:1};for(var r in new e)n.push(r);for(r in arguments)Mt=!r;Lt=4>(n+"").length,Ot="x"!=n[0],At=(n.splice.call(t,0,1),t[0])})(1);var _t=!m(arguments),Dt="x"!=ht.call("x")[0],Pt="xx"!="x"[0]+Object("x")[0];try{var Ht=("[object Object]",pt.call(e.document||0)==xt)}catch(Bt){}var jt=dt&&/\n|Opera/.test(dt+pt.call(e.opera)),Ft=gt&&/^.+$|true/.test(gt+!!e.attachEvent),It=!jt,qt={"[object Arguments]":_,"[object Array]":_,"[object Boolean]":P,"[object Date]":P,"[object Function]":P,"[object Number]":P,"[object Object]":P,"[object RegExp]":P,"[object String]":_},Rt={"[object Arguments]":P,"[object Array]":_,"[object Boolean]":_,"[object Date]":_,"[object Function]":P,"[object Number]":_,"[object Object]":_,"[object RegExp]":_,"[object String]":_},Ut={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;"},zt={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#x27;":"'"},Wt={"boolean":P,"function":_,object:_,number:P,string:P,"undefined":P,unknown:_},Xt={"\\":"\\","'":"'","\n":"n","\r":"r","	":"t","\u2028":"u2028","\u2029":"u2029"};n.templateSettings={escape:/<%-([\s\S]+?)%>/g,evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,variable:""};var Vt={a:"d,c,y",j:"d",q:"if(!c)c=h;else if(y)c=k(c,y)",i:"if(c(A,i,d)===false)return u"},$t={j:"{}",q:"var q;if(typeof c!='function'){var ii=c;c=function(A){return A[ii]}}else if(y)c=k(c,y)",i:"q=c(A,i,d);(g.call(u,q)?u[q]++:u[q]=1)"},Jt={r:P,a:"n,c,y",j:"{}",q:"var S=typeof c=='function';if(!S){var t=e.apply(E,arguments)}else if(y)c=k(c,y)",i:"if(S?!c(A,i,n):N(t,i)<0)u[i]=A"},Kt={j:"true",i:"if(!c(A,i,d))return!u"},Qt={r:P,s:P,a:"n",j:"n",q:"for(var a=1,b=arguments.length;a<b;a++){if(j=arguments[a]){",i:"u[i]=A",e:"}}"},Gt={j:"[]",i:"c(A,i,d)&&u.push(A)"},Yt={q:"if(y)c=k(c,y)"},Zt={i:{l:Vt.i}},en={j:"",f:"if(!d)return[]",d:{b:"u=Array(l)",l:"u="+(Ft?"Array(l)":"[]")},i:{b:"u[i]=c(A,i,d)",l:"u"+(Ft?"[o]=":".push")+"(c(A,i,d))"}};_t&&(m=function(e){return!!e&&!!ft.call(e,"callee")});var tn=vt||function(e){return pt.call(e)==bt};g(/x/)&&(g=function(e){return"[object Function]"==pt.call(e)}),y(Wt)||(y=function(e,t){var n=P;if(!e||"object"!=typeof e||!t&&m(e))return n;var r=e.constructor;return(!Ht||"function"==typeof e.toString||"string"!=typeof (e+""))&&(!g(r)||r instanceof r)?Ot?(un(e,function(t,r){return n=!ft.call(e,r),P}),n===P):(un(e,function(e,t){n=t}),n===P||ft.call(e,n)):n});var nn=s({a:"n",j:"[]",i:"u.push(i)"}),rn=s(Qt,{i:"if(u[i]==null)"+Qt.i}),sn=s(Jt),on=s(Qt),un=s(Vt,Yt,Zt,{r:P}),an=s(Vt,Yt,Zt),fn=s({r:P,a:"n",j:"[]",i:"if(T(A))u.push(i)",e:"u.sort()"}),ln=s({a:"A",j:"true",q:"var H=z.call(A),l=A.length;if(D[H]"+(_t?"||P(A)":"")+"||(H==X&&l>-1&&l===l>>>0&&T(A.splice)))return!l",i:{l:"return false"}}),cn=gt?function(e){var t=typeof e;return"function"==t&&ct.call(e,"prototype")?nn(e):e&&Wt[t]?gt(e):[]}:nn,hn=s(Qt,{a:"n,ee,O,ff",q:"var J,L,Q,gg,dd=O==U;if(!dd)ff=[];for(var a=1,b=dd?2:arguments.length;a<b;a++){if(j=arguments[a]){",i:"if(A&&((Q=R(A))||U(A))){L=false;gg=ff.length;while(gg--)if(L=ff[gg].c==A)break;if(L){u[i]=ff[gg].d}else{J=(J=u[i])&&Q?(R(J)?J:[]):(U(J)?J:{});ff.push({d:J,c:A});u[i]=G(J,A,U,ff)}}else if(A!=null)u[i]=A"}),pn=s(Jt,{q:"if(typeof c!='function'){var q,t=e.apply(E,arguments),l=t.length;for(i=1;i<l;i++){q=t[i];if(q in n)u[q]=n[q]}}else{if(y)c=k(c,y)",i:"if(c(A,i,n))u[i]=A",e:"}"}),dn=s({a:"n",j:"[]",i:"u.push(A)"}),vn=s({a:"d,hh",j:"false",o:P,d:{b:"if(z.call(d)==x)return d.indexOf(hh)>-1"},i:"if(A===hh)return true"}),mn=s(Vt,$t),gn=s(Vt,Kt),yn=s(Vt,Gt),bn=s(Vt,Yt,{j:"",i:"if(c(A,i,d))return A"}),wn=s(Vt,Yt),En=s(Vt,$t,{i:"q=c(A,i,d);(g.call(u,q)?u[q]:u[q]=[]).push(A)"}),Sn=s(en,{a:"d,V",q:"var C=w.call(arguments,2),S=typeof V=='function'",i:{b:"u[i]=(S?V:A[V]).apply(A,C)",l:"u"+(Ft?"[o]=":".push")+"((S?V:A[V]).apply(A,C))"}}),xn=s(Vt,en),Tn=s(en,{a:"d,bb",i:{b:"u[i]=A[bb]",l:"u"+(Ft?"[o]=":".push")+"(A[bb])"}}),Nn=s({a:"d,c,B,y",j:"B",q:"var W=arguments.length<3;if(y)c=k(c,y)",d:{b:"if(W)u=j[++i]"},i:{b:"u=c(u,A,i,d)",l:"u=W?(W=false,A):c(u,A,i,d)"}}),Cn=s(Vt,Gt,{i:"!"+Gt.i}),kn=s(Vt,Kt,{j:"false",i:Kt.i.replace("!","")}),Ln=s(Vt,$t,en,{i:{b:"u[i]={a:c(A,i,d),b:i,d:A}",l:"u"+(Ft?"[o]=":".push")+"({a:c(A,i,d),b:i,d:A})"},e:"u.sort(I);l=u.length;while(l--)u[l]=u[l].d"}),An=s(Gt,{a:"d,aa",q:"var t=[];K(aa,function(A,q){t.push(q)});var cc=t.length",i:"for(var q,Z=true,s=0;s<cc;s++){q=t[s];if(!(Z=A[q]===aa[q]))break}Z&&u.push(A)"}),On=s({r:P,s:P,a:"n",j:"n",q:"var M=arguments,l=M.length;if(l>1){for(var i=1;i<l;i++)u[M[i]]=F(u[M[i]],u);return u}",i:"if(T(u[i]))u[i]=F(u[i],u)"});n.VERSION="0.6.1",n.after=function(e,t){return 1>e?t():function(){if(1>--e)return t.apply(this,arguments)}},n.bind=A,n.bindAll=On,n.chain=function(e){return e=new r(e),e._chain=_,e},n.clone=b,n.compact=function(e){var t=[];if(!e)return t;for(var n=-1,r=e.length;++n<r;)e[n]&&t.push(e[n]);return t},n.compose=function(){var e=arguments;return function(){for(var t=arguments,n=e.length;n--;)t=[e[n].apply(this,t)];return t[0]}},n.contains=vn,n.countBy=mn,n.debounce=function(e,t,n){function r(){u=D,n||e.apply(o,i)}var i,s,o,u;return function(){var a=n&&!u;return i=arguments,o=this,Ct(u),u=kt(r,t),a&&(s=e.apply(o,i)),s}},n.defaults=rn,n.defer=function(e){var n=ht.call(arguments,1);return kt(function(){return e.apply(t,n)},1)},n.delay=function(e,n){var r=ht.call(arguments,2);return kt(function(){return e.apply(t,r)},n)},n.difference=function(e){var t=[];if(!e)return t;for(var n=-1,r=e.length,s=at.apply(t,arguments),s=i(s,r);++n<r;)s(e[n])||t.push(e[n]);return t},n.drop=sn,n.escape=function(e){return e==D?"":(e+"").replace(rt,f)},n.every=gn,n.extend=on,n.filter=yn,n.find=bn,n.first=S,n.flatten=x,n.forEach=wn,n.forIn=un,n.forOwn=an,n.functions=fn,n.groupBy=En,n.has=function(e,t){return e?ft.call(e,t):P},n.identity=O,n.indexOf=T,n.initial=function(e,t,n){return e?ht.call(e,0,-(t==D||n?1:t)):[]},n.intersection=function(e){var t=[];if(!e)return t;var n,r=arguments.length,s=[],o=-1,u=e.length;e:for(;++o<u;)if(n=e[o],0>T(t,n)){for(var a=1;a<r;a++)if(!(s[a]||(s[a]=i(arguments[a])))(n))continue e;t.push(n)}return t},n.invoke=Sn,n.isArguments=m,n.isArray=tn,n.isBoolean=function(e){return e===_||e===P||pt.call(e)==wt},n.isElement=function(e){return e?1===e.nodeType:P},n.isEmpty=ln,n.isEqual=w,n.isFinite=function(e){return mt(e)&&pt.call(e)==St},n.isFunction=g,n.isNaN=function(e){return pt.call(e)==St&&e!=+e},n.isNull=function(e){return e===D},n.isObject=function(e){return e?Wt[typeof e]:P},n.isUndefined=function(e){return e===t},n.keys=cn,n.last=function(e,t,n){if(e){var r=e.length;return t==D||n?e[r-1]:ht.call(e,-t||r)}},n.lastIndexOf=function(e,t,n){if(!e)return-1;var r=e.length;for(n&&"number"==typeof n&&(r=(0>n?Math.max(0,r+n):Math.min(n,r-1))+1);r--;)if(e[r]===t)return r;return-1},n.map=xn,n.max=N,n.memoize=function(e,t){var n={};return function(){var r=t?t.apply(this,arguments):arguments[0];return ft.call(n,r)?n[r]:n[r]=e.apply(this,arguments)}},n.merge=hn,n.min=function(e,t,n){var r=Infinity,i=r;if(!e)return i;var s=-1,o=e.length;if(!t){for(;++s<o;)e[s]<i&&(i=e[s]);return i}for(n&&(t=l(t,n));++s<o;)n=t(e[s],s,e),n<r&&(r=n,i=e[s]);return i},n.mixin=M,n.noConflict=function(){return e._=$,this},n.once=function(e){var t,n=P;return function(){return n?t:(n=_,t=e.apply(this,arguments),e=D,t)}},n.partial=function(e){var t=ht.call(arguments,1),n=t.length;return function(){var r;return r=arguments,r.length&&(t.length=n,lt.apply(t,r)),r=1==t.length?e.call(this,t[0]):e.apply(this,t),t.length=n,r}},n.pick=pn,n.pluck=Tn,n.range=function(e,t,n){e=+e||0,n=+n||1,t==D&&(t=e,e=0);for(var r=-1,t=Math.max(0,Math.ceil((t-e)/n)),i=Array(t);++r<t;)i[r]=e,e+=n;return i},n.reduce=Nn,n.reduceRight=E,n.reject=Cn,n.rest=C,n.result=function(e,t){if(!e)return D;var n=e[t];return g(n)?e[t]():n},n.shuffle=function(e){if(!e)return[];for(var t,n=-1,r=e.length,i=Array(r);++n<r;)t=Math.floor(Math.random()*(n+1)),i[n]=i[t],i[t]=e[n];return i},n.size=function(e){if(!e)return 0;var t=pt.call(e),n=e.length;return qt[t]||_t&&m(e)||t==xt&&-1<n&&n===n>>>0&&g(e.splice)?n:cn(e).length},n.some=kn,n.sortBy=Ln,n.sortedIndex=k,n.tap=function(e,t){return t(e),e},n.template=function(e,t,r){r||(r={});var e=e+"",i,s;i=r.escape;var o=r.evaluate,f=r.interpolate,l=n.templateSettings,c=r=r.variable||l.variable;i==D&&(i=l.escape),o==D&&(o=l.evaluate||P),f==D&&(f=l.interpolate),i&&(e=e.replace(i,h)),f&&(e=e.replace(f,d)),o!=H&&(H=o,F=RegExp("<e%-([\\s\\S]+?)%>|<e%=([\\s\\S]+?)%>"+(o?"|"+o.source:""),"g")),i=ut.length,e=e.replace(F,p),i=i!=ut.length,e="__p += '"+e.replace(it,a).replace(nt,u)+"';",ut.length=0,c||(r=B||"obj",i?e="with("+r+"){"+e+"}":(r!=B&&(B=r,j=RegExp("(\\(\\s*)"+r+"\\."+r+"\\b","g")),e=e.replace(et,"$&"+r+".").replace(j,"$1__d"))),e=(i?e.replace(Q,""):e).replace(G,"$1").replace(Y,"$1;"),e="function("+r+"){"+(c?"":r+"||("+r+"={});")+"var __t,__p='',__e=_.escape"+(i?",__j=Array.prototype.join;function print(){__p+=__j.call(arguments,'')}":(c?"":",__d="+r+"."+r+"||"+r)+";")+e+"return __p}";try{s=Function("_","return "+e)(n)}catch(v){s=function(){throw v}}return t?s(t):(s.source=e,s)},n.throttle=function(e,t){function n(){u=new Date,o=D,e.apply(s,r)}var r,i,s,o,u=0;return function(){var a=new Date,f=t-(a-u);return r=arguments,s=this,0>=f?(u=a,i=e.apply(s,r)):o||(o=kt(n,f)),i}},n.times=function(e,t,n){var r=-1;if(n)for(;++r<e;)t.call(n,r);else for(;++r<e;)t(r)},n.toArray=function(e){if(!e)return[];if(e.toArray&&g(e.toArray))return e.toArray();var t=e.length;return-1<t&&t===t>>>0?(Dt?pt.call(e)==Nt:"string"==typeof e)?e.split(""):ht.call(e):dn(e)},n.unescape=function(e){return e==D?"":(e+"").replace(K,v)},n.union=function(){for(var e=-1,t=[],n=at.apply(t,arguments),r=n.length;++e<r;)0>T(t,n[e])&&t.push(n[e]);return t},n.uniq=L,n.uniqueId=function(e){var t=X++;return e?e+t:t},n.values=dn,n.where=An,n.without=function(e){var t=[];if(!e)return t;for(var n=-1,r=e.length,s=i(arguments,1,20);++n<r;)s(e[n])||t.push(e[n]);return t},n.wrap=function(e,t){return function(){var n=[e];return arguments.length&&lt.apply(n,arguments),t.apply(this,n)}},n.zip=function(e){if(!e)return[];for(var t=-1,n=N(Tn(arguments,"length")),r=Array(n);++t<n;)r[t]=Tn(arguments,t);return r},n.zipObject=function(e,t){if(!e)return{};var n=-1,r=e.length,i={};for(t||(t=[]);++n<r;)i[e[n]]=t[n];return i},n.all=gn,n.any=kn,n.collect=xn,n.detect=bn,n.each=wn,n.foldl=Nn,n.foldr=E,n.head=S,n.include=vn,n.inject=Nn,n.methods=fn,n.omit=sn,n.select=yn,n.tail=C,n.take=S,n.unique=L,wn({Date:Et,Number:St,RegExp:Tt,String:Nt},function(e,t){n["is"+t]=function(t){return pt.call(t)==e}}),r.prototype=n.prototype,M(n),r.prototype.chain=function(){return this._chain=_,this},r.prototype.value=function(){return this._wrapped},wn("pop push reverse shift sort splice unshift".split(" "),function(e){var t=q[e];r.prototype[e]=function(){var e=this._wrapped;return t.apply(e,arguments),At&&e.length===0&&delete e[0],this._chain&&(e=new r(e),e._chain=_),e}}),wn(["concat","join","slice"],function(e){var t=q[e];r.prototype[e]=function(){var e=t.apply(this._wrapped,arguments);return this._chain&&(e=new r(e),e._chain=_),e}}),typeof define=="function"&&typeof define.amd=="object"&&define.amd?(e._=n,define("underscore",[],function(){return n})):I?"object"==typeof module&&module&&module.t==I?(module.t=n)._=n:I._=n:e._=n})(this),function(){var e=this,t=e.Backbone,n=Array.prototype.splice,r;typeof exports!="undefined"?r=exports:r=e.Backbone={},r.VERSION="0.9.2";var i=e._;!i&&typeof require!="undefined"&&(i=require("underscore")),r.$=e.jQuery||e.Zepto||e.ender,r.noConflict=function(){return e.Backbone=t,this},r.emulateHTTP=!1,r.emulateJSON=!1;var s=/\s+/,o=r.Events={on:function(e,t,n){var r,i,o;if(!t)return this;e=e.split(s),r=this._callbacks||(this._callbacks={});while(i=e.shift())o=r[i]||(r[i]=[]),o.push(t,n);return this},off:function(e,t,n){var r,o,u,a;if(!(o=this._callbacks))return this;if(!(e||t||n))return delete this._callbacks,this;e=e?e.split(s):i.keys(o);while(r=e.shift()){if(!(u=o[r])||!t&&!n){delete o[r];continue}for(a=u.length-2;a>=0;a-=2)t&&u[a]!==t||n&&u[a+1]!==n||u.splice(a,2)}return this},trigger:function(e){var t,n,r,i,o,u,a,f;if(!(n=this._callbacks))return this;f=[],e=e.split(s);for(i=1,o=arguments.length;i<o;i++)f[i-1]=arguments[i];while(t=e.shift()){if(a=n.all)a=a.slice();if(r=n[t])r=r.slice();if(r)for(i=0,o=r.length;i<o;i+=2)r[i].apply(r[i+1]||this,f);if(a){u=[t].concat(f);for(i=0,o=a.length;i<o;i+=2)a[i].apply(a[i+1]||this,u)}}return this}};o.bind=o.on,o.unbind=o.off;var u=r.Model=function(e,t){var n;e||(e={}),t&&t.collection&&(this.collection=t.collection),t&&t.parse&&(e=this.parse(e));if(n=N(this,"defaults"))e=i.extend({},n,e);this.attributes={},this._escapedAttributes={},this.cid=i.uniqueId("c"),this.changed={},this._silent={},this._pending={},this.set(e,{silent:!0}),this.changed={},this._silent={},this._pending={},this._previousAttributes=i.clone(this.attributes),this.initialize.apply(this,arguments)};i.extend(u.prototype,o,{changed:null,_silent:null,_pending:null,idAttribute:"id",initialize:function(){},toJSON:function(e){return i.clone(this.attributes)},sync:function(){return r.sync.apply(this,arguments)},get:function(e){return this.attributes[e]},escape:function(e){var t;if(t=this._escapedAttributes[e])return t;var n=this.get(e);return this._escapedAttributes[e]=i.escape(n==null?"":""+n)},has:function(e){return this.get(e)!=null},set:function(e,t,n){var r,s,o;i.isObject(e)||e==null?(r=e,n=t):(r={},r[e]=t),n||(n={});if(!r)return this;r instanceof u&&(r=r.attributes);if(n.unset)for(s in r)r[s]=void 0;if(!this._validate(r,n))return!1;this.idAttribute in r&&(this.id=r[this.idAttribute]);var a=n.changes={},f=this.attributes,l=this._escapedAttributes,c=this._previousAttributes||{};for(s in r){o=r[s];if(!i.isEqual(f[s],o)||n.unset&&i.has(f,s))delete l[s],(n.silent?this._silent:a)[s]=!0;n.unset?delete f[s]:f[s]=o,!i.isEqual(c[s],o)||i.has(f,s)!==i.has(c,s)?(this.changed[s]=o,n.silent||(this._pending[s]=!0)):(delete this.changed[s],delete this._pending[s])}return n.silent||this.change(n),this},unset:function(e,t){return t=i.extend({},t,{unset:!0}),this.set(e,null,t)},clear:function(e){return e=i.extend({},e,{unset:!0}),this.set(i.clone(this.attributes),e)},fetch:function(e){e=e?i.clone(e):{};var t=this,n=e.success;return e.success=function(r,i,s){if(!t.set(t.parse(r,s),e))return!1;n&&n(t,r,e),t.trigger("sync",t,r,e)},e.error=r.wrapError(e.error,t,e),this.sync("read",this,e)},save:function(e,t,n){var s,o,u;i.isObject(e)||e==null?(s=e,n=t):(s={},s[e]=t),n=n?i.clone(n):{};if(n.wait){if(!this._validate(s,n))return!1;o=i.clone(this.attributes)}var a=i.extend({},n,{silent:!0});if(s&&!this.set(s,n.wait?a:n))return!1;if(!s&&!this.isValid())return!1;var f=this,l=n.success;n.success=function(e,t,r){u=!0;var o=f.parse(e,r);n.wait&&(o=i.extend(s||{},o));if(!f.set(o,n))return!1;l&&l(f,e,n),f.trigger("sync",f,e,n)},n.error=r.wrapError(n.error,f,n);var c=this.sync(this.isNew()?"create":"update",this,n);return!u&&n.wait&&(this.clear(a),this.set(o,a)),c},destroy:function(e){e=e?i.clone(e):{};var t=this,n=e.success,s=function(){t.trigger("destroy",t,t.collection,e)};e.success=function(r){(e.wait||t.isNew())&&s(),n&&n(t,r,e),t.isNew()||t.trigger("sync",t,r,e)};if(this.isNew())return e.success(),!1;e.error=r.wrapError(e.error,t,e);var o=this.sync("delete",this,e);return e.wait||s(),o},url:function(){var e=N(this,"urlRoot")||N(this.collection,"url")||C();return this.isNew()?e:e+(e.charAt(e.length-1)==="/"?"":"/")+encodeURIComponent(this.id)},parse:function(e,t){return e},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return this.id==null},change:function(e){e||(e={});var t=this._changing;this._changing=!0;for(var n in this._silent)this._pending[n]=!0;var r=i.extend({},e.changes,this._silent);this._silent={};for(var n in r)this.trigger("change:"+n,this,this.get(n),e);if(t)return this;while(!i.isEmpty(this._pending)){this._pending={},this.trigger("change",this,e);for(var n in this.changed){if(this._pending[n]||this._silent[n])continue;delete this.changed[n]}this._previousAttributes=i.clone(this.attributes)}return this._changing=!1,this},hasChanged:function(e){return e==null?!i.isEmpty(this.changed):i.has(this.changed,e)},changedAttributes:function(e){if(!e)return this.hasChanged()?i.clone(this.changed):!1;var t,n=!1,r=this._previousAttributes;for(var s in e){if(i.isEqual(r[s],t=e[s]))continue;(n||(n={}))[s]=t}return n},previous:function(e){return e==null||!this._previousAttributes?null:this._previousAttributes[e]},previousAttributes:function(){return i.clone(this._previousAttributes)},isValid:function(){return!this.validate||!this.validate(this.attributes)},_validate:function(e,t){if(t.silent||!this.validate)return!0;e=i.extend({},this.attributes,e);var n=this.validate(e,t);return n?(t&&t.error?t.error(this,n,t):this.trigger("error",this,n,t),!1):!0}});var a=r.Collection=function(e,t){t||(t={}),t.model&&(this.model=t.model),t.comparator!==void 0&&(this.comparator=t.comparator),this._reset(),this.initialize.apply(this,arguments),e&&this.reset(e,{silent:!0,parse:t.parse})};i.extend(a.prototype,o,{model:u,initialize:function(){},toJSON:function(e){return this.map(function(t){return t.toJSON(e)})},sync:function(){return r.sync.apply(this,arguments)},add:function(e,t){var r,s,o,u,a,f,l={},c={},h=[];t||(t={}),e=i.isArray(e)?e.slice():[e];for(r=0,o=e.length;r<o;r++){if(!(u=e[r]=this._prepareModel(e[r],t)))throw new Error("Can't add an invalid model to a collection");a=u.cid,f=u.id;if(l[a]||this._byCid[a]||f!=null&&(c[f]||this._byId[f])){h.push(r);continue}l[a]=c[f]=u}r=h.length;while(r--)h[r]=e.splice(h[r],1)[0];for(r=0,o=e.length;r<o;r++)(u=e[r]).on("all",this._onModelEvent,this),this._byCid[u.cid]=u,u.id!=null&&(this._byId[u.id]=u);this.length+=o,s=t.at!=null?t.at:this.models.length,n.apply(this.models,[s,0].concat(e));if(t.merge)for(r=0,o=h.length;r<o;r++)(u=this._byId[h[r].id])&&u.set(h[r],t);this.comparator&&t.at==null&&this.sort({silent:!0});if(t.silent)return this;for(r=0,o=this.models.length;r<o;r++){if(!l[(u=this.models[r]).cid])continue;t.index=r,u.trigger("add",u,this,t)}return this},remove:function(e,t){var n,r,s,o;t||(t={}),e=i.isArray(e)?e.slice():[e];for(n=0,r=e.length;n<r;n++){o=this.getByCid(e[n])||this.get(e[n]);if(!o)continue;delete this._byId[o.id],delete this._byCid[o.cid],s=this.indexOf(o),this.models.splice(s,1),this.length--,t.silent||(t.index=s,o.trigger("remove",o,this,t)),this._removeReference(o)}return this},push:function(e,t){return e=this._prepareModel(e,t),this.add(e,t),e},pop:function(e){var t=this.at(this.length-1);return this.remove(t,e),t},unshift:function(e,t){return e=this._prepareModel(e,t),this.add(e,i.extend({at:0},t)),e},shift:function(e){var t=this.at(0);return this.remove(t,e),t},slice:function(e,t){return this.models.slice(e,t)},get:function(e){return e==null?void 0:this._byId[e.id!=null?e.id:e]},getByCid:function(e){return e&&this._byCid[e.cid||e]},at:function(e){return this.models[e]},where:function(e){return i.isEmpty(e)?[]:this.filter(function(t){for(var n in e)if(e[n]!==t.get(n))return!1;return!0})},sort:function(e){e||(e={});if(!this.comparator)throw new Error("Cannot sort a set without a comparator");var t=i.bind(this.comparator,this);return this.comparator.length===1?this.models=this.sortBy(t):this.models.sort(t),e.silent||this.trigger("reset",this,e),this},pluck:function(e){return i.map(this.models,function(t){return t.get(e)})},reset:function(e,t){e||(e=[]),t||(t={});for(var n=0,r=this.models.length;n<r;n++)this._removeReference(this.models[n]);return this._reset(),this.add(e,i.extend({silent:!0},t)),t.silent||this.trigger("reset",this,t),this},fetch:function(e){e=e?i.clone(e):{},e.parse===void 0&&(e.parse=!0);var t=this,n=e.success;return e.success=function(r,i,s){t[e.add?"add":"reset"](t.parse(r,s),e),n&&n(t,r,e),t.trigger("sync",t,r,e)},e.error=r.wrapError(e.error,t,e),this.sync("read",this,e)},create:function(e,t){var n=this;t=t?i.clone(t):{},e=this._prepareModel(e,t);if(!e)return!1;t.wait||n.add(e,t);var r=t.success;return t.success=function(e,t,i){i.wait&&n.add(e,i),r&&r(e,t,i)},e.save(null,t),e},parse:function(e,t){return e},clone:function(){return new this.constructor(this.models)},chain:function(){return i(this.models).chain()},_reset:function(e){this.length=0,this.models=[],this._byId={},this._byCid={}},_prepareModel:function(e,t){if(e instanceof u)return e.collection||(e.collection=this),e;t||(t={}),t.collection=this;var n=new this.model(e,t);return n._validate(n.attributes,t)?n:!1},_removeReference:function(e){this===e.collection&&delete e.collection,e.off("all",this._onModelEvent,this)},_onModelEvent:function(e,t,n,r){if((e==="add"||e==="remove")&&n!==this)return;e==="destroy"&&this.remove(t,r),t&&e==="change:"+t.idAttribute&&(delete this._byId[t.previous(t.idAttribute)],t.id!=null&&(this._byId[t.id]=t)),this.trigger.apply(this,arguments)}});var f=["forEach","each","map","reduce","reduceRight","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","sortBy","sortedIndex","toArray","size","first","initial","rest","last","without","indexOf","shuffle","lastIndexOf","isEmpty","groupBy"];i.each(f,function(e){a.prototype[e]=function(){return i[e].apply(i,[this.models].concat(i.toArray(arguments)))}});var l=r.Router=function(e){e||(e={}),e.routes&&(this.routes=e.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},c=/:\w+/g,h=/\*\w+/g,p=/[-[\]{}()+?.,\\^$|#\s]/g;i.extend(l.prototype,o,{initialize:function(){},route:function(e,t,n){return r.history||(r.history=new d),i.isRegExp(e)||(e=this._routeToRegExp(e)),n||(n=this[t]),r.history.route(e,i.bind(function(i){var s=this._extractParameters(e,i);n&&n.apply(this,s),this.trigger.apply(this,["route:"+t].concat(s)),r.history.trigger("route",this,t,s)},this)),this},navigate:function(e,t){r.history.navigate(e,t)},_bindRoutes:function(){if(!this.routes)return;var e=[];for(var t in this.routes)e.unshift([t,this.routes[t]]);for(var n=0,r=e.length;n<r;n++)this.route(e[n][0],e[n][1],this[e[n][1]])},_routeToRegExp:function(e){return e=e.replace(p,"\\$&").replace(c,"([^/]+)").replace(h,"(.*?)"),new RegExp("^"+e+"$")},_extractParameters:function(e,t){return e.exec(t).slice(1)}});var d=r.History=function(t){this.handlers=[],i.bindAll(this,"checkUrl"),this.location=t&&t.location||e.location,this.history=t&&t.history||e.history},v=/^[#\/]/,m=/msie [\w.]+/,g=/\/$/;d.started=!1,i.extend(d.prototype,o,{interval:50,getHash:function(e){var t=(e||this).location.href.match(/#(.*)$/);return t?t[1]:""},getFragment:function(e,t){if(e==null)if(this._hasPushState||!this._wantsHashChange||t){e=this.location.pathname;var n=this.options.root.replace(g,"");e.indexOf(n)||(e=e.substr(n.length))}else e=this.getHash();return decodeURIComponent(e.replace(v,""))},start:function(e){if(d.started)throw new Error("Backbone.history has already been started");d.started=!0,this.options=i.extend({},{root:"/"},this.options,e),this._wantsHashChange=this.options.hashChange!==!1,this._wantsPushState=!!this.options.pushState,this._hasPushState=!!(this.options.pushState&&this.history&&this.history.pushState);var t=this.getFragment(),n=document.documentMode,s=m.exec(navigator.userAgent.toLowerCase())&&(!n||n<=7);g.test(this.options.root)||(this.options.root+="/"),s&&this._wantsHashChange&&(this.iframe=r.$('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow,this.navigate(t)),this._hasPushState?r.$(window).bind("popstate",this.checkUrl):this._wantsHashChange&&"onhashchange"in window&&!s?r.$(window).bind("hashchange",this.checkUrl):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),this.fragment=t;var o=this.location,u=o.pathname.replace(/[^/]$/,"$&/")===this.options.root&&!o.search;if(this._wantsHashChange&&this._wantsPushState&&!this._hasPushState&&!u)return this.fragment=this.getFragment(null,!0),this.location.replace(this.options.root+this.location.search+"#"+this.fragment),!0;this._wantsPushState&&this._hasPushState&&u&&o.hash&&(this.fragment=this.getHash().replace(v,""),this.history.replaceState({},document.title,o.protocol+"//"+o.host+this.options.root+this.fragment));if(!this.options.silent)return this.loadUrl()},stop:function(){r.$(window).unbind("popstate",this.checkUrl).unbind("hashchange",this.checkUrl),clearInterval(this._checkUrlInterval),d.started=!1},route:function(e,t){this.handlers.unshift({route:e,callback:t})},checkUrl:function(e){var t=this.getFragment();t===this.fragment&&this.iframe&&(t=this.getFragment(this.getHash(this.iframe)));if(t===this.fragment)return!1;this.iframe&&this.navigate(t),this.loadUrl()||this.loadUrl(this.getHash())},loadUrl:function(e){var t=this.fragment=this.getFragment(e),n=i.any(this.handlers,function(e){if(e.route.test(t))return e.callback(t),!0});return n},navigate:function(e,t){if(!d.started)return!1;if(!t||t===!0)t={trigger:t};var n=(e||"").replace(v,"");if(this.fragment===n)return;this.fragment=n;var r=(n.indexOf(this.options.root)!==0?this.options.root:"")+n;if(this._hasPushState)this.history[t.replace?"replaceState":"pushState"]({},document.title,r);else{if(!this._wantsHashChange)return this.location.assign(r);this._updateHash(this.location,n,t.replace),this.iframe&&n!==this.getFragment(this.getHash(this.iframe))&&(t.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,n,t.replace))}t.trigger&&this.loadUrl(e)},_updateHash:function(e,t,n){n?e.replace(e.href.replace(/(javascript:|#).*$/,"")+"#"+t):e.hash=t}});var y=r.View=function(e){this.cid=i.uniqueId("view"),this._configure(e||{}),this._ensureElement(),this.initialize.apply(this,arguments),this.delegateEvents()},b=/^(\S+)\s*(.*)$/,w=["model","collection","el","id","attributes","className","tagName"];i.extend(y.prototype,o,{tagName:"div",$:function(e){return this.$el.find(e)},initialize:function(){},render:function(){return this},remove:function(){return this.$el.remove(),this},make:function(e,t,n){var i=document.createElement(e);return t&&r.$(i).attr(t),n!=null&&r.$(i).html(n),i},setElement:function(e,t){return this.$el&&this.undelegateEvents(),this.$el=e instanceof r.$?e:r.$(e),this.el=this.$el[0],t!==!1&&this.delegateEvents(),this},delegateEvents:function(e){if(!e&&!(e=N(this,"events")))return;this.undelegateEvents();for(var t in e){var n=e[t];i.isFunction(n)||(n=this[e[t]]);if(!n)throw new Error('Method "'+e[t]+'" does not exist');var r=t.match(b),s=r[1],o=r[2];n=i.bind(n,this),s+=".delegateEvents"+this.cid,o===""?this.$el.bind(s,n):this.$el.delegate(o,s,n)}},undelegateEvents:function(){this.$el.unbind(".delegateEvents"+this.cid)},_configure:function(e){this.options&&(e=i.extend({},this.options,e));for(var t=0,n=w.length;t<n;t++){var r=w[t];e[r]&&(this[r]=e[r])}this.options=e},_ensureElement:function(){if(!this.el){var e=i.extend({},N(this,"attributes"));this.id&&(e.id=N(this,"id")),this.className&&(e["class"]=N(this,"className")),this.setElement(this.make(N(this,"tagName"),e),!1)}else this.setElement(this.el,!1)}});var E=function(e,t){return T(this,e,t)};u.extend=a.extend=l.extend=y.extend=E;var S={create:"POST",update:"PUT","delete":"DELETE",read:"GET"};r.sync=function(e,t,n){var s=S[e];n||(n={});var o={type:s,dataType:"json"};return n.url||(o.url=N(t,"url")||C()),!n.data&&t&&(e==="create"||e==="update")&&(o.contentType="application/json",o.data=JSON.stringify(t)),r.emulateJSON&&(o.contentType="application/x-www-form-urlencoded",o.data=o.data?{model:o.data}:{}),r.emulateHTTP&&(s==="PUT"||s==="DELETE")&&(r.emulateJSON&&(o.data._method=s),o.type="POST",o.beforeSend=function(e){e.setRequestHeader("X-HTTP-Method-Override",s)}),o.type!=="GET"&&!r.emulateJSON&&(o.processData=!1),r.ajax(i.extend(o,n))},r.ajax=function(){return r.$.ajax.apply(r.$,arguments)},r.wrapError=function(e,t,n){return function(r,i){i=r===t?i:r,e?e(t,i,n):t.trigger("error",t,i,n)}};var x=function(){},T=function(e,t,n){var r;return t&&t.hasOwnProperty("constructor")?r=t.constructor:r=function(){e.apply(this,arguments)},i.extend(r,e),x.prototype=e.prototype,r.prototype=new x,t&&i.extend(r.prototype,t),n&&i.extend(r,n),r.prototype.constructor=r,r.__super__=e.prototype,r},N=function(e,t){return!e||!e[t]?null:i.isFunction(e[t])?e[t]():e[t]},C=function(){throw new Error('A "url" property or function must be specified')}}.call(this),define("backbone",["underscore"],function(e){return function(){return e.Backbone}}(this)),function(){function t(){return t}function n(t,r){var i=n.resolve(t),s=n.modules[i];if(!s)throw new Error('failed to require "'+t+'" from '+r);return s.exports||(s.exports={},s.call(s.exports,s,s.exports,n.relative(i),e)),s.exports}var e=this;n.modules={},n.resolve=function(e){var t=e,r=e+".js",i=e+"/index.js";return n.modules[r]&&r||n.modules[i]&&i||t},n.register=function(e,t){n.modules[e]=t},n.relative=function(e){return function(r){if("debug"==r)return t;if("."!=r.charAt(0))return n(r);var i=e.split("/"),s=r.split("/");i.pop();for(var o=0;o<s.length;o++){var u=s[o];".."==u?i.pop():"."!=u&&i.push(u)}return n(i.join("/"),e)}},n.register("engine.io-client.js",function(e,t,n,r){t.version="0.1.0",t.protocol=1,t.util=n("./util"),t.parser=n("./parser"),t.Socket=n("./socket"),t.EventEmitter=n("./event-emitter"),t.Transport=n("./transport"),t.transports=n("./transports")}),n.register("event-emitter.js",function(e,t,n,r){function i(){}function s(e){return"[object Array]"==Object.prototype.toString.call(e)}e.exports=i,i.prototype.on=function(e,t){return this.$events||(this.$events={}),this.$events[e]?s(this.$events[e])?this.$events[e].push(t):this.$events[e]=[this.$events[e],t]:this.$events[e]=t,this},i.prototype.addListener=i.prototype.on,i.prototype.once=function(e,t){function r(){n.removeListener(e,r),t.apply(this,arguments)}var n=this;return r.listener=t,this.on(e,r),this},i.prototype.removeListener=function(e,t){if(this.$events&&this.$events[e]){var n=this.$events[e];if(s(n)){var r=-1;for(var i=0,o=n.length;i<o;i++)if(n[i]===t||n[i].listener&&n[i].listener===t){r=i;break}if(r<0)return this;n.splice(r,1),n.length||delete this.$events[e]}else(n===t||n.listener&&n.listener===t)&&delete this.$events[e]}return this},i.prototype.removeAllListeners=function(e){return e===undefined?(this.$events={},this):(this.$events&&this.$events[e]&&(this.$events[e]=null),this)},i.prototype.listeners=function(e){return this.$events||(this.$events={}),this.$events[e]||(this.$events[e]=[]),s(this.$events[e])||(this.$events[e]=[this.$events[e]]),this.$events[e]},i.prototype.emit=function(e){if(!this.$events)return!1;var t=this.$events[e];if(!t)return!1;var n=Array.prototype.slice.call(arguments,1);if("function"==typeof t)t.apply(this,n);else{if(!s(t))return!1;var r=t.slice();for(var i=0,o=r.length;i<o;i++)r[i].apply(this,n)}return!0},i.prototype.addEventListener=i.prototype.on,i.prototype.removeEventListener=i.prototype.removeListener,i.prototype.dispatchEvent=i.prototype.emit}),n.register("parser.js",function(e,t,n,r){var i=n("./util"),s=t.packets={open:0,close:1,ping:2,pong:3,message:4,upgrade:5,noop:6},o=i.keys(s),u={type:"error",data:"parser error"};t.encodePacket=function(e){var t=s[e.type];return undefined!==e.data&&(t+=String(e.data)),""+t},t.decodePacket=function(e){var t=e.charAt(0);return Number(t)!=t||!o[t]?u:e.length>1?{type:o[t],data:e.substring(1)}:{type:o[t]}},t.encodePayload=function(e){if(!e.length)return"0:";var n="",r;for(var i=0,s=e.length;i<s;i++)r=t.encodePacket(e[i]),n+=r.length+":"+r;return n},t.decodePayload=function(e){if(e=="")return[u];var n=[],r="",i,s,o;for(var a=0,f=e.length;a<f;a++){var l=e.charAt(a);if(":"!=l)r+=l;else{if(""==r||r!=(i=Number(r)))return[u];s=e.substr(a+1,i);if(r!=s.length)return[u];if(s.length){o=t.decodePacket(s);if(u.type==o.type&&u.data==o.data)return[u];n.push(o)}a+=i,r=""}}return r!=""?[u]:n}}),n.register("socket.js",function(e,t,n,r){function a(e){if("string"==typeof e){var t=i.parseUri(e);e=arguments[1]||{},e.host=t.host,e.secure=t.scheme=="https"||t.scheme=="wss",e.port=t.port||(e.secure?443:80)}e=e||{},this.secure=e.secure||!1,this.host=e.host||e.hostname||"localhost",this.port=e.port||80,this.query=e.query||{},this.query.uid=l(),this.upgrade=!1!==e.upgrade,this.resource=e.resource||"default",this.path=(e.path||"/engine.io").replace(/\/$/,""),this.path+="/"+this.resource+"/",this.forceJSONP=!!e.forceJSONP,this.flashPath=e.flashPath||"",this.transports=e.transports||["polling","websocket","flashsocket"],this.readyState="",this.writeBuffer=[],this.policyPort=e.policyPort||843,this.open()}function f(e){var t={};for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t}function l(){return String(Math.random()).substr(5)+String(Math.random()).substr(5)}var i=n("./util"),s=n("./transports"),o=n("debug")("engine-client:socket"),u=n("./event-emitter");e.exports=a,i.inherits(a,u),a.prototype.createTransport=function(e){o('creating transport "%s"',e);var t=f(this.query);t.transport=e,this.id&&(t.sid=this.id);var n=new s[e]({host:this.host,port:this.port,secure:this.secure,path:this.path,query:t,forceJSONP:this.forceJSONP,flashPath:this.flashPath,policyPort:this.policyPort});return n},a.prototype.open=function(){this.readyState="opening";var e=this.createTransport(this.transports[0]);e.open(),this.setTransport(e)},a.prototype.setTransport=function(e){var t=this;this.transport&&(o("clearing existing transport"),this.transport.removeAllListeners()),this.transport=e,e.on("drain",function(){t.flush()}).on("packet",function(e){t.onPacket(e)}).on("error",function(e){t.onError(e)}).on("close",function(){t.onClose("transport close")})},a.prototype.probe=function(e){o('probing transport "%s"',e);var t=this.createTransport(e,{probe:1}),n=this;t.once("open",function(){o('probe transport "%s" opened',e),t.send([{type:"ping",data:"probe"}]),t.once("packet",function(r){if("pong"==r.type&&"probe"==r.data)o('probe transport "%s" pong',e),n.upgrading=!0,n.emit("upgrading",t),o('pausing current transport "%s"',n.transport.name),n.transport.pause(function(){if("closed"==n.readyState||"closing"==n.readyState)return;o("changing transport and sending upgrade packet"),n.emit("upgrade",t),n.setTransport(t),t.send([{type:"upgrade"}]),t=null,n.upgrading=!1,n.flush()});else{o('probe transport "%s" failed',e);var i=new Error("probe error");i.transport=t.name,n.emit("error",i)}})}),t.open(),this.once("close",function(){t&&(o("socket closed prematurely - aborting probe"),t.close(),t=null)}),this.once("upgrading",function(e){t&&e.name!=t.name&&(o('"%s" works - aborting "%s"',e.name,t.name),t.close(),t=null)})},a.prototype.onOpen=function(){o("socket open"),this.readyState="open",this.emit("open"),this.onopen&&this.onopen.call(this),this.flush();if(this.upgrade&&this.transport.pause){o("starting upgrade probes");for(var e=0,t=this.upgrades.length;e<t;e++)this.probe(this.upgrades[e])}},a.prototype.onPacket=function(e){if("opening"==this.readyState||"open"==this.readyState){o('socket receive: type "%s", data "%s"',e.type,e.data);switch(e.type){case"open":this.onHandshake(i.parseJSON(e.data));break;case"ping":this.sendPacket("pong"),this.setPingTimeout();break;case"error":var t=new Error("server error");t.code=e.data,this.emit("error",t);break;case"message":this.emit("message",e.data);var n={data:e.data};n.toString=function(){return e.data},this.onmessage&&this.onmessage.call(this,n)}}else o('packet received with socket readyState "%s"',this.readyState)},a.prototype.onHandshake=function(e){this.emit("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this.upgrades=e.upgrades,this.pingTimeout=e.pingTimeout,this.onOpen(),this.setPingTimeout()},a.prototype.setPingTimeout=function(){clearTimeout(this.pingTimeoutTimer);var e=this;this.pingTimeoutTimer=setTimeout(function(){e.onClose("ping timeout")},this.pingTimeout)},a.prototype.flush=function(){"closed"!=this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length&&(o("flushing %d packets in socket",this.writeBuffer.length),this.transport.send(this.writeBuffer),this.writeBuffer=[])},a.prototype.send=function(e){return this.sendPacket("message",e),this},a.prototype.sendPacket=function(e,t){var n={type:e,data:t};this.writeBuffer.push(n),this.flush()},a.prototype.close=function(){if("opening"==this.readyState||"open"==this.readyState)this.onClose("forced close"),o("socket closing - telling transport to close"),this.transport.close();return this},a.prototype.onError=function(e){this.emit("error",e),this.onClose("transport error",e)},a.prototype.onClose=function(e,t){"closed"!=this.readyState&&(o('socket close with reason: "%s"',e),this.readyState="closed",this.emit("close",e,t),this.onclose&&this.onclose.call(this))}}),n.register("transport.js",function(e,t,n,r){function u(e){this.path=e.path,this.host=e.host,this.port=e.port,this.secure=e.secure,this.query=e.query,this.readyState=""}var i=n("./util"),s=n("./parser"),o=n("./event-emitter");e.exports=u,i.inherits(u,o),u.prototype.onError=function(e,t){var n=new Error(e);return n.type="TransportError",n.description=t,this.emit("error",n),this},u.prototype.open=function(){if("closed"==this.readyState||""==this.readyState)this.readyState="opening",this.doOpen();return this},u.prototype.close=function(){if("opening"==this.readyState||"open"==this.readyState)this.doClose(),this.onClose();return this},u.prototype.send=function(e){if("open"!=this.readyState)throw new Error("Transport not open");this.write(e)},u.prototype.onOpen=function(){this.readyState="open",this.writable=!0,this.emit("open")},u.prototype.onData=function(e){this.onPacket(s.decodePacket(e))},u.prototype.onPacket=function(e){this.emit("packet",e)},u.prototype.onClose=function(){this.readyState="closed",this.emit("close")}}),n.register("transports/flashsocket.js",function(e,t,n,r){function o(e){i.call(this,e),this.flashPath=e.flashPath,this.policyPort=e.policyPort}function a(e,t){if(u[e])return t();var n=document.createElement("script"),r=!1;n.onload=n.onreadystatechange=function(){if(r||u[e])return;var i=n.readyState;if(!i||"loaded"==i||"complete"==i)n.onload=n.onreadystatechange=null,r=!0,u[e]=!0,t()},n.async=1,n.src=e;var i=document.getElementsByTagName("head")[0];i.insertBefore(n,i.firstChild)}function f(e,t){function n(r){if(!e[r])return t();a(e[r],function(){n(++r)})}n(0)}var i=n("./websocket"),s=n("../util");e.exports=o,s.inherits(o,i),o.prototype.name="flashsocket",o.prototype.doOpen=function(){function e(e){return function(){var e=Array.prototype.join.call(arguments," ")}}if(!this.check())return;WEB_SOCKET_LOGGER={log:e("debug"),error:e("error")},WEB_SOCKET_SUPPRESS_CROSS_DOMAIN_SWF_ERROR=!0,WEB_SOCKET_DISABLE_AUTO_INITIALIZATION=!0,"undefined"==typeof WEB_SOCKET_SWF_LOCATION&&(WEB_SOCKET_SWF_LOCATION=this.flashPath+"WebSocketMainInsecure.swf");var t=[this.flashPath+"web_socket.js"];"undefined"==typeof swfobject&&t.unshift(this.flashPath+"swfobject.js");var n=this;f(t,function(){n.ready(function(){WebSocket.__addTask(function(){i.prototype.doOpen.call(n)})})})},o.prototype.doClose=function(){if(!this.socket)return;var e=this;WebSocket.__addTask(function(){i.prototype.doClose.call(e)})},o.prototype.write=function(){var e=this,t=arguments;WebSocket.__addTask(function(){i.prototype.write.apply(e,t)})},o.prototype.ready=function(e){function t(){o.loaded||(843!=n.policyPort&&WebSocket.loadFlashPolicyFile("xmlsocket://"+n.host+":"+n.policyPort),WebSocket.__initialize(),o.loaded=!0),e.call(n)}if(!(typeof WebSocket!="undefined"&&"__initialize"in WebSocket)||!swfobject)return;if(swfobject.getFlashPlayerVersion().major<10)return;var n=this;if(document.body)return t();s.load(t)},o.prototype.check=function(){if(typeof WebSocket=="undefined"||"__initialize"in WebSocket){if(window.ActiveXObject){var e=null;try{e=new ActiveXObject("ShockwaveFlash.ShockwaveFlash")}catch(t){}if(e)return!0}else for(var n=0,r=navigator.plugins.length;n<r;n++)for(var i=0,s=navigator.plugins[n].length;i<s;i++)if(navigator.plugins[n][i].description=="Shockwave Flash")return!0;return!1}return!1};var u={}}),n.register("transports/index.js",function(e,t,n,r){function f(e){var t=!1;return r.location&&(t=e.host!=r.location.hostname||r.location.port!=e.port),a.request(t)&&!e.forceJSONP?new i(e):new s(e)}var i=n("./polling-xhr"),s=n("./polling-jsonp"),o=n("./websocket"),u=n("./flashsocket"),a=n("../util");t.polling=f,t.websocket=o,t.flashsocket=u}),n.register("transports/polling-jsonp.js",function(e,t,n,r){function f(){}function l(e){i.call(this,e),this.index=a++;var t=this;u.push(function(e){t.onData(e)}),this.query.j=u.length-1}var i=n("./polling"),s=n("../util");e.exports=l;var o=/\n/g,u=r.___eio=[],a=0;s.inherits(l,i),l.prototype.doOpen=function(){var e=this;s.defer(function(){i.prototype.doOpen.call(e)})},l.prototype.doClose=function(){this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),this.form&&(this.form.parentNode.removeChild(this.form),this.form=null),i.prototype.doClose.call(this)},l.prototype.doPoll=function(){var e=document.createElement("script");this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),e.async=!0,e.src=this.uri();var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t),this.script=e,s.ua.gecko&&setTimeout(function(){var e=document.createElement("iframe");document.body.appendChild(e),document.body.removeChild(e)},100)},l.prototype.doWrite=function(e,t){function a(){f(),t()}function f(){n.iframe&&n.form.removeChild(n.iframe);try{u=document.createElement('<iframe name="'+n.iframeId+'">')}catch(e){u=document.createElement("iframe"),u.name=n.iframeId}u.id=n.iframeId,n.form.appendChild(u),n.iframe=u}var n=this;if(!this.form){var r=document.createElement("form"),i=document.createElement("textarea"),s=this.iframeId="eio_iframe_"+this.index,u;r.className="socketio",r.style.position="absolute",r.style.top="-1000px",r.style.left="-1000px",r.target=s,r.method="POST",r.setAttribute("accept-charset","utf-8"),i.name="d",r.appendChild(i),document.body.appendChild(r),this.form=r,this.area=i}this.form.action=this.uri(),f(),this.area.value=e.replace(o,"\\n");try{this.form.submit()}catch(l){}this.iframe.attachEvent?u.onreadystatechange=function(){n.iframe.readyState=="complete"&&a()}:this.iframe.onload=a}}),n.register("transports/polling-xhr.js",function(e,t,n,r){function u(){}function a(e){i.call(this,e),r.location&&(this.xd=e.host!=r.location.hostname||r.location.port!=e.port)}function f(e){this.method=e.method||"GET",this.uri=e.uri,this.xd=!!e.xd,this.async=!1!==e.async,this.data=undefined!=e.data?e.data:null,this.create()}var i=n("./polling"),s=n("../event-emitter"),o=n("../util");e.exports=a,e.exports.Request=f,o.inherits(a,i),a.prototype.doOpen=function(){var e=this;o.defer(function(){i.prototype.doOpen.call(e)})},a.prototype.request=function(e){return e=e||{},e.uri=this.uri(),e.xd=this.xd,new f(e)},a.prototype.doWrite=function(e,t){var n=this.request({method:"POST",data:e}),r=this;n.on("success",t),n.on("error",function(e){r.onError("xhr post error",e)}),this.sendXhr=n},a.prototype.doPoll=function(){var e=this.request(),t=this;e.on("data",function(e){t.onData(e)}),e.on("error",function(e){t.onError("xhr poll error",e)}),this.pollXhr=e},o.inherits(f,s),f.prototype.create=function(){var e=this.xhr=o.request(this.xd),t=this;e.open(this.method,this.uri,this.async);if("POST"==this.method)try{e.setRequestHeader?e.setRequestHeader("Content-type","text/plain;charset=UTF-8"):e.contentType="text/plain"}catch(n){}this.xd&&r.XDomainRequest&&e instanceof XDomainRequest?(e.onerror=function(e){t.onError(e)},e.onload=function(){t.onData(e.responseText)},e.onprogress=u):("withCredentials"in e&&(e.withCredentials=!0),e.onreadystatechange=function(){var n;try{if(4!=e.readyState)return;200==e.status||1223==e.status?n=e.responseText:t.onError(e.status)}catch(r){t.onError(r)}undefined!==n&&t.onData(n)}),e.send(this.data),r.ActiveXObject&&(this.index=f.requestsCount++,f.requests[this.index]=this)},f.prototype.onSuccess=function(){this.emit("success"),this.cleanup()},f.prototype.onData=function(e){this.emit("data",e),this.onSuccess()},f.prototype.onError=function(e){this.emit("error",e),this.cleanup()},f.prototype.cleanup=function(){this.xhr.onreadystatechange=u,this.xhr.onload=this.xhr.onerror=u;try{this.xhr.abort()}catch(e){}r.ActiveXObject&&delete f.requests[this.index],this.xhr=null},f.prototype.abort=function(){this.cleanup()},r.ActiveXObject&&(f.requestsCount=0,f.requests={},r.attachEvent("onunload",function(){for(var e in f.requests)f.requests.hasOwnProperty(e)&&f.requests[e].abort()}))}),n.register("transports/polling.js",function(e,t,n,r){function u(e){i.call(this,e),this.forceBust=!!e.forceBust}var i=n("../transport"),s=n("../util"),o=n("../parser");e.exports=u,s.inherits(u,i),u.prototype.name="polling",u.prototype.doOpen=function(){this.poll()},u.prototype.pause=function(e){function r(){n.readyState="paused",e()}var t=0,n=this;this.readyState="pausing";if(this.polling||!this.writable){var i=0;this.polling&&(i++,this.once("poll",function(){--i||r()})),this.writable||(i++,this.once("drain",function(){--i||r()}))}else r()},u.prototype.poll=function(){this.polling=!0,this.doPoll()},u.prototype.onData=function(e){var t=o.decodePayload(e);for(var n=0,r=t.length;n<r;n++){"opening"==this.readyState&&this.onOpen();if("close"==t[n].type){this.onClose();return}this.onPacket(t[n])}this.polling=!1,this.emit("poll"),"open"==this.readyState&&this.poll()},u.prototype.doClose=function(){this.send([{type:"close"}])},u.prototype.write=function(e){var t=this;this.writable=!1,this.doWrite(o.encodePayload(e),function(){t.writable=!0,t.emit("drain")})},u.prototype.uri=function(){var e=this.query||{},t=this.secure?"https":"http",n="";if(r.ActiveXObject||this.forceBust)e.t=+(new Date);return e=s.qs(e),this.port&&("https"==t&&this.port!=443||"http"==t&&this.port!=80)&&(n=":"+this.port),e.length&&(e="?"+e),t+"://"+this.host+n+this.path+e}}),n.register("transports/websocket.js",function(e,t,n,r){function u(e){i.call(this,e)}function a(){return r.WebSocket||r.MozWebSocket}var i=n("../transport"),s=n("../parser"),o=n("../util");e.exports=u,o.inherits(u,i),u.prototype.name="websocket",u.prototype.doOpen=function(){if(!this.check())return;var e=this;this.socket=new(a())(this.uri()),this.socket.onopen=function(){e.onOpen()},this.socket.onclose=function(){e.onClose()},this.socket.onmessage=function(t){e.onData(t.data)},this.socket.onerror=function(t){e.onError("websocket error",t)}},u.prototype.write=function(e){for(var t=0,n=e.length;t<n;t++)this.socket.send(s.encodePacket(e[t]))},u.prototype.doClose=function(){typeof this.socket!="undefined"&&this.socket.close()},u.prototype.uri=function(){var e=o.qs(this.query),t=this.secure?"wss":"ws",n="";return this.port&&("wss"==t&&this.port!=443||"ws"==t&&this.port!=80)&&(n=":"+this.port),e.length&&(e="?"+e),t+"://"+this.host+n+this.path+e},u.prototype.check=function(){var e=a();return!!e&&!("__initialize"in e&&this.name===u.prototype.name)}}),n.register("util.js",function(e,t,n,r){var i=!1;t.inherits=function(t,n){function r(){}r.prototype=n.prototype,t.prototype=new r},t.keys=Object.keys||function(e){var t=[],n=Object.prototype.hasOwnProperty;for(var r in e)n.call(e,r)&&t.push(r);return t},t.on=function(e,t,n,r){e.attachEvent?e.attachEvent("on"+t,n):e.addEventListener&&e.addEventListener(t,n,r)},t.load=function(e){if(r.document&&document.readyState==="complete"||i)return e();t.on(r,"load",e,!1)},"undefined"!=typeof window&&t.load(function(){i=!0}),t.defer=function(e){if(!t.ua.webkit||"undefined"!=typeof importScripts)return e();t.load(function(){setTimeout(e,100)})};var s=/^[\],:{}\s]*$/,o=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,u=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,a=/(?:^|:|,)(?:\s*\[)+/g,f=/^\s+/,l=/\s+$/;t.parseJSON=function(e){if("string"!=typeof e||!e)return null;e=e.replace(f,"").replace(l,"");if(r.JSON&&JSON.parse)return JSON.parse(e);if(s.test(e.replace(o,"@").replace(u,"]").replace(a,"")))return(new Function("return "+e))()},t.ua={},t.ua.hasCORS="undefined"!=typeof XMLHttpRequest&&function(){try{var e=new XMLHttpRequest}catch(t){return!1}return e.withCredentials!=undefined}(),t.ua.webkit="undefined"!=typeof navigator&&/webkit/i.test(navigator.userAgent),t.ua.gecko="undefined"!=typeof navigator&&/gecko/i.test(navigator.userAgent),t.request=function(n){if(n&&"undefined"!=typeof XDomainRequest)return new XDomainRequest;try{if("undefined"!=typeof XMLHttpRequest&&(!n||t.ua.hasCORS))return new XMLHttpRequest}catch(r){}if(!n)try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(r){}};var c=/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,h=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];t.parseUri=function(e){var t=c.exec(e||""),n={},r=14;while(r--)n[h[r]]=t[r]||"";return n},t.qs=function(e){var t="";for(var n in e)e.hasOwnProperty(n)&&(t.length&&(t+="&"),t+=n+"="+encodeURIComponent(e[n]));return t}}),"undefined"!=typeof module?module.exports=n("engine.io-client"):eio=n("engine.io-client")}(),define("vendor/engine.io",function(e){return function(){return e.eio}}(this)),function(){var e=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],t=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,n=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,r=[],i={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g},s=function(e,t){var n=i,r="var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('"+e.replace(/\\/g,"\\\\").replace(/'/g,"\\'").replace(n.interpolate,function(e,t){return"',"+t.replace(/\\'/g,"'")+",'"}).replace(n.evaluate||null,function(e,t){return"');"+t.replace(/\\'/g,"'").replace(/[\r\n\t]/g," ")+"; __p.push('"}).replace(/\r/g,"").replace(/\n/g,"").replace(/\t/g,"")+"');}return __p.join('');";return r};define("tpl",[],function(){var i,o,u;return typeof window!="undefined"&&window.navigator&&window.document?o=function(e,t){var n=i.createXhr();n.open("GET",e,!0),n.onreadystatechange=function(e){n.readyState===4&&t(n.responseText)},n.send(null)}:typeof process!="undefined"&&process.versions&&!!process.versions.node&&(u=require.nodeRequire("fs"),o=function(e,t){t(u.readFileSync(e,"utf8"))}),i={version:"0.24.0",strip:function(e){if(e){e=e.replace(t,"");var r=e.match(n);r&&(e=r[1])}else e="";return e},jsEscape:function(e){return e.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"").replace(/[\t]/g,"").replace(/[\r]/g,"")},createXhr:function(){var t,n,r;if(typeof XMLHttpRequest!="undefined")return new XMLHttpRequest;for(n=0;n<3;n++){r=e[n];try{t=new ActiveXObject(r)}catch(i){}if(t){e=[r];break}}if(!t)throw new Error("require.getXhr(): XMLHttpRequest not available");return t},get:o,load:function(e,t,n,o){var u=!1,a,f=e.indexOf("."),l=e.substring(0,f),c=e.substring(f+1,e.length);f=c.indexOf("!"),f!==-1&&(u=c.substring(f+1,c.length),u=u==="strip",c=c.substring(0,f)),a="nameToUrl"in t?t.nameToUrl(l,"."+c):t.toUrl(l+"."+c),i.get(a,function(t){t=s(t),o.isBuild||(t=new Function("obj",t)),t=u?i.strip(t):t,o.isBuild&&o.inlineText&&(r[e]=t),n(t)})},write:function(e,t,n){if(t in r){var s=i.jsEscape(r[t]);n("define('"+e+"!"+t+"', function() {return function(obj) { "+s.replace(/(\\')/g,"'").replace(/(\\\\)/g,"\\")+"}});\n")}}}})}(),define("tpl!templates/cell.ejs",function(){return function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments)};with(obj||{})__p.push('<figure data-id="',id,'">  <img src="',cover_url,'"/>  <div class="progress"></div></figure><div class="controls">  <a href="#" data-action="play" class="icon-play"></a>  <a href="#" data-action="fullscreen" class="icon-fullscreen"></a>  <a href="',hash,'.gif" class="icon-link"></a></div>');return __p.join("")}}),define("plugins/jquery.imagesloaded",[],function(){(function(e,t){var n="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==";e.fn.imagesLoaded=function(r){function c(){var t=e(f),n=e(l);s&&(l.length?s.reject(u,t,n):s.resolve(u)),e.isFunction(r)&&r.call(i,u,t,n)}function h(t,r){if(t.src===n||e.inArray(t,a)!==-1)return;a.push(t),r?l.push(t):f.push(t),e.data(t,"imagesLoaded",{isBroken:r,src:t.src}),o&&s.notifyWith(e(t),[r,u,e(f),e(l)]),u.length===a.length&&(setTimeout(c),u.unbind(".imagesLoaded"))}var i=this,s=e.isFunction(e.Deferred)?e.Deferred():0,o=e.isFunction(s.notify),u=i.find("img").add(i.filter("img")),a=[],f=[],l=[];return u.length?u.bind("load.imagesLoaded error.imagesLoaded",function(e){h(e.target,e.type==="error")}).each(function(r,i){var s=i.src,o=e.data(i,"imagesLoaded");if(o&&o.src===s){h(i,o.isBroken);return}if(i.complete&&i.naturalWidth!==t){h(i,i.naturalWidth===0||i.naturalHeight===0);return}if(i.readyState||i.complete)i.src=n,i.src=s}):c(),s?s.promise(i):i}})(jQuery)}),define("cell",["underscore","backbone","tpl!templates/cell.ejs","plugins/jquery.imagesloaded"],function(e,t,n){var r=t.View.extend({tagName:"article",className:"span2",initialize:function(){if(!this.model)throw new Error("You must provide a model");this.model.on("change:cover_url",e.once(this.addToGrid),this),this.model.get("url")?this.backgroundRender():this.model.on("change:url",e.once(this.backgroundRender),this)},updateProgress:function(e){this.$(".progress").css("width",e)},backgroundRender:function(){var e=this.model.get("url"),t=this,n;if(e===undefined)throw new Error("The model needs a url attribute to do this");this.$("img").imagesLoaded(function(){t.full_img=new Image,t.full_img.src=e,t.updateProgress("25%");var r=t.loaded=$(t.full_img).imagesLoaded();r.done(function(){n&&clearTimeout(n),t.updateProgress("100%"),delete t.full_img}),r.progress&&r.progress(function(e){var r=50;t.updateProgress(r+"%");var i=function(){if(r===99)return;t.updateProgress((r+=1)+"%"),n=setTimeout(i,30)}()})})},render:function(){this.$el.html(n(this.model.toJSON()))},addToGrid:function(){var e=this;this.render(),this.$el.imagesLoaded(function(){$("#grid").isotope("insert",e.$el)})},events:{'click [data-action="play"]':"play",'click [data-action="pause"]':"pause",'click [data-action="fullscreen"]':"fullScreen",'click [data-action="delete"]':"destroy","dblclick img":"fullScreen"},fullScreen:function(e){this.is_playing||this.play();var t=Modernizr.prefixed("RequestFullScreen",this.$("img")[0]);return t&&t(),!1},aniMagic:function(e){return this.is_playing?this.pause():this.play()},play:function(e){var t=this.$("img"),n=this.model.get("url");return n===undefined?!1:(t.attr("src",n),this.is_playing=!0,$(e.currentTarget).attr({"data-action":"pause","class":"icon-pause"}),!1)},pause:function(e){var t=this.$("img"),n=this.model.get("cover_url");return n===undefined?!1:(t.attr("src",n),this.is_playing=!1,$(e.currentTarget).attr({"data-action":"play","class":"icon-play"}),!1)},destroy:function(e){var t=this;return this.model.destroy().done(function(){$("#grid").isotope("remove",t.$el,function(){t.remove()})}),!1}});return r}),define("upload",["underscore"],function(e){function t(e){if(!e||!e.collection)throw new Error("Must provide a well-formed view");this.view=e,document.addEventListener("dragenter",function(e){e.preventDefault(),e.stopPropagation()},!1),document.addEventListener("dragover",function(e){e.preventDefault(),e.stopPropagation()},!1);var t=this;document.addEventListener("drop",function(){t.dropHandler.apply(t,arguments)},!1)}return t.prototype.dropHandler=function(t){function s(e){if(!r.test(e.type))return;var t=new FileReader,i=$.Deferred(),s=new FormData;return s.append("files",e),t.onload=function(e){var t=e.target.result,r=new Uint8Array(t),o=r.length,u=0;for(var a=0,f=o-9;a<f&&u<2;a++)r[a]===0&&r[a+1]===33&&r[a+2]===249&&r[a+3]===4&&r[a+8]===0&&(r[a+9]===44||r[a+9]===33)&&u++;if(u<2){i.reject();return}$.ajax({url:"/upload",type:"post",cache:!1,processData:!1,contentType:!1,data:s}).then(function(e){i.resolve(),n.view.collection.add(e)},function(){i.reject()})},t.readAsArrayBuffer(e),i.promise()}t.stopPropagation(),t.preventDefault();var n=this,r=/gif/,i=t.dataTransfer.files;i.length&&$("#loader").addClass("js-show"),$.when.apply(null,e.map(i,s)).always(function(){$("#loader").removeClass("js-show")})},t}),define("grid",["underscore","backbone","cell","upload","plugins/jquery.imagesloaded"],function(e,t,n,r){var i=t.View.extend({el:$("#grid"),initialize:function(e){var t=this;if(!e.socket)throw new Error("You must provide a socket instance");this.socket=e.socket;if(!this.collection)throw new Error("You must provide a collection");this.collection.view=this,this.collection.on("add",function(e){var t=this.collection.getByCid(e.cid);t.view=new n({model:t}),t.get("cover_url")&&t.view.addToGrid()},this),this.collection.fetch().done(function(e){t.collection.each(function(e){var r=t.$('[data-id="'+e.id+'"]');r.length&&(e.view=new n({model:e,el:r.parent()}))}),t.render()}),this.uploader=new r(this)},render:function(){var t=this;t.$el.imagesLoaded(function(){t.$el.isotope({itemSelector:"article",getSortData:{createdAt:function(e){var n=t.collection.get(e.find("figure").data("id"));return-n.get("createdAt")}},sortBy:"createdAt"})});var n=$(window),r=!1;n.on("scroll",e.debounce(function(){!r&&n.scrollTop()+n.height()>=t.$el.height()-300&&(t.collection.current_page+=1,$.getJSON(t.collection.url(),function(e){if(!e.length){t.collection.current_page--,r=!0;return}t.collection.add(e)}))},100))}});return i}),define("media_model",["underscore","backbone"],function(e,t){var n=t.Model.extend({url:function(){return"/api/media/"+this.id},initialize:function(){},update:function(e){var t=$.extend(this.toJSON(),e);this.set(t)}});return n}),function(e){e.deparam=function(t,n){var r={},i={"true":!0,"false":!1,"null":null};return e.each(t.replace(/\+/g," ").split("&"),function(t,s){var o=s.split("="),u=decodeURIComponent(o[0]),a,f=r,l=0,c=u.split("]["),h=c.length-1;/\[/.test(c[0])&&/\]$/.test(c[h])?(c[h]=c[h].replace(/\]$/,""),c=c.shift().split("[").concat(c),h=c.length-1):h=0;if(o.length===2){a=decodeURIComponent(o[1]),n&&(a=a&&!isNaN(a)?+a:a==="undefined"?undefined:i[a]!==undefined?i[a]:a);if(h)for(;l<=h;l++)u=c[l]===""?f.length:c[l],f=f[u]=l<h?f[u]||(c[l+1]&&isNaN(c[l+1])?{}:[]):a;else e.isArray(r[u])?r[u].push(a):r[u]!==undefined?r[u]=[r[u],a]:r[u]=a}else u&&(r[u]=n?undefined:"")}),r}}(jQuery),define("plugins/jquery.deparam",function(){}),define("media_collection",["underscore","backbone","media_model","plugins/jquery.deparam"],function(e,t,n){var r=t.Collection.extend({model:n,url:function(){var e="/api/media";return this.current_page>1&&(e+="?p="+this.current_page),e},initialize:function(){var e=$.deparam(location.search.replace(/^\?/,""));this.current_page=e.p?e.p:1}});return r}),function(e,t,n){var r=e.document,i=e.Modernizr,s=function(e){return e.charAt(0).toUpperCase()+e.slice(1)},o="Moz Webkit O Ms".split(" "),u=function(e){var t=r.documentElement.style,n;if(typeof t[e]=="string")return e;e=s(e);for(var i=0,u=o.length;i<u;i++){n=o[i]+e;if(typeof t[n]=="string")return n}},a=u("transform"),f=u("transitionProperty"),l={csstransforms:function(){return!!a},csstransforms3d:function(){var e=!!u("perspective");if(e){var n=" -o- -moz- -ms- -webkit- -khtml- ".split(" "),r="@media ("+n.join("transform-3d),(")+"modernizr)",i=t("<style>"+r+"{#modernizr{height:3px}}"+"</style>").appendTo("head"),s=t('<div id="modernizr" />').appendTo("html");e=s.height()===3,s.remove(),i.remove()}return e},csstransitions:function(){return!!f}},c;if(i)for(c in l)i.hasOwnProperty(c)||i.addTest(c,l[c]);else{i=e.Modernizr={_version:"1.6ish: miniModernizr for Isotope"};var h=" ",p;for(c in l)p=l[c](),i[c]=p,h+=" "+(p?"":"no-")+c;t("html").addClass(h)}if(i.csstransforms){var d=i.csstransforms3d?{translate:function(e){return"translate3d("+e[0]+"px, "+e[1]+"px, 0) "},scale:function(e){return"scale3d("+e+", "+e+", 1) "}}:{translate:function(e){return"translate("+e[0]+"px, "+e[1]+"px) "},scale:function(e){return"scale("+e+") "}},v=function(e,n,r){var i=t.data(e,"isoTransform")||{},s={},o,u={},f;s[n]=r,t.extend(i,s);for(o in i)f=i[o],u[o]=d[o](f);var l=u.translate||"",c=u.scale||"",h=l+c;t.data(e,"isoTransform",i),e.style[a]=h};t.cssNumber.scale=!0,t.cssHooks.scale={set:function(e,t){v(e,"scale",t)},get:function(e,n){var r=t.data(e,"isoTransform");return r&&r.scale?r.scale:1}},t.fx.step.scale=function(e){t.cssHooks.scale.set(e.elem,e.now+e.unit)},t.cssNumber.translate=!0,t.cssHooks.translate={set:function(e,t){v(e,"translate",t)},get:function(e,n){var r=t.data(e,"isoTransform");return r&&r.translate?r.translate:[0,0]}}}var m,g;i.csstransitions&&(m={WebkitTransitionProperty:"webkitTransitionEnd",MozTransitionProperty:"transitionend",OTransitionProperty:"oTransitionEnd",transitionProperty:"transitionEnd"}[f],g=u("transitionDuration"));var y=t.event,b;y.special.smartresize={setup:function(){t(this).bind("resize",y.special.smartresize.handler)},teardown:function(){t(this).unbind("resize",y.special.smartresize.handler)},handler:function(e,t){var n=this,r=arguments;e.type="smartresize",b&&clearTimeout(b),b=setTimeout(function(){jQuery.event.handle.apply(n,r)},t==="execAsap"?0:100)}},t.fn.smartresize=function(e){return e?this.bind("smartresize",e):this.trigger("smartresize",["execAsap"])},t.Isotope=function(e,n,r){this.element=t(n),this._create(e),this._init(r)};var w=["width","height"],E=t(e);t.Isotope.settings={resizable:!0,layoutMode:"masonry",containerClass:"isotope",itemClass:"isotope-item",hiddenClass:"isotope-hidden",hiddenStyle:{opacity:0,scale:.001},visibleStyle:{opacity:1,scale:1},containerStyle:{position:"relative",overflow:"hidden"},animationEngine:"best-available",animationOptions:{queue:!1,duration:800},sortBy:"original-order",sortAscending:!0,resizesContainer:!0,transformsEnabled:!t.browser.opera,itemPositionDataEnabled:!1},t.Isotope.prototype={_create:function(e){this.options=t.extend({},t.Isotope.settings,e),this.styleQueue=[],this.elemCount=0;var n=this.element[0].style;this.originalStyle={};var r=w.slice(0);for(var i in this.options.containerStyle)r.push(i);for(var s=0,o=r.length;s<o;s++)i=r[s],this.originalStyle[i]=n[i]||"";this.element.css(this.options.containerStyle),this._updateAnimationEngine(),this._updateUsingTransforms();var u={"original-order":function(e,t){return t.elemCount++,t.elemCount},random:function(){return Math.random()}};this.options.getSortData=t.extend(this.options.getSortData,u),this.reloadItems(),this.offset={left:parseInt(this.element.css("padding-left")||0,10),top:parseInt(this.element.css("padding-top")||0,10)};var a=this;setTimeout(function(){a.element.addClass(a.options.containerClass)},0),this.options.resizable&&E.bind("smartresize.isotope",function(){a.resize()}),this.element.delegate("."+this.options.hiddenClass,"click",function(){return!1})},_getAtoms:function(e){var t=this.options.itemSelector,n=t?e.filter(t).add(e.find(t)):e,r={position:"absolute"};return this.usingTransforms&&(r.left=0,r.top=0),n.css(r).addClass(this.options.itemClass),this.updateSortData(n,!0),n},_init:function(e){this.$filteredAtoms=this._filter(this.$allAtoms),this._sort(),this.reLayout(e)},option:function(e){if(t.isPlainObject(e)){this.options=t.extend(!0,this.options,e);var n;for(var r in e)n="_update"+s(r),this[n]&&this[n]()}},_updateAnimationEngine:function(){var e=this.options.animationEngine.toLowerCase().replace(/[ _\-]/g,""),t;switch(e){case"css":case"none":t=!1;break;case"jquery":t=!0;break;default:t=!i.csstransitions}this.isUsingJQueryAnimation=t,this._updateUsingTransforms()},_updateTransformsEnabled:function(){this._updateUsingTransforms()},_updateUsingTransforms:function(){var e=this.usingTransforms=this.options.transformsEnabled&&i.csstransforms&&i.csstransitions&&!this.isUsingJQueryAnimation;e||(delete this.options.hiddenStyle.scale,delete this.options.visibleStyle.scale),this.getPositionStyles=e?this._translate:this._positionAbs},_filter:function(e){var t=this.options.filter===""?"*":this.options.filter;if(!t)return e;var n=this.options.hiddenClass,r="."+n,i=e.filter(r),s=i;if(t!=="*"){s=i.filter(t);var o=e.not(r).not(t).addClass(n);this.styleQueue.push({$el:o,style:this.options.hiddenStyle})}return this.styleQueue.push({$el:s,style:this.options.visibleStyle}),s.removeClass(n),e.filter(t)},updateSortData:function(e,n){var r=this,i=this.options.getSortData,s,o;e.each(function(){s=t(this),o={};for(var e in i)!n&&e==="original-order"?o[e]=t.data(this,"isotope-sort-data")[e]:o[e]=i[e](s,r);t.data(this,"isotope-sort-data",o)})},_sort:function(){var e=this.options.sortBy,t=this._getSorter,n=this.options.sortAscending?1:-1,r=function(r,i){var s=t(r,e),o=t(i,e);return s===o&&e!=="original-order"&&(s=t(r,"original-order"),o=t(i,"original-order")),(s>o?1:s<o?-1:0)*n};this.$filteredAtoms.sort(r)},_getSorter:function(e,n){return t.data(e,"isotope-sort-data")[n]},_translate:function(e,t){return{translate:[e,t]}},_positionAbs:function(e,t){return{left:e,top:t}},_pushPosition:function(e,t,n){t=Math.round(t+this.offset.left),n=Math.round(n+this.offset.top);var r=this.getPositionStyles(t,n);this.styleQueue.push({$el:e,style:r}),this.options.itemPositionDataEnabled&&e.data("isotope-item-position",{x:t,y:n})},layout:function(e,t){var n=this.options.layoutMode;this["_"+n+"Layout"](e);if(this.options.resizesContainer){var r=this["_"+n+"GetContainerSize"]();this.styleQueue.push({$el:this.element,style:r})}this._processStyleQueue(e,t),this.isLaidOut=!0},_processStyleQueue:function(e,n){var r=this.isLaidOut?this.isUsingJQueryAnimation?"animate":"css":"css",s=this.options.animationOptions,o=this.options.onLayout,u,a,f,l;a=function(e,t){t.$el[r](t.style,s)};if(this._isInserting&&this.isUsingJQueryAnimation)a=function(e,t){u=t.$el.hasClass("no-transition")?"css":r,t.$el[u](t.style,s)};else if(n||o||s.complete){var c=!1,h=[n,o,s.complete],p=this;f=!0,l=function(){if(c)return;var t;for(var n=0,r=h.length;n<r;n++)t=h[n],typeof t=="function"&&t.call(p.element,e,p);c=!0};if(this.isUsingJQueryAnimation&&r==="animate")s.complete=l,f=!1;else if(i.csstransitions){var d=0,v=this.styleQueue[0],y=v&&v.$el,b;while(!y||!y.length){b=this.styleQueue[d++];if(!b)return;y=b.$el}var w=parseFloat(getComputedStyle(y[0])[g]);w>0&&(a=function(e,t){t.$el[r](t.style,s).one(m,l)},f=!1)}}t.each(this.styleQueue,a),f&&l(),this.styleQueue=[]},resize:function(){this["_"+this.options.layoutMode+"ResizeChanged"]()&&this.reLayout()},reLayout:function(e){this["_"+this.options.layoutMode+"Reset"](),this.layout(this.$filteredAtoms,e)},addItems:function(e,t){var n=this._getAtoms(e);this.$allAtoms=this.$allAtoms.add(n),t&&t(n)},insert:function(e,t){this.element.append(e);var n=this;this.addItems(e,function(e){var r=n._filter(e);n._addHideAppended(r),n._sort(),n.reLayout(),n._revealAppended(r,t)})},appended:function(e,t){var n=this;this.addItems(e,function(e){n._addHideAppended(e),n.layout(e),n._revealAppended(e,t)})},_addHideAppended:function(e){this.$filteredAtoms=this.$filteredAtoms.add(e),e.addClass("no-transition"),this._isInserting=!0,this.styleQueue.push({$el:e,style:this.options.hiddenStyle})},_revealAppended:function(e,t){var n=this;setTimeout(function(){e.removeClass("no-transition"),n.styleQueue.push({$el:e,style:n.options.visibleStyle}),n._isInserting=!1,n._processStyleQueue(e,t)},10)},reloadItems:function(){this.$allAtoms=this._getAtoms(this.element.children())},remove:function(e,t){var n=this,r=function(){n.$allAtoms=n.$allAtoms.not(e),e.remove(),t&&t.call(n.element)};e.filter(":not(."+this.options.hiddenClass+")").length?(this.styleQueue.push({$el:e,style:this.options.hiddenStyle}),this.$filteredAtoms=this.$filteredAtoms.not(e),this._sort(),this.reLayout(r)):r()},shuffle:function(e){this.updateSortData(this.$allAtoms),this.options.sortBy="random",this._sort(),this.reLayout(e)},destroy:function(){var e=this.usingTransforms,t=this.options;this.$allAtoms.removeClass(t.hiddenClass+" "+t.itemClass).each(function(){var t=this.style;t.position="",t.top="",t.left="",t.opacity="",e&&(t[a]="")});var n=this.element[0].style;for(var r in this.originalStyle)n[r]=this.originalStyle[r];this.element.unbind(".isotope").undelegate("."+t.hiddenClass,"click").removeClass(t.containerClass).removeData("isotope"),E.unbind(".isotope")},_getSegments:function(e){var t=this.options.layoutMode,n=e?"rowHeight":"columnWidth",r=e?"height":"width",i=e?"rows":"cols",o=this.element[r](),u,a=this.options[t]&&this.options[t][n]||this.$filteredAtoms["outer"+s(r)](!0)||o;u=Math.floor(o/a),u=Math.max(u,1),this[t][i]=u,this[t][n]=a},_checkIfSegmentsChanged:function(e){var t=this.options.layoutMode,n=e?"rows":"cols",r=this[t][n];return this._getSegments(e),this[t][n]!==r},_masonryReset:function(){this.masonry={},this._getSegments();var e=this.masonry.cols;this.masonry.colYs=[];while(e--)this.masonry.colYs.push(0)},_masonryLayout:function(e){var n=this,r=n.masonry;e.each(function(){var e=t(this),i=Math.ceil(e.outerWidth(!0)/r.columnWidth);i=Math.min(i,r.cols);if(i===1)n._masonryPlaceBrick(e,r.colYs);else{var s=r.cols+1-i,o=[],u,a;for(a=0;a<s;a++)u=r.colYs.slice(a,a+i),o[a]=Math.max.apply(Math,u);n._masonryPlaceBrick(e,o)}})},_masonryPlaceBrick:function(e,t){var n=Math.min.apply(Math,t),r=0;for(var i=0,s=t.length;i<s;i++)if(t[i]===n){r=i;break}var o=this.masonry.columnWidth*r,u=n;this._pushPosition(e,o,u);var a=n+e.outerHeight(!0),f=this.masonry.cols+1-s;for(i=0;i<f;i++)this.masonry.colYs[r+i]=a},_masonryGetContainerSize:function(){var e=Math.max.apply(Math,this.masonry.colYs);return{height:e}},_masonryResizeChanged:function(){return this._checkIfSegmentsChanged()},_fitRowsReset:function(){this.fitRows={x:0,y:0,height:0}},_fitRowsLayout:function(e){var n=this,r=this.element.width(),i=this.fitRows;e.each(function(){var e=t(this),s=e.outerWidth(!0),o=e.outerHeight(!0);i.x!==0&&s+i.x>r&&(i.x=0,i.y=i.height),n._pushPosition(e,i.x,i.y),i.height=Math.max(i.y+o,i.height),i.x+=s})},_fitRowsGetContainerSize:function(){return{height:this.fitRows.height}},_fitRowsResizeChanged:function(){return!0},_cellsByRowReset:function(){this.cellsByRow={index:0},this._getSegments(),this._getSegments(!0)},_cellsByRowLayout:function(e){var n=this,r=this.cellsByRow;e.each(function(){var e=t(this),i=r.index%r.cols,s=Math.floor(r.index/r.cols),o=(i+.5)*r.columnWidth-e.outerWidth(!0)/2,u=(s+.5)*r.rowHeight-e.outerHeight(!0)/2;n._pushPosition(e,o,u),r.index++})},_cellsByRowGetContainerSize:function(){return{height:Math.ceil(this.$filteredAtoms.length/this.cellsByRow.cols)*this.cellsByRow.rowHeight+this.offset.top}},_cellsByRowResizeChanged:function(){return this._checkIfSegmentsChanged()},_straightDownReset:function(){this.straightDown={y:0}},_straightDownLayout:function(e){var n=this;e.each(function(e){var r=t(this);n._pushPosition(r,0,n.straightDown.y),n.straightDown.y+=r.outerHeight(!0)})},_straightDownGetContainerSize:function(){return{height:this.straightDown.y}},_straightDownResizeChanged:function(){return!0},_masonryHorizontalReset:function(){this.masonryHorizontal={},this._getSegments(!0);var e=this.masonryHorizontal.rows;this.masonryHorizontal.rowXs=[];while(e--)this.masonryHorizontal.rowXs.push(0)},_masonryHorizontalLayout:function(e){var n=this,r=n.masonryHorizontal;e.each(function(){var e=t(this),i=Math.ceil(e.outerHeight(!0)/r.rowHeight);i=Math.min(i,r.rows);if(i===1)n._masonryHorizontalPlaceBrick(e,r.rowXs);else{var s=r.rows+1-i,o=[],u,a;for(a=0;a<s;a++)u=r.rowXs.slice(a,a+i),o[a]=Math.max.apply(Math,u);n._masonryHorizontalPlaceBrick(e,o)}})},_masonryHorizontalPlaceBrick:function(e,t){var n=Math.min.apply(Math,t),r=0;for(var i=0,s=t.length;i<s;i++)if(t[i]===n){r=i;break}var o=n,u=this.masonryHorizontal.rowHeight*r;this._pushPosition(e,o,u);var a=n+e.outerWidth(!0),f=this.masonryHorizontal.rows+1-s;for(i=0;i<f;i++)this.masonryHorizontal.rowXs[r+i]=a},_masonryHorizontalGetContainerSize:function(){var e=Math.max.apply(Math,this.masonryHorizontal.rowXs);return{width:e}},_masonryHorizontalResizeChanged:function(){return this._checkIfSegmentsChanged(!0)},_fitColumnsReset:function(){this.fitColumns={x:0,y:0,width:0}},_fitColumnsLayout:function(e){var n=this,r=this.element.height(),i=this.fitColumns;e.each(function(){var e=t(this),s=e.outerWidth(!0),o=e.outerHeight(!0);i.y!==0&&o+i.y>r&&(i.x=i.width,i.y=0),n._pushPosition(e,i.x,i.y),i.width=Math.max(i.x+s,i.width),i.y+=o})},_fitColumnsGetContainerSize:function(){return{width:this.fitColumns.width}},_fitColumnsResizeChanged:function(){return!0},_cellsByColumnReset:function(){this.cellsByColumn={index:0},this._getSegments(),this._getSegments(!0)},_cellsByColumnLayout:function(e){var n=this,r=this.cellsByColumn;e.each(function(){var e=t(this),i=Math.floor(r.index/r.rows),s=r.index%r.rows,o=(i+.5)*r.columnWidth-e.outerWidth(!0)/2,u=(s+.5)*r.rowHeight-e.outerHeight(!0)/2;n._pushPosition(e,o,u),r.index++})},_cellsByColumnGetContainerSize:function(){return{width:Math.ceil(this.$filteredAtoms.length/this.cellsByColumn.rows)*this.cellsByColumn.columnWidth}},_cellsByColumnResizeChanged:function(){return this._checkIfSegmentsChanged(!0)},_straightAcrossReset:function(){this.straightAcross={x:0}},_straightAcrossLayout:function(e){var n=this;e.each(function(e){var r=t(this);n._pushPosition(r,n.straightAcross.x,0),n.straightAcross.x+=r.outerWidth(!0)})},_straightAcrossGetContainerSize:function(){return{width:this.straightAcross.x}},_straightAcrossResizeChanged:function(){return!0}},t.fn.imagesLoaded=function(e){function u(){e.call(n,r)}function a(e){var n=e.target;n.src!==s&&t.inArray(n,o)===-1&&(o.push(n),--i<=0&&(setTimeout(u),r.unbind(".imagesLoaded",a)))}var n=this,r=n.find("img").add(n.filter("img")),i=r.length,s="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==",o=[];return i||u(),r.bind("load.imagesLoaded error.imagesLoaded",a).each(function(){var e=this.src;this.src=s,this.src=e}),n};var S=function(t){e.console&&e.console.error(t)};t.fn.isotope=function(e,n){if(typeof e=="string"){var r=Array.prototype.slice.call(arguments,1);this.each(function(){var n=t.data(this,"isotope");if(!n){S("cannot call methods on isotope prior to initialization; attempted to call method '"+e+"'");return}if(!t.isFunction(n[e])||e.charAt(0)==="_"){S("no such method '"+e+"' for isotope instance");return}n[e].apply(n,r)})}else this.each(function(){var r=t.data(this,"isotope");r?(r.option(e),r._init(n)):t.data(this,"isotope",new t.Isotope(e,this,n))});return this}}(window,jQuery),define("plugins/jquery.isotope",function(){}),require(["underscore","backbone","vendor/engine.io","grid","media_collection","upload","plugins/jquery.isotope"],function(e,t,n,r,i,s){var o=new n.Socket({host:location.hostname,port:location.port});$(function(){Modernizr.touch&&scrollTo(0,1);var e=new i,t=window.Grid=new r({socket:o,collection:e});$("body > header").on("click",'[data-action="readme"]',function(e){return $("body > section").toggleClass("js-show"),!1}),o.on("message",function(t){t=JSON.parse(t);var n=e.get(t.id);n?n.update(t):e.add(t)})})}),define("main",function(){}),require.config({deps:["main"],paths:{vendor:"../assets/js/vendor",plugins:"../assets/js/plugins",backbone:"../assets/js/vendor/backbone",underscore:"../assets/js/vendor/lodash",tpl:"../assets/js/plugins/tpl",text:"../assets/js/plugins/text",json:"../assets/js/plugins/json"},shim:{backbone:{exports:"Backbone",deps:["underscore"]},"vendor/engine.io":{exports:"eio"},"plugins/jquery.deparam":[],"plugins/jquery.isotope":[]}}),define("config",function(){})